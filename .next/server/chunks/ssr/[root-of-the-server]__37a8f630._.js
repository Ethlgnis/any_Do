module.exports=[42029,a=>{"use strict";var b=a.i(87924),c=a.i(72131);let d=(0,c.createContext)({theme:"light",setTheme:()=>{},toggleTheme:()=>{}});function e(){return(0,c.useContext)(d)}function f({children:a}){let[e,f]=(0,c.useState)(()=>"light");return(0,c.useEffect)(()=>{let a=document.documentElement;"light"===e?a.setAttribute("data-theme","light"):a.removeAttribute("data-theme"),localStorage.setItem("anydo_theme",e)},[e]),(0,b.jsx)(d.Provider,{value:{theme:e,setTheme:f,toggleTheme:()=>{f(a=>"light"===a?"dark":"light")}},children:a})}a.s(["ThemeProvider",()=>f,"useTheme",()=>e])},874,(a,b,c)=>{b.exports=a.x("buffer",()=>require("buffer"))},74898,(a,b,c)=>{var d=a.r(874),e=d.Buffer;function f(a,b){for(var c in a)b[c]=a[c]}function g(a,b,c){return e(a,b,c)}e.from&&e.alloc&&e.allocUnsafe&&e.allocUnsafeSlow?b.exports=d:(f(d,c),c.Buffer=g),g.prototype=Object.create(e.prototype),f(e,g),g.from=function(a,b,c){if("number"==typeof a)throw TypeError("Argument must not be a number");return e(a,b,c)},g.alloc=function(a,b,c){if("number"!=typeof a)throw TypeError("Argument must be a number");var d=e(a);return void 0!==b?"string"==typeof c?d.fill(b,c):d.fill(b):d.fill(0),d},g.allocUnsafe=function(a){if("number"!=typeof a)throw TypeError("Argument must be a number");return e(a)},g.allocUnsafeSlow=function(a){if("number"!=typeof a)throw TypeError("Argument must be a number");return d.SlowBuffer(a)}},27699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},88947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},66181,(a,b,c)=>{"use strict";var d=a.r(88947).Stream,e=a.r(24361),f=function(a){this.readable=this.writable=!0,this._paused=!1,this._driver=a};e.inherits(f,d),f.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0},f.prototype.resume=function(){this._paused=!1,this.emit("drain");var a=this._driver.messages;a._paused=!1,a.emit("drain")},f.prototype.write=function(a){return!!this.writable&&(this._driver.parse(a),!this._paused)},f.prototype.end=function(a){if(this.writable){void 0!==a&&this.write(a),this.writable=!1;var b=this._driver.messages;b.readable&&(b.readable=b.writable=!1,b.emit("end"))}},f.prototype.destroy=function(){this.end()};var g=function(a){this.readable=this.writable=!0,this._paused=!1,this._driver=a};e.inherits(g,d),g.prototype.pause=function(){this._driver.io._paused=!0},g.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")},g.prototype.write=function(a){return!!this.writable&&("string"==typeof a?this._driver.text(a):this._driver.binary(a),!this._paused)},g.prototype.end=function(a){void 0!==a&&this.write(a)},g.prototype.destroy=function(){},c.IO=f,c.Messages=g},86562,(a,b,c)=>{"use strict";var d=function(){this.clear()};d.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"],d.prototype.clear=function(){this._sent={},this._lines=[]},d.prototype.set=function(a,b){if(void 0!==b){a=this._strip(a),b=this._strip(b);var c=a.toLowerCase();(!this._sent.hasOwnProperty(c)||this.ALLOWED_DUPLICATES.indexOf(c)>=0)&&(this._sent[c]=!0,this._lines.push(a+": "+b+"\r\n"))}},d.prototype.toString=function(){return this._lines.join("")},d.prototype._strip=function(a){return a.toString().replace(/^ */,"").replace(/ *$/,"")},b.exports=d},94255,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=function(){this._queue=[],this._queueSize=0,this._offset=0};e.prototype.put=function(a){a&&0!==a.length&&(d.isBuffer(a)||(a=d.from(a)),this._queue.push(a),this._queueSize+=a.length)},e.prototype.read=function(a){if(a>this._queueSize)return null;if(0===a)return d.alloc(0);this._queueSize-=a;var b,c,e=this._queue,f=a,g=e[0];if(g.length>=a)if(g.length===a)return e.shift();else return c=g.slice(0,a),e[0]=g.slice(a),c;for(var h=0,i=e.length;h<i&&!(f<e[h].length);h++)f-=e[h].length;return b=e.splice(0,h),f>0&&e.length>0&&(b.push(e[0].slice(0,f)),e[0]=e[0].slice(f)),d.concat(b,a)},e.prototype.eachByte=function(a,b){for(var c,d,e;this._queue.length>0;){for(d=(c=this._queue[0]).length;this._offset<d;)e=this._offset,this._offset+=1,a.call(b,c[e]);this._offset=0,this._queue.shift()}},b.exports=e},30145,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(27699).EventEmitter,f=a.r(24361),g=a.r(66181),h=a.r(86562),i=a.r(94255),j=function(a,b,c){e.call(this),j.validateOptions(c||{},["maxLength","masking","requireMasking","protocols"]),this._request=a,this._reader=new i,this._options=c||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new h,this.__queue=[],this.readyState=0,this.url=b,this.io=new g.IO(this),this.messages=new g.Messages(this),this._bindEventListeners()};f.inherits(j,e),j.isWebSocket=function(a){var b=a.headers.connection||"",c=a.headers.upgrade||"";return"GET"===a.method&&b.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&"websocket"===c.toLowerCase()},j.validateOptions=function(a,b){for(var c in a)if(0>b.indexOf(c))throw Error("Unrecognized option: "+c)};var k={MAX_LENGTH:0x3ffffff,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var a=this;this.messages.on("error",function(){}),this.on("message",function(b){var c=a.messages;c.readable&&c.emit("data",b.data)}),this.on("error",function(b){var c=a.messages;c.readable&&c.emit("error",b)}),this.on("close",function(){var b=a.messages;b.readable&&(b.readable=b.writable=!1,b.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(a){return!1},setHeader:function(a,b){return!(this.readyState>0)&&(this._headers.set(a,b),!0)},start:function(){var a;if(0!==this.readyState)return!1;if(!j.isWebSocket(this._request))return this._failHandshake(Error("Not a WebSocket request"));try{a=this._handshakeResponse()}catch(a){return this._failHandshake(a)}return this._write(a),-1!==this._stage&&this._open(),!0},_failHandshake:function(a){var b=new h;return b.set("Content-Type","text/plain"),b.set("Content-Length",d.byteLength(a.message,"utf8")),b=["HTTP/1.1 400 Bad Request",b.toString(),a.message],this._write(d.from(b.join("\r\n"),"utf8")),this._fail("protocol_error",a.message),!1},text:function(a){return this.frame(a)},binary:function(a){return!1},ping:function(){return!1},pong:function(){return!1},close:function(a,b){return 1===this.readyState&&(this.readyState=3,this.emit("close",new j.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(a){this.frame.apply(this,a)},this),this.__queue=[],this.emit("open",new j.OpenEvent)},_queue:function(a){return this.__queue.push(a),!0},_write:function(a){var b=this.io;b.readable&&b.emit("data",a)},_fail:function(a,b){this.readyState=2,this.emit("error",Error(b)),this.close()}};for(var l in k)j.prototype[l]=k[l];j.ConnectEvent=function(){},j.OpenEvent=function(){},j.CloseEvent=function(a,b){this.code=a,this.reason=b},j.MessageEvent=function(a){this.data=a},j.PingEvent=function(a){this.data=a},j.PongEvent=function(a){this.data=a},b.exports=j},54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},92509,(a,b,c)=>{b.exports=a.x("url",()=>require("url"))},58726,(a,b,c)=>{function d(a){if(void 0!==a&&a!==d.REQUEST&&a!==d.RESPONSE)throw Error("type must be REQUEST or RESPONSE");void 0===a||this.initialize(a),this.maxHeaderSize=d.maxHeaderSize}c.HTTPParser=d,d.prototype.initialize=function(a,b){if(a!==d.REQUEST&&a!==d.RESPONSE)throw Error("type must be REQUEST or RESPONSE");this.type=a,this.state=a+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1},d.encoding="ascii",d.maxHeaderSize=81920,d.REQUEST="REQUEST",d.RESPONSE="RESPONSE";var e=d.kOnHeaders=1,f=d.kOnHeadersComplete=2,g=d.kOnBody=3,h=d.kOnMessageComplete=4;d.prototype[e]=d.prototype[f]=d.prototype[g]=d.prototype[h]=function(){};var i=!0;Object.defineProperty(d,"kOnExecute",{get:function(){return i=!1,99}});var j=c.methods=d.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],k=j.indexOf("CONNECT");d.prototype.reinitialize=d,d.prototype.close=d.prototype.pause=d.prototype.resume=d.prototype.remove=d.prototype.free=function(){},d.prototype._compatMode0_11=!1,d.prototype.getAsyncId=function(){return 0};var l={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};d.prototype.execute=function(a,b,c){if(!(this instanceof d))throw TypeError("not a HTTPParser");b=b||0,c="number"==typeof c?c:a.length,this.chunk=a,this.offset=b;var e=this.end=b+c;try{for(;this.offset<e&&!this[this.state](););}catch(a){if(this.isUserCall)throw a;return this.hadError=!0,a}return(this.chunk=null,c=this.offset-b,l[this.state]&&(this.headerSize+=c,this.headerSize>(this.maxHeaderSize||d.maxHeaderSize)))?Error("max header size exceeded"):c};var m={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};d.prototype.finish=function(){if(!this.hadError){if(!m[this.state])return Error("invalid state for EOF");"BODY_RAW"===this.state&&this.userCall()(this[h]())}},d.prototype.consume=d.prototype.unconsume=d.prototype.getCurrentBuffer=function(){},d.prototype.userCall=function(){this.isUserCall=!0;var a=this;return function(b){return a.isUserCall=!1,b}},d.prototype.nextRequest=function(){this.userCall()(this[h]()),this.reinitialize(this.type)},d.prototype.consumeLine=function(){for(var a=this.end,b=this.chunk,c=this.offset;c<a;c++)if(10===b[c]){var e=this.line+b.toString(d.encoding,this.offset,c);return"\r"===e.charAt(e.length-1)&&(e=e.substr(0,e.length-1)),this.line="",this.offset=c+1,e}this.line+=b.toString(d.encoding,this.offset,this.end),this.offset=this.end};var n=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,o=/^[ \t]+(.*[^ \t])/;d.prototype.parseHeader=function(a,b){if(-1!==a.indexOf("\r"))throw r("HPE_LF_EXPECTED");var c=n.exec(a),d=c&&c[1];if(d)b.push(d),b.push(c[2]);else{var e=o.exec(a);e&&b.length&&(b[b.length-1]&&(b[b.length-1]+=" "),b[b.length-1]+=e[1])}};var p=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;d.prototype.REQUEST_LINE=function(){var a=this.consumeLine();if(a){var b=p.exec(a);if(null===b)throw r("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?b[1]:j.indexOf(b[1]),-1===this.info.method)throw Error("invalid request method");this.info.url=b[2],this.info.versionMajor=+b[3],this.info.versionMinor=+b[4],this.body_bytes=0,this.state="HEADER"}};var q=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;function r(a){var b=Error("Parse Error");return b.code=a,b}d.prototype.RESPONSE_LINE=function(){var a=this.consumeLine();if(a){var b=q.exec(a);if(null===b)throw r("HPE_INVALID_CONSTANT");this.info.versionMajor=+b[1],this.info.versionMinor=+b[2];var c=this.info.statusCode=+b[3];this.info.statusMessage=b[4],((c/100|0)==1||204===c||304===c)&&(this.body_bytes=0),this.state="HEADER"}},d.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(-1!==this.connection.indexOf("close"))return!1}else if(-1===this.connection.indexOf("keep-alive"))return!1;return null!==this.body_bytes||!!this.isChunked},d.prototype.HEADER=function(){var a=this.consumeLine();if(void 0!==a){var b=this.info;if(a)this.parseHeader(a,b.headers);else{for(var c,e,g=b.headers,h=!1,j=!1,l=0;l<g.length;l+=2)switch(g[l].toLowerCase()){case"transfer-encoding":this.isChunked="chunked"===g[l+1].toLowerCase();break;case"content-length":if(c=+g[l+1],h){if(c!==this.body_bytes)throw r("HPE_UNEXPECTED_CONTENT_LENGTH")}else h=!0,this.body_bytes=c;break;case"connection":this.connection+=g[l+1].toLowerCase();break;case"upgrade":j=!0}if(this.isChunked&&h&&(h=!1,this.body_bytes=null),j&&-1!=this.connection.indexOf("upgrade")?b.upgrade=this.type===d.REQUEST||101===b.statusCode:b.upgrade=b.method===k,this.isChunked&&b.upgrade&&(this.isChunked=!1),b.shouldKeepAlive=this.shouldKeepAlive(),2===(e=i?this.userCall()(this[f](b)):this.userCall()(this[f](b.versionMajor,b.versionMinor,b.headers,b.method,b.url,b.statusCode,b.statusMessage,b.upgrade,b.shouldKeepAlive))))return this.nextRequest(),!0;if(this.isChunked&&!e)this.state="BODY_CHUNKHEAD";else{if(e||0===this.body_bytes)return this.nextRequest(),b.upgrade;null===this.body_bytes?this.state="BODY_RAW":this.state="BODY_SIZED"}}}},d.prototype.BODY_CHUNKHEAD=function(){var a=this.consumeLine();void 0!==a&&(this.body_bytes=parseInt(a,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")},d.prototype.BODY_CHUNK=function(){var a=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[g](this.chunk.slice(this.offset,this.offset+a),0,a)),this.offset+=a,this.body_bytes-=a,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")},d.prototype.BODY_CHUNKEMPTYLINE=function(){var a=this.consumeLine();if(void 0!==a){if(""!==a)throw Error("Expected empty line");this.state="BODY_CHUNKHEAD"}},d.prototype.BODY_CHUNKTRAILERS=function(){var a=this.consumeLine();void 0!==a&&(a?this.parseHeader(a,this.trailers):(this.trailers.length&&this.userCall()(this[e](this.trailers,"")),this.nextRequest()))},d.prototype.BODY_RAW=function(){this.userCall()(this[g](this.chunk.slice(this.offset,this.end),0,this.end-this.offset)),this.offset=this.end},d.prototype.BODY_SIZED=function(){var a=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[g](this.chunk.slice(this.offset,this.offset+a),0,a)),this.offset+=a,this.body_bytes-=a,this.body_bytes||this.nextRequest()},["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(a){var b=d["kOn"+a];Object.defineProperty(d.prototype,"on"+a,{get:function(){return this[b]},set:function(a){return this._compatMode0_11=!0,k="CONNECT",this[b]=a}})})},34867,(a,b,c)=>{"use strict";var d=a.r(58726).HTTPParser,e=a.r(74898).Buffer,f={request:d.REQUEST||"request",response:d.RESPONSE||"response"},g=function(a){this._type=a,this._parser=new d(f[a]),this._complete=!1,this.headers={};var b=null,c=this;this._parser.onHeaderField=function(a,c,d){b=a.toString("utf8",c,c+d).toLowerCase()},this._parser.onHeaderValue=function(a,d,e){var f=a.toString("utf8",d,d+e);c.headers.hasOwnProperty(b)?c.headers[b]+=", "+f:c.headers[b]=f},this._parser.onHeadersComplete=this._parser[d.kOnHeadersComplete]=function(a,b,d,e,f,h){var i=arguments[0];if("object"==typeof i&&(e=i.method,f=i.url,h=i.statusCode,d=i.headers),c.method="number"==typeof e?g.METHODS[e]:e,c.statusCode=h,c.url=f,d){for(var j,k,l=0,m=d.length;l<m;l+=2)j=d[l].toLowerCase(),k=d[l+1],c.headers.hasOwnProperty(j)?c.headers[j]+=", "+k:c.headers[j]=k;c._complete=!0}}};g.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var h=process.version?process.version.match(/[0-9]+/g).map(function(a){return parseInt(a,10)}):[];0===h[0]&&12===h[1]&&(g.METHODS[16]="REPORT",g.METHODS[17]="MKACTIVITY",g.METHODS[18]="CHECKOUT",g.METHODS[19]="MERGE",g.METHODS[20]="M-SEARCH",g.METHODS[21]="NOTIFY",g.METHODS[22]="SUBSCRIBE",g.METHODS[23]="UNSUBSCRIBE",g.METHODS[24]="PATCH",g.METHODS[25]="PURGE"),g.prototype.isComplete=function(){return this._complete},g.prototype.parse=function(a){var b=this._parser.execute(a,0,a.length);if("number"!=typeof b){this.error=b,this._complete=!0;return}this._complete&&(this.body=b<a.length?a.slice(b):e.alloc(0))},b.exports=g},6073,(a,b,c)=>{"use strict";var d=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,e=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,f=RegExp(d.source+"(?:=(?:"+d.source+"|"+/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/.source+"))?"),g=RegExp(d.source+"(?: *; *"+f.source+")*","g"),h=RegExp("^"+g.source+"(?: *, *"+g.source+")*$"),i=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,j=Object.prototype.hasOwnProperty,k=function(){this._byName={},this._inOrder=[]};k.prototype.push=function(a,b){j.call(this._byName,a)||(this._byName[a]=[]),this._byName[a].push(b),this._inOrder.push({name:a,params:b})},k.prototype.eachOffer=function(a,b){for(var c=this._inOrder,d=0,e=c.length;d<e;d++)a.call(b,c[d].name,c[d].params)},k.prototype.byName=function(a){return this._byName[a]||[]},k.prototype.toArray=function(){return this._inOrder.slice()},b.exports={parseHeader:function(a){var b=new k;if(""===a||void 0===a)return b;if(!h.test(a))throw SyntaxError("Invalid Sec-WebSocket-Extensions header: "+a);return a.match(g).forEach(function(a){var c=a.match(RegExp(f.source,"g")),d=c.shift(),e={};c.forEach(function(a){var b,c=a.match(f),d=c[1];b=void 0!==c[2]?c[2]:void 0===c[3]||c[3].replace(/\\/g,""),i.test(b)&&(b=parseFloat(b)),j.call(e,d)?(e[d]=[].concat(e[d]),e[d].push(b)):e[d]=b},this),b.push(d,e)},this),b},serializeParams:function(a,b){var c=[],d=function(a,b){b instanceof Array?b.forEach(function(b){d(a,b)}):!0===b?c.push(a):"number"==typeof b?c.push(a+"="+b):e.test(b)?c.push(a+'="'+b.replace(/"/g,'\\"')+'"'):c.push(a+"="+b)};for(var f in b)d(f,b[f]);return[a].concat(c).join("; ")}}},21777,(a,b,c)=>{"use strict";var d=function(a){this._bufferSize=a,this.clear()};d.prototype.clear=function(){this._buffer=Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0},d.prototype.push=function(a){var b=!1,c=!1;this._ringSize<this._bufferSize?b=0===this._tail:this._ringOffset===this._ringSize&&(b=!0,c=0===this._tail),b&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(Array(this._bufferSize)),this._bufferSize=this._buffer.length,c&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=a,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize},d.prototype.peek=function(){if(0!==this.length)return this._buffer[this._head]},d.prototype.shift=function(){if(0!==this.length){var a=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,0===this._ringOffset&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,a}},b.exports=d},76503,(a,b,c)=>{"use strict";var d=a.r(21777),e=function(a,b){this._session=a,this._method=b,this._queue=new d(e.QUEUE_SIZE),this._stopped=!1,this.pending=0};e.QUEUE_SIZE=8,e.prototype.call=function(a,b,c,d){if(!this._stopped){var e={error:a,message:b,callback:c,context:d,done:!1},f=!1,g=this;if(this._queue.push(e),e.error)return e.done=!0,this._stop(),this._flushQueue();var h=function(a,b){f^(f=!0)&&(a?(g._stop(),e.error=a,e.message=null):e.message=b,e.done=!0,g._flushQueue())};try{this._session[this._method](b,h)}catch(a){h(a)}}},e.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0},e.prototype._flushQueue=function(){for(var a,b=this._queue;b.length>0&&b.peek().done;)(a=b.shift()).error?(this.pending=0,b.clear()):this.pending-=1,a.callback.call(a.context,a.error,a.message)},b.exports=e},52681,(a,b,c)=>{"use strict";var d=a.r(21777),e=function(){this._complete=!1,this._callbacks=new d(e.QUEUE_SIZE)};e.QUEUE_SIZE=4,e.all=function(a){var b=new e,c=a.length,d=c;for(0===c&&b.done();d--;)a[d].then(function(){0==(c-=1)&&b.done()});return b},e.prototype.then=function(a){this._complete?a():this._callbacks.push(a)},e.prototype.done=function(){this._complete=!0;for(var a,b=this._callbacks;a=b.shift();)a()},b.exports=e},4698,(a,b,c)=>{"use strict";var d=a.r(76503),e=a.r(52681),f=function(a){this._ext=a[0],this._session=a[1],this._functors={incoming:new d(this._session,"processIncomingMessage"),outgoing:new d(this._session,"processOutgoingMessage")}};f.prototype.pending=function(a){var b=this._functors[a];b._stopped||(b.pending+=1)},f.prototype.incoming=function(a,b,c,d){this._exec("incoming",a,b,c,d)},f.prototype.outgoing=function(a,b,c,d){this._exec("outgoing",a,b,c,d)},f.prototype.close=function(){return this._closed=this._closed||new e,this._doClose(),this._closed},f.prototype._exec=function(a,b,c,d,e){this._functors[a].call(b,c,function(a,b){a&&(a.message=this._ext.name+": "+a.message),d.call(e,a,b),this._doClose()},this)},f.prototype._doClose=function(){var a=this._functors.incoming,b=this._functors.outgoing;this._closed&&a.pending+b.pending===0&&(this._session&&this._session.close(),this._session=null,this._closed.done())},b.exports=f},67900,(a,b,c)=>{"use strict";var d=a.r(4698),e=a.r(52681),f=function(a){this._cells=a.map(function(a){return new d(a)}),this._stopped={incoming:!1,outgoing:!1}};f.prototype.processIncomingMessage=function(a,b,c){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,a,b,c)},f.prototype.processOutgoingMessage=function(a,b,c){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,a,b,c)},f.prototype.close=function(a,b){this._stopped={incoming:!0,outgoing:!0};var c=this._cells.map(function(a){return a.close()});a&&e.all(c).then(function(){a.call(b)})},f.prototype._loop=function(a,b,c,d,e,f,g){for(var h=this._cells,i=h.length,j=this;i--;)h[i].pending(a);var k=function(b,e,i){if(b===c)return f.call(g,e,i);h[b][a](e,i,function(c,e){c&&(j._stopped[a]=!0),k(b+d,c,e)})};k(b,null,e)},b.exports=f},64081,(a,b,c)=>{"use strict";var d=a.r(6073),e=a.r(67900),f=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};f.MESSAGE_OPCODES=[1,2];var g={add:function(a){if("string"!=typeof a.name)throw TypeError("extension.name must be a string");if("permessage"!==a.type)throw TypeError('extension.type must be "permessage"');if("boolean"!=typeof a.rsv1)throw TypeError("extension.rsv1 must be true or false");if("boolean"!=typeof a.rsv2)throw TypeError("extension.rsv2 must be true or false");if("boolean"!=typeof a.rsv3)throw TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(a.name))throw TypeError('An extension with name "'+a.name+'" is already registered');this._byName[a.name]=a,this._inOrder.push(a)},generateOffer:function(){var a=[],b=[],c={};return this._inOrder.forEach(function(e){var f=e.createClientSession();if(f){var g=[e,f];a.push(g),c[e.name]=g;var h=f.generateOffer();(h=h?[].concat(h):[]).forEach(function(a){b.push(d.serializeParams(e.name,a))},this)}},this),this._sessions=a,this._index=c,b.length>0?b.join(", "):null},activate:function(a){var b=d.parseHeader(a),c=[];b.eachOffer(function(a,b){var e=this._index[a];if(!e)throw Error('Server sent an extension response for unknown extension "'+a+'"');var f=e[0],g=e[1],h=this._reserved(f);if(h)throw Error("Server sent two extension responses that use the RSV"+h[0]+' bit: "'+h[1]+'" and "'+f.name+'"');if(!0!==g.activate(b))throw Error("Server sent unacceptable extension parameters: "+d.serializeParams(a,b));this._reserve(f),c.push(e)},this),this._sessions=c,this._pipeline=new e(c)},generateResponse:function(a){var b=[],c=[],f=d.parseHeader(a);return this._inOrder.forEach(function(a){var e=f.byName(a.name);if(!(0===e.length||this._reserved(a))){var g=a.createServerSession(e);g&&(this._reserve(a),b.push([a,g]),c.push(d.serializeParams(a.name,g.generateResponse())))}},this),this._sessions=b,this._pipeline=new e(b),c.length>0?c.join(", "):null},validFrameRsv:function(a){var b,c={rsv1:!1,rsv2:!1,rsv3:!1};if(f.MESSAGE_OPCODES.indexOf(a.opcode)>=0)for(var d=0,e=this._sessions.length;d<e;d++)b=this._sessions[d][0],c.rsv1=c.rsv1||b.rsv1,c.rsv2=c.rsv2||b.rsv2,c.rsv3=c.rsv3||b.rsv3;return(c.rsv1||!a.rsv1)&&(c.rsv2||!a.rsv2)&&(c.rsv3||!a.rsv3)},processIncomingMessage:function(a,b,c){this._pipeline.processIncomingMessage(a,b,c)},processOutgoingMessage:function(a,b,c){this._pipeline.processOutgoingMessage(a,b,c)},close:function(a,b){if(!this._pipeline)return a.call(b);this._pipeline.close(a,b)},_reserve:function(a){this._rsv1=this._rsv1||a.rsv1&&a.name,this._rsv2=this._rsv2||a.rsv2&&a.name,this._rsv3=this._rsv3||a.rsv3&&a.name},_reserved:function(a){return this._rsv1&&a.rsv1?[1,this._rsv1]:this._rsv2&&a.rsv2?[2,this._rsv2]:!!this._rsv3&&!!a.rsv3&&[3,this._rsv3]}};for(var h in g)f.prototype[h]=g[h];b.exports=f},46256,(a,b,c)=>{"use strict";var d=function(){},e={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(var f in e)d.prototype[f]=e[f];b.exports=d},55887,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},f={read:function(){return this.data=this.data||d.concat(this._chunks,this.length)},pushFrame:function(a){this.rsv1=this.rsv1||a.rsv1,this.rsv2=this.rsv2||a.rsv2,this.rsv3=this.rsv3||a.rsv3,null===this.opcode&&(this.opcode=a.opcode),this._chunks.push(a.payload),this.length+=a.length}};for(var g in f)e.prototype[g]=f[g];b.exports=e},46987,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(54799),f=a.r(24361),g=a.r(64081),h=a.r(30145),i=a.r(46256),j=a.r(55887),k=function(a,b,c){if(h.apply(this,arguments),this._extensions=new g,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},"string"==typeof this._protocols&&(this._protocols=this._protocols.split(/ *, */)),this._request){var d=this._request.headers["sec-websocket-protocol"],e=this._protocols;void 0!==d&&("string"==typeof d&&(d=d.split(/ *, */)),this.protocol=d.filter(function(a){return e.indexOf(a)>=0})[0]),this.version="hybi-"+k.VERSION}};f.inherits(k,h),k.VERSION="13",k.mask=function(a,b,c){if(!b||0===b.length)return a;c=c||0;for(var d=0,e=a.length-c;d<e;d++)a[c+d]=a[c+d]^b[d%4];return a},k.generateAccept=function(a){var b=e.createHash("sha1");return b.update(a+k.GUID),b.digest("base64")},k.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var l={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(a){return this._extensions.add(a),!0},parse:function(a){this._reader.put(a);for(var b=!0;b;)switch(this._stage){case 0:(b=this._reader.read(1))&&this._parseOpcode(b[0]);break;case 1:(b=this._reader.read(1))&&this._parseLength(b[0]);break;case 2:(b=this._reader.read(this._frame.lengthBytes))&&this._parseExtendedLength(b);break;case 3:(b=this._reader.read(4))&&(this._stage=4,this._frame.maskingKey=b);break;case 4:(b=this._reader.read(this._frame.length))&&(this._stage=0,this._emitFrame(b));break;default:b=null}},text:function(a){return!(this.readyState>1)&&this.frame(a,"text")},binary:function(a){return!(this.readyState>1)&&this.frame(a,"binary")},ping:function(a,b){return!(this.readyState>1)&&(a=a||"",b&&(this._pingCallbacks[a]=b),this.frame(a,"ping"))},pong:function(a){return!(this.readyState>1)&&(a=a||"",this.frame(a,"pong"))},close:function(a,b){return(a=a||"",b=b||this.ERRORS.normal_closure,this.readyState<=0)?(this.readyState=3,this.emit("close",new h.CloseEvent(b,a)),!0):1===this.readyState&&(this.readyState=2,this._extensions.close(function(){this.frame(a,"close",b)},this),!0)},frame:function(a,b,c){if(this.readyState<=0)return this._queue([a,b,c]);if(this.readyState>2)return!1;a instanceof Array&&(a=d.from(a)),"number"==typeof a&&(a=a.toString());var f,g,h=new j,k="string"==typeof a;h.rsv1=h.rsv2=h.rsv3=!1,h.opcode=this.OPCODES[b||(k?"text":"binary")],f=k?d.from(a,"utf8"):a,c&&(g=f,(f=d.allocUnsafe(2+g.length)).writeUInt16BE(c,0),g.copy(f,2)),h.data=f;var l=function(a){var b=new i;b.final=!0,b.rsv1=a.rsv1,b.rsv2=a.rsv2,b.rsv3=a.rsv3,b.opcode=a.opcode,b.masked=!!this._masking,b.length=a.data.length,b.payload=a.data,b.masked&&(b.maskingKey=e.randomBytes(4)),this._sendFrame(b)};return this.MESSAGE_OPCODES.indexOf(h.opcode)>=0?this._extensions.processOutgoingMessage(h,function(a,b){if(a)return this._fail("extension_error",a.message);l.call(this,b)},this):l.call(this,h),!0},_sendFrame:function(a){var b=a.length,c=b<=125?2:b<=65535?4:10,e=c+4*!!a.masked,f=d.allocUnsafe(e+b),g=a.masked?this.MASK:0;f[0]=(a.final?this.FIN:0)|(a.rsv1?this.RSV1:0)|(a.rsv2?this.RSV2:0)|(a.rsv3?this.RSV3:0)|a.opcode,b<=125?f[1]=g|b:b<=65535?(f[1]=126|g,f.writeUInt16BE(b,2)):(f[1]=127|g,f.writeUInt32BE(Math.floor(b/0x100000000),2),f.writeUInt32BE(b%0x100000000,6)),a.payload.copy(f,e),a.masked&&(a.maskingKey.copy(f,c),k.mask(f,a.maskingKey,e)),this._write(f)},_handshakeResponse:function(){var a=this._request.headers["sec-websocket-key"],b=this._request.headers["sec-websocket-version"];if(b!==k.VERSION)throw Error("Unsupported WebSocket version: "+b);if("string"!=typeof a)throw Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",k.generateAccept(a)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var c=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);c&&this._headers.set("Sec-WebSocket-Extensions",c);var e=["HTTP/1.1 101 Switching Protocols",this._headers.toString(),""];return d.from(e.join("\r\n"),"utf8")},_shutdown:function(a,b,c){delete this._frame,delete this._message,this._stage=5;var d=1===this.readyState;this.readyState=2,this._extensions.close(function(){d&&this.frame(b,"close",a),this.readyState=3,c&&this.emit("error",Error(b)),this.emit("close",new h.CloseEvent(a,b))},this)},_fail:function(a,b){this.readyState>1||this._shutdown(this.ERRORS[a],b,!0)},_parseOpcode:function(a){var b=[this.RSV1,this.RSV2,this.RSV3].map(function(b){return(a&b)===b}),c=this._frame=new i;return(c.final=(a&this.FIN)===this.FIN,c.rsv1=b[0],c.rsv2=b[1],c.rsv3=b[2],c.opcode=a&this.OPCODE,this._stage=1,this._extensions.validFrameRsv(c))?0>this.OPCODE_CODES.indexOf(c.opcode)?this._fail("protocol_error","Unrecognized frame opcode: "+c.opcode):0>this.MESSAGE_OPCODES.indexOf(c.opcode)&&!c.final?this._fail("protocol_error","Received fragmented control frame: opcode = "+c.opcode):this._message&&this.OPENING_OPCODES.indexOf(c.opcode)>=0?this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished"):void 0:this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+ +!!c.rsv1+", reserved2 = "+ +!!c.rsv2+", reserved3 = "+ +!!c.rsv3)},_parseLength:function(a){var b=this._frame;if(b.masked=(a&this.MASK)===this.MASK,b.length=a&this.LENGTH,b.length>=0&&b.length<=125){if(this._stage=b.masked?3:4,!this._checkFrameLength())return}else this._stage=2,b.lengthBytes=126===b.length?2:8;if(this._requireMasking&&!b.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(a){var b=this._frame;if(b.length=this._readUInt(a),this._stage=b.masked?3:4,0>this.MESSAGE_OPCODES.indexOf(b.opcode)&&b.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+b.length);if(!this._checkFrameLength())return},_checkFrameLength:function(){return!((this._message?this._message.length:0)+this._frame.length>this._maxLength)||(this._fail("too_large","WebSocket frame length too large"),!1)},_emitFrame:function(a){var b,c,d,e,f,g=this._frame,i=g.payload=k.mask(a,g.maskingKey),l=g.opcode;if(delete this._frame,l===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(g)}if((l===this.OPCODES.text||l===this.OPCODES.binary)&&(this._message=new j,this._message.pushFrame(g)),g.final&&this.MESSAGE_OPCODES.indexOf(l)>=0)return this._emitMessage(this._message);l===this.OPCODES.close&&(c=i.length>=2?i.readUInt16BE(0):null,d=i.length>2?this._encode(i.slice(2)):null,0!==i.length&&!(null!==c&&c>=this.MIN_RESERVED_ERROR&&c<=this.MAX_RESERVED_ERROR)&&0>this.ERROR_CODES.indexOf(c)&&(c=this.ERRORS.protocol_error),(i.length>125||i.length>2&&!d)&&(c=this.ERRORS.protocol_error),this._shutdown(c||this.DEFAULT_ERROR_CODE,d||"")),l===this.OPCODES.ping&&(this.frame(i,"pong"),this.emit("ping",new h.PingEvent(i.toString()))),l===this.OPCODES.pong&&(f=(e=this._pingCallbacks)[b=this._encode(i)],delete e[b],f&&f(),this.emit("pong",new h.PongEvent(i.toString())))},_emitMessage:function(a){var a=this._message;a.read(),delete this._message,this._extensions.processIncomingMessage(a,function(a,b){if(a)return this._fail("extension_error",a.message);var c=b.data;if(b.opcode===this.OPCODES.text&&(c=this._encode(c)),null===c)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new h.MessageEvent(c))},this)},_encode:function(a){try{var b=a.toString("binary",0,a.length);if(!this.UTF8_MATCH.test(b))return null}catch(a){}return a.toString("utf8",0,a.length)},_readUInt:function(a){return 2===a.length?a.readUInt16BE(0):0x100000000*a.readUInt32BE(0)+a.readUInt32BE(4)}};for(var m in l)k.prototype[m]=l[m];b.exports=k},27520,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(88947).Stream,f=a.r(92509),g=a.r(24361),h=a.r(30145),i=a.r(86562),j=a.r(34867),k={"ws:":80,"wss:":443},l=function(a,b,c){this._client=a,this._http=new j("response"),this._origin="object"==typeof a.url?a.url:f.parse(a.url),this._url="object"==typeof b?b:f.parse(b),this._options=c||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new i,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var e=this._url.auth&&d.from(this._url.auth,"utf8").toString("base64");e&&this._headers.set("Proxy-Authorization","Basic "+e)};g.inherits(l,e);var m={setHeader:function(a,b){return 0===this._state&&(this._headers.set(a,b),!0)},start:function(){if(0!==this._state)return!1;this._state=1;var a=this._origin,b=a.port||k[a.protocol],c=["CONNECT "+a.hostname+":"+b+" HTTP/1.1",this._headers.toString(),""];return this.emit("data",d.from(c.join("\r\n"),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(a){if(!this.writable)return!1;if(this._http.parse(a),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,200===this.statusCode)this.emit("connect",new h.ConnectEvent);else{var b="Can't establish a connection to the server at "+this._origin.href;this.emit("error",Error(b))}return this.end(),!this._paused},end:function(a){this.writable&&(void 0!==a&&this.write(a),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(var n in m)l.prototype[n]=m[n];b.exports=l},17737,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(54799),f=a.r(92509),g=a.r(24361),h=a.r(34867),i=a.r(30145),j=a.r(46987),k=a.r(27520),l=function(a,b){this.version="hybi-"+j.VERSION,j.call(this,null,a,b),this.readyState=-1,this._key=l.generateKey(),this._accept=j.generateAccept(this._key),this._http=new h("response");var c=f.parse(this.url),e=c.auth&&d.from(c.auth,"utf8").toString("base64");if(0>this.VALID_PROTOCOLS.indexOf(c.protocol))throw Error(this.url+" is not a valid WebSocket URL");this._pathname=(c.pathname||"/")+(c.search||""),this._headers.set("Host",c.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",j.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),e&&this._headers.set("Authorization","Basic "+e)};g.inherits(l,j),l.generateKey=function(){return e.randomBytes(16).toString("base64")};var m={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(a,b){return new k(this,a,b)},start:function(){return -1===this.readyState&&(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(a){return 3===this.readyState?void 0:this.readyState>0?j.prototype.parse.call(this,a):(this._http.parse(a),this._http.isComplete())?void(this._validateHandshake(),3!==this.readyState&&(this._open(),this.parse(this._http.body))):void 0},_handshakeRequest:function(){var a=this._extensions.generateOffer();a&&this._headers.set("Sec-WebSocket-Extensions",a);var b=["GET "+this._pathname+" HTTP/1.1",this._headers.toString(),""];return d.from(b.join("\r\n"),"utf8")},_failHandshake:function(a){a="Error during WebSocket handshake: "+a,this.readyState=3,this.emit("error",Error(a)),this.emit("close",new i.CloseEvent(this.ERRORS.protocol_error,a))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(101!==this._http.statusCode)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var a=this._http.headers,b=a.upgrade||"",c=a.connection||"",d=a["sec-websocket-accept"]||"",e=a["sec-websocket-protocol"]||"";if(""===b)return this._failHandshake("'Upgrade' header is missing");if("websocket"!==b.toLowerCase())return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(""===c)return this._failHandshake("'Connection' header is missing");if("upgrade"!==c.toLowerCase())return this._failHandshake("'Connection' header value is not 'Upgrade'");if(d!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,""!==e)if(0>this._protocols.indexOf(e))return this._failHandshake("Sec-WebSocket-Protocol mismatch");else this.protocol=e;try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(a){return this._failHandshake(a.message)}}};for(var n in m)l.prototype[n]=m[n];b.exports=l},10950,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(30145),f=a.r(24361),g=function(a,b,c){e.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};f.inherits(g,e);var h={close:function(){return 3!==this.readyState&&(this.readyState=3,this.emit("close",new e.CloseEvent(null,null)),!0)},parse:function(a){this.readyState>1||(this._reader.put(a),this._reader.eachByte(function(a){var b;switch(this._stage){case -1:this._body.push(a),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(a);break;case 1:if(this._length=(127&a)+128*this._length,this._closing&&0===this._length)return this.close();(128&a)!=128&&(0===this._length?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(255===a)this._stage=0,b=d.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new e.MessageEvent(b));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(a),this._buffer.length>this._maxLength)return this.close()}},this))},frame:function(a){if(0===this.readyState)return this._queue([a]);if(this.readyState>1)return!1;"string"!=typeof a&&(a=a.toString());var b=d.byteLength(a),c=d.allocUnsafe(b+2);return c[0]=0,c.write(a,1),c[c.length-1]=255,this._write(c),!0},_handshakeResponse:function(){var a=["HTTP/1.1 101 Web Socket Protocol Handshake",this._headers.toString(),""];return d.from(a.join("\r\n"),"utf8")},_parseLeadingByte:function(a){(128&a)==128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(var i in h)g.prototype[i]=h[i];b.exports=g},61123,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(30145),f=a.r(10950),g=a.r(54799),h=a.r(24361),i=function(a){return parseInt((a.match(/[0-9]/g)||[]).join(""),10)},j=function(a){return(a.match(/ /g)||[]).length},k=function(a,b,c){f.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};h.inherits(k,f);var l={BODY_SIZE:8,start:function(){return!!f.prototype.start.call(this)&&(this._started=!0,this._sendHandshakeBody(),!0)},close:function(){return 3!==this.readyState&&(1===this.readyState&&this._write(d.from([255,0])),this.readyState=3,this.emit("close",new e.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var a=this._request.headers,b=a["sec-websocket-key1"],c=a["sec-websocket-key2"];if(!b)throw Error("Missing required header: Sec-WebSocket-Key1");if(!c)throw Error("Missing required header: Sec-WebSocket-Key2");var e=i(b),f=j(b),g=i(c),h=j(c);if(e%f!=0||g%h!=0)throw Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[e/f,g/h];var a=["HTTP/1.1 101 WebSocket Protocol Handshake",this._headers.toString(),""];return d.from(a.join("\r\n"),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var a=g.createHash("md5"),b=d.allocUnsafe(8+this.BODY_SIZE);return b.writeUInt32BE(this._keyValues[0],0),b.writeUInt32BE(this._keyValues[1],4),d.from(this._body).copy(b,8,0,this.BODY_SIZE),a.update(b),d.from(a.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var a=this._handshakeSignature();a&&(this._write(a),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(a){if(255!==a)return f.prototype._parseLeadingByte.call(this,a);this._closing=!0,this._length=0,this._stage=1}};for(var m in l)k.prototype[m]=l[m];b.exports=k},89048,(a,b,c)=>{"use strict";var d=a.r(24361),e=a.r(34867),f=a.r(30145),g=a.r(10950),h=a.r(61123),i=a.r(46987),j=function(a){f.call(this,null,null,a),this._http=new e("request")};d.inherits(j,f);var k={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(a){if(this._delegate)return this._delegate.parse(a);if(this._http.parse(a),this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var b=this;this._delegate=j.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(a){this._delegate.on(a,function(c){b.emit(a,c)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new f.ConnectEvent)}},_open:function(){this.__queue.forEach(function(a){this._delegate[a[0]].apply(this._delegate,a[1])},this),this.__queue=[]}};for(var l in["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(a){k[a]=function(){return this._delegate?this._delegate[a].apply(this._delegate,arguments):(this.__queue.push([a,arguments]),!0)}}),k)j.prototype[l]=k[l];j.isSecureRequest=function(a){if(a.connection&&void 0!==a.connection.authorized||a.socket&&a.socket.secure)return!0;var b=a.headers;return!!b&&("on"===b.https||"on"===b["x-forwarded-ssl"]||"https"===b["x-forwarded-scheme"]||"https"===b["x-forwarded-proto"])},j.determineUrl=function(a){return(this.isSecureRequest(a)?"wss:":"ws:")+"//"+a.headers.host+a.url},j.http=function(a,b){void 0===(b=b||{}).requireMasking&&(b.requireMasking=!0);var c=a.headers,d=c["sec-websocket-version"],e=c["sec-websocket-key"],f=c["sec-websocket-key1"],j=c["sec-websocket-key2"],k=this.determineUrl(a);return d||e?new i(a,k,b):f||j?new h(a,k,b):new g(a,k,b)},b.exports=j},38398,(a,b,c)=>{"use strict";var d=a.r(30145),e=a.r(17737),f=a.r(89048);b.exports={client:function(a,b){return void 0===(b=b||{}).masking&&(b.masking=!0),new e(a,b)},server:function(a){return void 0===(a=a||{}).requireMasking&&(a.requireMasking=!0),new f(a)},http:function(){return f.http.apply(f,arguments)},isSecureRequest:function(a){return f.isSecureRequest(a)},isWebSocket:function(a){return d.isWebSocket(a)},validateOptions:function(a,b){d.validateOptions(a,b)}}},59808,(a,b,c)=>{"use strict";var d=function(a,b){for(var c in this.type=a,b)this[c]=b[c]};d.prototype.initEvent=function(a,b,c){this.type=a,this.bubbles=b,this.cancelable=c},d.prototype.stopPropagation=function(){},d.prototype.preventDefault=function(){},d.CAPTURING_PHASE=1,d.AT_TARGET=2,d.BUBBLING_PHASE=3,b.exports=d},1738,(a,b,c)=>{"use strict";var d=a.r(59808);b.exports={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(a,b,c){this.on(a,b)},removeEventListener:function(a,b,c){this.removeListener(a,b)},dispatchEvent:function(a){a.target=a.currentTarget=this,a.eventPhase=d.AT_TARGET,this["on"+a.type]&&this["on"+a.type](a),this.emit(a.type,a)}}},79136,(a,b,c)=>{"use strict";var d=a.r(88947).Stream,e=a.r(24361),f=a.r(38398),g=a.r(1738),h=a.r(59808),i=function(a){a=a||{},f.validateOptions(a,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var b=a.headers;if(b)for(var c in b)this._driver.setHeader(c,b[c]);var d=a.extensions;d&&[].concat(d).forEach(this._driver.addExtension,this._driver),this._ping=a.ping,this._pingId=0,this.readyState=i.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var e=this;this._driver.on("open",function(a){e._open()}),this._driver.on("message",function(a){e._receiveMessage(a.data)}),this._driver.on("close",function(a){e._beginClose(a.reason,a.code)}),this._driver.on("error",function(a){e._emitError(a.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){e.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){e._pingId+=1,e.ping(e._pingId.toString())},1e3*this._ping)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};e.inherits(i,d),i.CONNECTING=0,i.OPEN=1,i.CLOSING=2,i.CLOSED=3,i.CLOSE_TIMEOUT=3e4;var j={write:function(a){return this.send(a)},end:function(a){void 0!==a&&this.send(a),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(a){return!(this.readyState>i.OPEN)&&(a instanceof Buffer||(a=String(a)),this._driver.messages.write(a))},ping:function(a,b){return!(this.readyState>i.OPEN)&&this._driver.ping(a,b)},close:function(a,b){if(void 0===a&&(a=1e3),void 0===b&&(b=""),1e3!==a&&(a<3e3||a>4999))throw Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+a+" is neither.");if(this.readyState<i.CLOSING){var c=this;this._closeTimer=setTimeout(function(){c._beginClose("",1006)},i.CLOSE_TIMEOUT)}this.readyState!==i.CLOSED&&(this.readyState=i.CLOSING),this._driver.close(b,a)},_configureStream:function(){var a=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(b){this._stream.on(b,function(){a._finalizeClose()})},this),this._stream.on("error",function(b){a._emitError("Network error: "+a.url+": "+b.message),a._finalizeClose()})},_open:function(){if(this.readyState===i.CONNECTING){this.readyState=i.OPEN,this.protocol=this._driver.protocol||"";var a=new h("open");a.initEvent("open",!1,!1),this.dispatchEvent(a)}},_receiveMessage:function(a){if(this.readyState>i.OPEN)return!1;this.readable&&this.emit("data",a);var b=new h("message",{data:a});b.initEvent("message",!1,!1),this.dispatchEvent(b)},_emitError:function(a){if(!(this.readyState>=i.CLOSING)){var b=new h("error",{message:a});b.initEvent("error",!1,!1),this.dispatchEvent(b)}},_beginClose:function(a,b){this.readyState!==i.CLOSED&&(this.readyState=i.CLOSING,this._closeParams=[a,b],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==i.CLOSED){this.readyState=i.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var a=this._closeParams?this._closeParams[0]:"",b=new h("close",{code:this._closeParams?this._closeParams[1]:1006,reason:a});b.initEvent("close",!1,!1),this.dispatchEvent(b)}}};for(var k in j)i.prototype[k]=j[k];for(var l in g)i.prototype[l]=g[l];b.exports=i},4446,(a,b,c)=>{b.exports=a.x("net",()=>require("net"))},55004,(a,b,c)=>{b.exports=a.x("tls",()=>require("tls"))},85053,(a,b,c)=>{"use strict";var d=a.r(24361),e=a.r(4446),f=a.r(55004),g=a.r(92509),h=a.r(38398),i=a.r(79136);a.r(59808);var j={"http:":80,"https:":443,"ws:":80,"wss:":443},k=["https:","wss:"],l=function(a,b,c){c=c||{},this.url=a,this._driver=h.client(this.url,{maxLength:c.maxLength,protocols:b}),["open","error"].forEach(function(a){this._driver.on(a,function(){s.headers=s._driver.headers,s.statusCode=s._driver.statusCode})},this);var d=c.proxy||{},l=g.parse(d.origin||this.url),m=l.port||j[l.protocol],n=k.indexOf(l.protocol)>=0,o=function(){s._onConnect()},p=c.net||{},q=c.tls||{},r=d.origin?d.tls||{}:q,s=this;p.host=r.host=l.hostname,p.port=r.port=m,q.ca=q.ca||c.ca,r.servername=r.servername||l.hostname,this._stream=n?f.connect(r,o):e.connect(p,o),d.origin&&this._configureProxy(d,q),i.call(this,c)};d.inherits(l,i),l.prototype._onConnect=function(){(this._proxy||this._driver).start()},l.prototype._configureProxy=function(a,b){var c,d=g.parse(this.url),e=k.indexOf(d.protocol)>=0,h=this;if(this._proxy=this._driver.proxy(a.origin),a.headers)for(c in a.headers)this._proxy.setHeader(c,a.headers[c]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(e){var a={socket:h._stream,servername:d.hostname};for(c in b)a[c]=b[c];h._stream=f.connect(a),h._configureStream()}h._driver.io.pipe(h._stream),h._stream.pipe(h._driver.io),h._driver.start()}),this._proxy.on("error",function(a){h._driver.emit("error",a)})},b.exports=l},92173,(a,b,c)=>{"use strict";var d=a.r(88947).Stream,e=a.r(24361),f=a.r(38398),g=a.r(86562),h=a.r(79136),i=a.r(1738),j=a.r(59808),k=function(a,b,c){this.writable=!0,c=c||{},this._stream=b.socket,this._ping=c.ping||this.DEFAULT_PING,this._retry=c.retry||this.DEFAULT_RETRY;var d=f.isSecureRequest(a)?"https:":"http:";this.url=d+"//"+a.headers.host+a.url,this.lastEventId=a.headers["last-event-id"]||"",this.readyState=h.CONNECTING;var e=new g,i=this;if(c.headers)for(var j in c.headers)e.set(j,c.headers[j]);if(this._stream&&this._stream.writable){process.nextTick(function(){i._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var k="HTTP/1.1 200 OK\r\nContent-Type: text/event-stream\r\nCache-Control: no-cache, no-store\r\nConnection: close\r\n"+e.toString()+"\r\nretry: "+Math.floor(1e3*this._retry)+"\r\n\r\n";this._write(k),this._stream.on("drain",function(){i.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){i.ping()},1e3*this._ping)),["error","end"].forEach(function(a){i._stream.on(a,function(){i.close()})})}};e.inherits(k,d),k.isEventSource=function(a){return"GET"===a.method&&(a.headers.accept||"").split(/\s*,\s*/).indexOf("text/event-stream")>=0};var l={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(a){if(!this.writable)return!1;try{return this._stream.write(a,"utf8")}catch(a){return!1}},_open:function(){if(this.readyState===h.CONNECTING){this.readyState=h.OPEN;var a=new j("open");a.initEvent("open",!1,!1),this.dispatchEvent(a)}},write:function(a){return this.send(a)},end:function(a){void 0!==a&&this.write(a),this.close()},send:function(a,b){if(this.readyState>h.OPEN)return!1;a=String(a).replace(/(\r\n|\r|\n)/g,"$1data: ");var c="";return(b=b||{}).event&&(c+="event: "+b.event+"\r\n"),b.id&&(c+="id: "+b.id+"\r\n"),c+="data: "+a+"\r\n\r\n",this._write(c)},ping:function(){return this._write(":\r\n\r\n")},close:function(){if(this.readyState>h.OPEN)return!1;this.readyState=h.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var a=new j("close");return a.initEvent("close",!1,!1),this.dispatchEvent(a),!0}};for(var m in l)k.prototype[m]=l[m];for(var n in i)k.prototype[n]=i[n];b.exports=k},47760,(a,b,c)=>{"use strict";var d=a.r(24361),e=a.r(38398),f=a.r(79136),g=function(a,b,c,d,g){g=g||{},this._stream=b,this._driver=e.http(a,{maxLength:g.maxLength,protocols:d});var h=this;if(this._stream&&this._stream.writable){if(!this._stream.readable)return this._stream.end();var i=function(){h._stream.removeListener("data",i)};this._stream.on("data",i),f.call(this,g),process.nextTick(function(){h._driver.start(),h._driver.io.write(c)})}};d.inherits(g,f),g.isWebSocket=function(a){return e.isWebSocket(a)},g.validateOptions=function(a,b){e.validateOptions(a,b)},g.WebSocket=g,g.Client=a.r(85053),g.EventSource=a.r(92173),b.exports=g},21877,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;var r,s,t,u,v=a.i(87924),w=a.i(72131),x=a.i(50944),y=a.i(56025),z=a.i(44394),A=a.i(96101),B=a.i(69922),C=a.i(87534),D=a.i(45222),E=a.i(86520),F=a.i(70106);let G=(0,F.default)("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),H=(0,F.default)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var I=a.i(35133);let J=(0,F.default)("CloudOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]]),K=(0,F.default)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),L=(0,F.default)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),M=(0,F.default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var N=a.i(83674),O=a.i(33508),P=a.i(81560);let Q=(0,F.default)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),R=(0,F.default)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var S=a.i(3314);let T=(0,F.default)("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]),U=(0,F.default)("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);var V=a.i(42029),W=a.i(36408);function X({isOpen:a,onClose:b}){let{user:c,logout:d}=(0,y.useAuth)(),{theme:e,toggleTheme:f}=(0,V.useTheme)(),[g,h]=(0,w.useState)(!1),[i,j]=(0,w.useState)(!1);if(!a)return null;let k=async()=>{j(!0);try{for(let a of(await (0,W.sendAccountDeletedNotification)(c),localStorage.clear(),await indexedDB.databases()))a.name&&indexedDB.deleteDatabase(a.name);d(),b()}catch(a){console.error("Error deleting account:",a),j(!1)}};return(0,v.jsx)("div",{className:"settings-overlay",onClick:b,children:(0,v.jsxs)("div",{className:"settings-modal",onClick:a=>a.stopPropagation(),children:[(0,v.jsxs)("div",{className:"settings-header",children:[(0,v.jsx)("h2",{children:"Settings"}),(0,v.jsx)("button",{className:"close-btn",onClick:b,children:(0,v.jsx)(O.X,{size:20})})]}),(0,v.jsxs)("div",{className:"settings-content",children:[(0,v.jsxs)("div",{className:"settings-section",children:[(0,v.jsxs)("h3",{children:[(0,v.jsx)(R,{size:16})," Account"]}),(0,v.jsxs)("div",{className:"account-info",children:[c?.picture&&(0,v.jsx)("img",{src:c.picture,alt:c.name,className:"account-avatar"}),(0,v.jsxs)("div",{className:"account-details",children:[(0,v.jsx)("span",{className:"account-name",children:c?.name||"User"}),(0,v.jsx)("span",{className:"account-email",children:c?.email||""})]})]})]}),(0,v.jsxs)("div",{className:"settings-section",children:[(0,v.jsxs)("h3",{children:[(0,v.jsx)(T,{size:16})," Appearance"]}),(0,v.jsxs)("div",{className:"theme-toggle-container",children:[(0,v.jsx)("span",{className:"theme-label",children:"Theme"}),(0,v.jsxs)("button",{className:"theme-toggle-btn",onClick:f,"aria-label":"Toggle theme",children:["light"===e?(0,v.jsx)(T,{size:18}):(0,v.jsx)(U,{size:18}),(0,v.jsx)("span",{children:"light"===e?"Dark Mode":"Light Mode"})]})]})]}),(0,v.jsxs)("div",{className:"settings-section",children:[(0,v.jsxs)("h3",{children:[(0,v.jsx)(S.Shield,{size:16})," Actions"]}),(0,v.jsxs)("button",{className:"settings-action-btn",onClick:()=>{d(),b()},children:[(0,v.jsx)(Q,{size:18}),(0,v.jsx)("span",{children:"Sign Out"})]})]}),(0,v.jsxs)("div",{className:"settings-section danger-zone",children:[(0,v.jsxs)("h3",{children:[(0,v.jsx)(P.Trash2,{size:16})," Danger Zone"]}),g?(0,v.jsxs)("div",{className:"delete-confirm",children:[(0,v.jsx)("p",{children:"Are you sure? This will delete all your local data. Your Google Drive files will remain."}),(0,v.jsxs)("div",{className:"delete-actions",children:[(0,v.jsx)("button",{className:"cancel-btn",onClick:()=>h(!1),children:"Cancel"}),(0,v.jsx)("button",{className:"confirm-delete-btn",onClick:k,disabled:i,children:i?"Deleting...":"Yes, Delete"})]})]}):(0,v.jsxs)("button",{className:"delete-account-btn",onClick:()=>h(!0),children:[(0,v.jsx)(P.Trash2,{size:18}),(0,v.jsx)("span",{children:"Delete Account"})]})]})]})]})})}let Y=[{id:"dashboard",label:"Dashboard",icon:G},{id:"files",label:"Files",icon:A.FolderOpen},{id:"links",label:"Links",icon:B.Link2},{id:"todos",label:"To-Do List",icon:C.CheckSquare},{id:"chats",label:"Chats",icon:D.MessageCircle},{id:"subscription",label:"Subscription",icon:E.Crown}];function Z({activeSection:a,onSectionChange:b}){let{isAuthenticated:c,accessToken:d,login:e}=(0,y.useAuth)(),[f,g]=(0,w.useState)(!1),[h,i]=(0,w.useState)(window.innerWidth<=1024),[j,k]=(0,w.useState)(null),[l,m]=(0,w.useState)(!1),[n,o]=(0,w.useState)(!1);(0,w.useEffect)(()=>{let a=()=>{i(window.innerWidth<=1024)};return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),(0,w.useEffect)(()=>{h&&g(!0)},[h]);let p=(0,w.useCallback)(async()=>{if(d){m(!0);try{let a=await (0,N.getDriveQuota)(d);if(console.log("Drive quota response:",a),a.storageQuota){let b={used:parseInt(a.storageQuota.usage||0),limit:parseInt(a.storageQuota.limit||0x3c0000000),usedInDrive:parseInt(a.storageQuota.usageInDrive||0)};console.log("Setting driveStorage:",b),k(b)}else a.error&&console.error("Drive API error:",a.error)}catch(a){console.error("Error fetching Drive storage:",a)}finally{m(!1)}}},[d]);(0,w.useEffect)(()=>{if(c&&d){p();let a=setInterval(p,3e4);return()=>clearInterval(a)}},[c,d,p]);let q=a=>{if(0===a)return"0 B";let b=Math.floor(Math.log(a)/Math.log(1024));return parseFloat((a/Math.pow(1024,b)).toFixed(2))+" "+["B","KB","MB","GB","TB"][b]},r=c&&j?{percentage:Math.min(j.used/j.limit*100,100),used:q(j.used),total:q(j.limit),isCloud:!0}:null;return(0,v.jsxs)(v.Fragment,{children:[h&&!f&&(0,v.jsx)("div",{className:"sidebar-overlay",onClick:()=>g(!0)}),(0,v.jsxs)("aside",{className:`sidebar ${f?"collapsed":""}`,children:[(0,v.jsxs)("div",{className:"sidebar-header",children:[(0,v.jsxs)("div",{className:"sidebar-logo",children:[(0,v.jsx)("div",{className:"logo-icon",children:(0,v.jsx)("span",{children:"A"})}),!f&&(0,v.jsx)("span",{className:"logo-text",children:"AnyDo"})]}),(0,v.jsx)("button",{className:"collapse-btn",onClick:()=>g(!f),"aria-label":f?"Expand sidebar":"Collapse sidebar",children:f?(0,v.jsx)(L,{size:18}):(0,v.jsx)(K,{size:18})})]}),(0,v.jsx)("nav",{className:"sidebar-nav",children:(0,v.jsx)("ul",{className:"nav-list",children:Y.map(c=>(0,v.jsx)("li",{children:(0,v.jsxs)("button",{className:`nav-item ${a===c.id?"active":""}`,onClick:()=>{b(c.id),h&&g(!0)},title:f?c.label:void 0,children:[(0,v.jsx)(c.icon,{size:20}),!f&&(0,v.jsx)("span",{children:c.label}),!f&&a===c.id&&(0,v.jsx)("div",{className:"nav-indicator"})]})},c.id))})}),(0,v.jsxs)("div",{className:"sidebar-footer",children:[c&&(0,v.jsx)("div",{className:`storage-indicator ${f?"collapsed":""}`,children:r?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"storage-header",children:[(0,v.jsx)(I.Cloud,{size:16,className:"cloud-icon"}),!f&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{children:"Google Drive"}),(0,v.jsx)("button",{className:`refresh-btn ${l?"spinning":""}`,onClick:p,title:"Refresh storage info",children:(0,v.jsx)(M,{size:12})})]})]}),!f&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"storage-bar",children:(0,v.jsx)("div",{className:"storage-fill cloud",style:{width:`${r.percentage}%`}})}),(0,v.jsxs)("div",{className:"storage-text",children:[r.used," / ",r.total]}),(0,v.jsxs)("div",{className:"storage-status",children:[(0,v.jsx)("span",{className:"status-dot online"}),"Synced to cloud"]})]})]}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"storage-header",children:[(0,v.jsx)(J,{size:16,className:"cloud-error-icon"}),!f&&(0,v.jsx)("span",{children:"Drive Access"})]}),!f&&(0,v.jsxs)("div",{className:"drive-access-needed",children:[(0,v.jsx)("p",{children:"Enable Google Drive to store your data"}),(0,v.jsx)("button",{className:"grant-access-btn",onClick:e,children:"Grant Access"})]})]})}),(0,v.jsxs)("button",{className:"nav-item settings-btn",title:f?"Settings":void 0,onClick:()=>o(!0),children:[(0,v.jsx)(H,{size:20}),!f&&(0,v.jsx)("span",{children:"Settings"})]})]})]}),(0,v.jsx)(X,{isOpen:n,onClose:()=>o(!1)})]})}let $=(0,F.default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);var _=a.i(15618);let aa=(0,F.default)("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);function ab({onSearch:a,onAddClick:b,onMenuClick:c,showMobileMenu:d,onSync:e,isSyncing:f,onMenuChange:g}){let{user:h,isAuthenticated:i,logout:j}=(0,y.useAuth)(),[k,l]=(0,w.useState)(""),[m,n]=(0,w.useState)(!1),[o,p]=(0,w.useState)(!1),q=(0,w.useRef)(null);return(0,w.useEffect)(()=>{let a=a=>{q.current&&!q.current.contains(a.target)&&p(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),(0,v.jsx)("header",{className:"navbar",children:(0,v.jsxs)("div",{className:"navbar-inner",children:[(0,v.jsx)("button",{className:"mobile-menu-btn",onClick:c,children:d?(0,v.jsx)(O.X,{size:22}):(0,v.jsx)(aa,{size:22})}),(0,v.jsxs)("div",{className:`search-container ${m?"focused":""}`,children:[(0,v.jsx)($,{size:18,className:"search-icon"}),(0,v.jsx)("input",{type:"text",placeholder:"Search files, links, todos...",value:k,onChange:b=>{let c=b.target.value;l(c),a?.(c)},onFocus:()=>n(!0),onBlur:()=>n(!1),className:"search-input"}),k&&(0,v.jsx)("button",{className:"search-clear",onClick:()=>{l(""),a?.("")},children:(0,v.jsx)(O.X,{size:14})})]}),(0,v.jsxs)("div",{className:"navbar-actions",children:[i&&(0,v.jsxs)("button",{className:`sync-btn ${f?"syncing":""}`,onClick:e,title:"Sync to Google Drive",children:[(0,v.jsx)(I.Cloud,{size:18}),(0,v.jsx)("span",{className:"sync-text",children:f?"Syncing...":"Sync"})]}),(0,v.jsxs)("button",{className:"btn btn-primary add-btn",onClick:b,children:[(0,v.jsx)(_.Plus,{size:18}),(0,v.jsx)("span",{className:"add-btn-text",children:"Add New"})]})]}),(0,v.jsxs)("div",{className:"user-menu-container",ref:q,children:[(0,v.jsxs)("button",{className:"subscription-nav-btn",onClick:()=>g?.("subscription"),title:"Subscription Plans",children:[(0,v.jsx)(E.Crown,{size:20}),(0,v.jsx)("span",{className:"premium-badge",children:"PRO"})]}),i&&h?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("button",{className:"user-avatar-btn",onClick:()=>p(!o),children:h.picture?(0,v.jsx)("img",{src:h.picture,alt:h.name,className:"user-avatar"}):(0,v.jsx)("div",{className:"user-avatar-placeholder",children:(0,v.jsx)(R,{size:18})})}),o&&(0,v.jsxs)("div",{className:"user-dropdown",children:[(0,v.jsxs)("div",{className:"user-info",children:[h.picture&&(0,v.jsx)("img",{src:h.picture,alt:h.name,className:"dropdown-avatar"}),(0,v.jsxs)("div",{className:"user-details",children:[(0,v.jsx)("span",{className:"user-name",children:h.name}),(0,v.jsx)("span",{className:"user-email",children:h.email})]})]}),(0,v.jsx)("div",{className:"dropdown-divider"}),(0,v.jsxs)("button",{className:"dropdown-item",onClick:j,children:[(0,v.jsx)(Q,{size:16}),"Sign out"]})]})]}):(0,v.jsx)("div",{className:"offline-indicator",title:"Offline mode",children:(0,v.jsx)(J,{size:18})})]})]})})}function ac(){let{login:a,isLoading:b}=(0,y.useAuth)();return b?(0,v.jsx)("div",{className:"login-screen",children:(0,v.jsxs)("div",{className:"login-loader",children:[(0,v.jsx)("div",{className:"loader-spinner"}),(0,v.jsx)("p",{children:"Loading..."})]})}):(0,v.jsxs)("div",{className:"login-screen",children:[(0,v.jsxs)("div",{className:"login-card",children:[(0,v.jsxs)("div",{className:"login-header",children:[(0,v.jsx)("div",{className:"login-logo",children:(0,v.jsx)("span",{children:"A"})}),(0,v.jsx)("h1",{children:"AnyDo"}),(0,v.jsx)("p",{children:"Universal File Storage"})]}),(0,v.jsxs)("div",{className:"login-features",children:[(0,v.jsxs)("div",{className:"feature",children:[(0,v.jsx)(I.Cloud,{size:20}),(0,v.jsx)("span",{children:"15 GB Free Cloud Storage"})]}),(0,v.jsxs)("div",{className:"feature",children:[(0,v.jsx)("span",{children:""}),(0,v.jsx)("span",{children:"Store Files, Links, Todos, Chats"})]}),(0,v.jsxs)("div",{className:"feature",children:[(0,v.jsx)("span",{children:""}),(0,v.jsx)("span",{children:"Sync Across All Devices"})]})]}),(0,v.jsxs)("button",{className:"google-login-btn",onClick:a,children:[(0,v.jsxs)("svg",{viewBox:"0 0 24 24",width:"20",height:"20",children:[(0,v.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,v.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,v.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,v.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),(0,v.jsx)("span",{children:"Sign in with Google"})]}),(0,v.jsx)("p",{className:"login-note",children:"Sign in to access your files and data stored in Google Drive"})]}),(0,v.jsxs)("div",{className:"login-bg-effects",children:[(0,v.jsx)("div",{className:"bg-orb orb-1"}),(0,v.jsx)("div",{className:"bg-orb orb-2"}),(0,v.jsx)("div",{className:"bg-orb orb-3"})]})]})}let ad=(0,F.default)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),ae=(0,F.default)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),af=(0,F.default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),ag={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},ah=function(a,b){if(!a)throw ai(b)},ai=function(a){return Error("Firebase Database ("+ag.SDK_VERSION+") INTERNAL ASSERT FAILED: "+a)},aj=function(a){let b=[],c=0;for(let d=0;d<a.length;d++){let e=a.charCodeAt(d);e<128?b[c++]=e:(e<2048?b[c++]=e>>6|192:((64512&e)==55296&&d+1<a.length&&(64512&a.charCodeAt(d+1))==56320?(e=65536+((1023&e)<<10)+(1023&a.charCodeAt(++d)),b[c++]=e>>18|240,b[c++]=e>>12&63|128):b[c++]=e>>12|224,b[c++]=e>>6&63|128),b[c++]=63&e|128)}return b},ak=function(a){let b=[],c=0,d=0;for(;c<a.length;){let e=a[c++];if(e<128)b[d++]=String.fromCharCode(e);else if(e>191&&e<224){let f=a[c++];b[d++]=String.fromCharCode((31&e)<<6|63&f)}else if(e>239&&e<365){let f=((7&e)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536;b[d++]=String.fromCharCode(55296+(f>>10)),b[d++]=String.fromCharCode(56320+(1023&f))}else{let f=a[c++],g=a[c++];b[d++]=String.fromCharCode((15&e)<<12|(63&f)<<6|63&g)}}return b.join("")},al={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(a,b){if(!Array.isArray(a))throw Error("encodeByteArray takes an array as a parameter");this.init_();let c=b?this.byteToCharMapWebSafe_:this.byteToCharMap_,d=[];for(let b=0;b<a.length;b+=3){let e=a[b],f=b+1<a.length,g=f?a[b+1]:0,h=b+2<a.length,i=h?a[b+2]:0,j=e>>2,k=(3&e)<<4|g>>4,l=(15&g)<<2|i>>6,m=63&i;!h&&(m=64,f||(l=64)),d.push(c[j],c[k],c[l],c[m])}return d.join("")},encodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?btoa(a):this.encodeByteArray(aj(a),b)},decodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?atob(a):ak(this.decodeStringToByteArray(a,b))},decodeStringToByteArray(a,b){this.init_();let c=b?this.charToByteMapWebSafe_:this.charToByteMap_,d=[];for(let b=0;b<a.length;){let e=c[a.charAt(b++)],f=b<a.length?c[a.charAt(b)]:0,g=++b<a.length?c[a.charAt(b)]:64,h=++b<a.length?c[a.charAt(b)]:64;if(++b,null==e||null==f||null==g||null==h)throw new am;let i=e<<2|f>>4;if(d.push(i),64!==g){let a=f<<4&240|g>>2;if(d.push(a),64!==h){let a=g<<6&192|h;d.push(a)}}}return d},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let a=0;a<this.ENCODED_VALS.length;a++)this.byteToCharMap_[a]=this.ENCODED_VALS.charAt(a),this.charToByteMap_[this.byteToCharMap_[a]]=a,this.byteToCharMapWebSafe_[a]=this.ENCODED_VALS_WEBSAFE.charAt(a),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[a]]=a,a>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(a)]=a,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(a)]=a)}}};class am extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let an=function(a){let b=aj(a);return al.encodeByteArray(b,!0)},ao=function(a){return an(a).replace(/\./g,"")},ap=function(a){try{return al.decodeString(a,!0)}catch(a){console.error("base64Decode failed: ",a)}return null},aq=()=>{try{return("u">typeof self?self:a.g).__FIREBASE_DEFAULTS__||(()=>{if("u"<typeof process||void 0===process.env)return;let a=process.env.__FIREBASE_DEFAULTS__;if(a)return JSON.parse(a)})()||(()=>{let a;if("u"<typeof document)return;try{a=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(a){return}let b=a&&ap(a[1]);return b&&JSON.parse(b)})()}catch(a){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${a}`);return}},ar=()=>aq()?.config;class as{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}wrapCallback(a){return(b,c)=>{b?this.reject(b):this.resolve(c),"function"==typeof a&&(this.promise.catch(()=>{}),1===a.length?a(b):a(b,c))}}}function at(a){try{return(a.startsWith("http://")||a.startsWith("https://")?new URL(a).hostname:a).endsWith(".cloudworkstations.dev")}catch{return!1}}async function au(a){return(await fetch(a,{credentials:"include"})).ok}function av(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function aw(){return!0===ag.NODE_CLIENT||!0===ag.NODE_ADMIN}class ax extends Error{constructor(a,b,c){super(b),this.code=a,this.customData=c,this.name="FirebaseError",Object.setPrototypeOf(this,ax.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ay.prototype.create)}}class ay{constructor(a,b,c){this.service=a,this.serviceName=b,this.errors=c}create(a,...b){var c,d;let e=b[0]||{},f=`${this.service}/${a}`,g=this.errors[a],h=g?(c=g,d=e,c.replace(az,(a,b)=>{let c=d[b];return null!=c?String(c):`<${b}?>`})):"Error",i=`${this.serviceName}: ${h} (${f}).`;return new ax(f,i,e)}}let az=/\{\$([^}]+)}/g;function aA(a){return JSON.parse(a)}function aB(a){return JSON.stringify(a)}let aC=function(a){let b={},c={},d={},e="";try{let f=a.split(".");b=aA(ap(f[0])||""),c=aA(ap(f[1])||""),e=f[2],d=c.d||{},delete c.d}catch(a){}return{header:b,claims:c,data:d,signature:e}},aD=function(a){let b=aC(a).claims;return!!b&&"object"==typeof b&&b.hasOwnProperty("iat")},aE=function(a){let b=aC(a).claims;return"object"==typeof b&&!0===b.admin};function aF(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function aG(a,b){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:void 0}function aH(a){for(let b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0}function aI(a,b,c){let d={};for(let e in a)Object.prototype.hasOwnProperty.call(a,e)&&(d[e]=b.call(c,a[e],e,a));return d}function aJ(a,b){if(a===b)return!0;let c=Object.keys(a),d=Object.keys(b);for(let e of c){if(!d.includes(e))return!1;let c=a[e],f=b[e];if(aK(c)&&aK(f)){if(!aJ(c,f))return!1}else if(c!==f)return!1}for(let a of d)if(!c.includes(a))return!1;return!0}function aK(a){return null!==a&&"object"==typeof a}class aL{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let a=1;a<this.blockSize;++a)this.pad_[a]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(a,b){let c,d;b||(b=0);let e=this.W_;if("string"==typeof a)for(let c=0;c<16;c++)e[c]=a.charCodeAt(b)<<24|a.charCodeAt(b+1)<<16|a.charCodeAt(b+2)<<8|a.charCodeAt(b+3),b+=4;else for(let c=0;c<16;c++)e[c]=a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3],b+=4;for(let a=16;a<80;a++){let b=e[a-3]^e[a-8]^e[a-14]^e[a-16];e[a]=(b<<1|b>>>31)&0xffffffff}let f=this.chain_[0],g=this.chain_[1],h=this.chain_[2],i=this.chain_[3],j=this.chain_[4];for(let a=0;a<80;a++){a<40?a<20?(c=i^g&(h^i),d=0x5a827999):(c=g^h^i,d=0x6ed9eba1):a<60?(c=g&h|i&(g|h),d=0x8f1bbcdc):(c=g^h^i,d=0xca62c1d6);let b=(f<<5|f>>>27)+c+j+d+e[a]|0;j=i,i=h,h=(g<<30|g>>>2)&0xffffffff,g=f,f=b}this.chain_[0]=this.chain_[0]+f|0,this.chain_[1]=this.chain_[1]+g|0,this.chain_[2]=this.chain_[2]+h|0,this.chain_[3]=this.chain_[3]+i|0,this.chain_[4]=this.chain_[4]+j|0}update(a,b){if(null==a)return;void 0===b&&(b=a.length);let c=b-this.blockSize,d=0,e=this.buf_,f=this.inbuf_;for(;d<b;){if(0===f)for(;d<=c;)this.compress_(a,d),d+=this.blockSize;if("string"==typeof a){for(;d<b;)if(e[f]=a.charCodeAt(d),++f,++d,f===this.blockSize){this.compress_(e),f=0;break}}else for(;d<b;)if(e[f]=a[d],++f,++d,f===this.blockSize){this.compress_(e),f=0;break}}this.inbuf_=f,this.total_+=b}digest(){let a=[],b=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let a=this.blockSize-1;a>=56;a--)this.buf_[a]=255&b,b/=256;this.compress_(this.buf_);let c=0;for(let b=0;b<5;b++)for(let d=24;d>=0;d-=8)a[c]=this.chain_[b]>>d&255,++c;return a}}function aM(a,b){return`${a} failed: ${b} argument `}let aN=function(a){let b=[],c=0;for(let d=0;d<a.length;d++){let e=a.charCodeAt(d);if(e>=55296&&e<=56319){let b=e-55296;ah(++d<a.length,"Surrogate pair missing trail surrogate."),e=65536+(b<<10)+(a.charCodeAt(d)-56320)}e<128?b[c++]=e:(e<2048?b[c++]=e>>6|192:(e<65536?b[c++]=e>>12|224:(b[c++]=e>>18|240,b[c++]=e>>12&63|128),b[c++]=e>>6&63|128),b[c++]=63&e|128)}return b},aO=function(a){let b=0;for(let c=0;c<a.length;c++){let d=a.charCodeAt(c);d<128?b++:d<2048?b+=2:d>=55296&&d<=56319?(b+=4,c++):b+=3}return b};function aP(a){return a&&a._delegate?a._delegate:a}ag.NODE_CLIENT=!0;class aQ{constructor(a,b,c){this.name=a,this.instanceFactory=b,this.type=c,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(a){return this.instantiationMode=a,this}setMultipleInstances(a){return this.multipleInstances=a,this}setServiceProps(a){return this.serviceProps=a,this}setInstanceCreatedCallback(a){return this.onInstanceCreated=a,this}}let aR="[DEFAULT]";class aS{constructor(a,b){this.name=a,this.container=b,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(a){let b=this.normalizeInstanceIdentifier(a);if(!this.instancesDeferred.has(b)){let a=new as;if(this.instancesDeferred.set(b,a),this.isInitialized(b)||this.shouldAutoInitialize())try{let c=this.getOrInitializeService({instanceIdentifier:b});c&&a.resolve(c)}catch(a){}}return this.instancesDeferred.get(b).promise}getImmediate(a){let b=this.normalizeInstanceIdentifier(a?.identifier),c=a?.optional??!1;if(this.isInitialized(b)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:b})}catch(a){if(c)return null;throw a}if(c)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(a){if(a.name!==this.name)throw Error(`Mismatching Component ${a.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=a,this.shouldAutoInitialize()){if("EAGER"===a.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:aR})}catch(a){}for(let[a,b]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(a);try{let a=this.getOrInitializeService({instanceIdentifier:c});b.resolve(a)}catch(a){}}}}clearInstance(a=aR){this.instancesDeferred.delete(a),this.instancesOptions.delete(a),this.instances.delete(a)}async delete(){let a=Array.from(this.instances.values());await Promise.all([...a.filter(a=>"INTERNAL"in a).map(a=>a.INTERNAL.delete()),...a.filter(a=>"_delete"in a).map(a=>a._delete())])}isComponentSet(){return null!=this.component}isInitialized(a=aR){return this.instances.has(a)}getOptions(a=aR){return this.instancesOptions.get(a)||{}}initialize(a={}){let{options:b={}}=a,c=this.normalizeInstanceIdentifier(a.instanceIdentifier);if(this.isInitialized(c))throw Error(`${this.name}(${c}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let d=this.getOrInitializeService({instanceIdentifier:c,options:b});for(let[a,b]of this.instancesDeferred.entries())c===this.normalizeInstanceIdentifier(a)&&b.resolve(d);return d}onInit(a,b){let c=this.normalizeInstanceIdentifier(b),d=this.onInitCallbacks.get(c)??new Set;d.add(a),this.onInitCallbacks.set(c,d);let e=this.instances.get(c);return e&&a(e,c),()=>{d.delete(a)}}invokeOnInitCallbacks(a,b){let c=this.onInitCallbacks.get(b);if(c)for(let d of c)try{d(a,b)}catch{}}getOrInitializeService({instanceIdentifier:a,options:b={}}){var c;let d=this.instances.get(a);if(!d&&this.component&&(d=this.component.instanceFactory(this.container,{instanceIdentifier:(c=a)===aR?void 0:c,options:b}),this.instances.set(a,d),this.instancesOptions.set(a,b),this.invokeOnInitCallbacks(d,a),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,a,d)}catch{}return d||null}normalizeInstanceIdentifier(a=aR){return this.component?this.component.multipleInstances?a:aR:a}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class aT{constructor(a){this.name=a,this.providers=new Map}addComponent(a){let b=this.getProvider(a.name);if(b.isComponentSet())throw Error(`Component ${a.name} has already been registered with ${this.name}`);b.setComponent(a)}addOrOverwriteComponent(a){this.getProvider(a.name).isComponentSet()&&this.providers.delete(a.name),this.addComponent(a)}getProvider(a){if(this.providers.has(a))return this.providers.get(a);let b=new aS(a,this);return this.providers.set(a,b),b}getProviders(){return Array.from(this.providers.values())}}let aU=[];(r=t||(t={}))[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT";let aV={debug:t.DEBUG,verbose:t.VERBOSE,info:t.INFO,warn:t.WARN,error:t.ERROR,silent:t.SILENT},aW=t.INFO,aX={[t.DEBUG]:"log",[t.VERBOSE]:"log",[t.INFO]:"info",[t.WARN]:"warn",[t.ERROR]:"error"},aY=(a,b,...c)=>{if(b<a.logLevel)return;let d=new Date().toISOString(),e=aX[b];if(e)console[e](`[${d}]  ${a.name}:`,...c);else throw Error(`Attempted to log a message with an invalid logType (value: ${b})`)};class aZ{constructor(a){this.name=a,this._logLevel=aW,this._logHandler=aY,this._userLogHandler=null,aU.push(this)}get logLevel(){return this._logLevel}set logLevel(a){if(!(a in t))throw TypeError(`Invalid value "${a}" assigned to \`logLevel\``);this._logLevel=a}setLogLevel(a){this._logLevel="string"==typeof a?aV[a]:a}get logHandler(){return this._logHandler}set logHandler(a){if("function"!=typeof a)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=a}get userLogHandler(){return this._userLogHandler}set userLogHandler(a){this._userLogHandler=a}debug(...a){this._userLogHandler&&this._userLogHandler(this,t.DEBUG,...a),this._logHandler(this,t.DEBUG,...a)}log(...a){this._userLogHandler&&this._userLogHandler(this,t.VERBOSE,...a),this._logHandler(this,t.VERBOSE,...a)}info(...a){this._userLogHandler&&this._userLogHandler(this,t.INFO,...a),this._logHandler(this,t.INFO,...a)}warn(...a){this._userLogHandler&&this._userLogHandler(this,t.WARN,...a),this._logHandler(this,t.WARN,...a)}error(...a){this._userLogHandler&&this._userLogHandler(this,t.ERROR,...a),this._logHandler(this,t.ERROR,...a)}}let a$=new WeakMap,a_=new WeakMap,a0=new WeakMap,a1=new WeakMap,a2=new WeakMap,a3={get(a,b,c){if(a instanceof IDBTransaction){if("done"===b)return a_.get(a);if("objectStoreNames"===b)return a.objectStoreNames||a0.get(a);if("store"===b)return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return a4(a[b])},set:(a,b,c)=>(a[b]=c,!0),has:(a,b)=>a instanceof IDBTransaction&&("done"===b||"store"===b)||b in a};function a4(a){if(a instanceof IDBRequest){let b;return(b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("success",e),a.removeEventListener("error",f)},e=()=>{b(a4(a.result)),d()},f=()=>{c(a.error),d()};a.addEventListener("success",e),a.addEventListener("error",f)})).then(b=>{b instanceof IDBCursor&&a$.set(b,a)}).catch(()=>{}),a2.set(b,a),b}if(a1.has(a))return a1.get(a);let d=function(a){if("function"==typeof a)return a!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(c||(c=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(a)?function(...b){return a.apply(a5(this),b),a4(a$.get(this))}:function(...b){return a4(a.apply(a5(this),b))}:function(b,...c){let d=a.call(a5(this),b,...c);return a0.set(d,b.sort?b.sort():[b]),a4(d)};return a instanceof IDBTransaction&&function(a){if(a_.has(a))return;let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("complete",e),a.removeEventListener("error",f),a.removeEventListener("abort",f)},e=()=>{b(),d()},f=()=>{c(a.error||new DOMException("AbortError","AbortError")),d()};a.addEventListener("complete",e),a.addEventListener("error",f),a.addEventListener("abort",f)});a_.set(a,b)}(a),(b||(b=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(b=>a instanceof b)?new Proxy(a,a3):a}(a);return d!==a&&(a1.set(a,d),a2.set(d,a)),d}let a5=a=>a2.get(a),a6=["get","getKey","getAll","getAllKeys","count"],a7=["put","add","delete","clear"],a8=new Map;function a9(a,b){if(!(a instanceof IDBDatabase&&!(b in a)&&"string"==typeof b))return;if(a8.get(b))return a8.get(b);let c=b.replace(/FromIndex$/,""),d=b!==c,e=a7.includes(c);if(!(c in(d?IDBIndex:IDBObjectStore).prototype)||!(e||a6.includes(c)))return;let f=async function(a,...b){let f=this.transaction(a,e?"readwrite":"readonly"),g=f.store;return d&&(g=g.index(b.shift())),(await Promise.all([g[c](...b),e&&f.done]))[0]};return a8.set(b,f),f}a3={...q=a3,get:(a,b,c)=>a9(a,b)||q.get(a,b,c),has:(a,b)=>!!a9(a,b)||q.has(a,b)};class ba{constructor(a){this.container=a}getPlatformInfoString(){return this.container.getProviders().map(a=>{let b;if(b=a.getComponent(),b?.type!=="VERSION")return null;{let b=a.getImmediate();return`${b.library}/${b.version}`}}).filter(a=>a).join(" ")}}let bb="@firebase/app",bc="0.14.8",bd=new aZ("@firebase/app"),be="[DEFAULT]",bf={[bb]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},bg=new Map,bh=new Map,bi=new Map;function bj(a,b){try{a.container.addComponent(b)}catch(c){bd.debug(`Component ${b.name} failed to register with FirebaseApp ${a.name}`,c)}}function bk(a,b){a.container.addOrOverwriteComponent(b)}function bl(a){let b=a.name;if(bi.has(b))return bd.debug(`There were multiple attempts to register component ${b}.`),!1;for(let c of(bi.set(b,a),bg.values()))bj(c,a);for(let b of bh.values())bj(b,a);return!0}function bm(a,b){let c=a.container.getProvider("heartbeat").getImmediate({optional:!0});return c&&c.triggerHeartbeat(),a.container.getProvider(b)}function bn(a,b,c=be){bm(a,b).clearInstance(c)}function bo(a){return void 0!==a.options}function bp(a){return!bo(a)&&("authIdToken"in a||"appCheckToken"in a||"releaseOnDeref"in a||"automaticDataCollectionEnabled"in a)}function bq(a){return null!=a&&void 0!==a.settings}function br(){bi.clear()}let bs=new ay("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class bt{constructor(a,b,c){this._isDeleted=!1,this._options={...a},this._config={...b},this._name=b.name,this._automaticDataCollectionEnabled=b.automaticDataCollectionEnabled,this._container=c,this.container.addComponent(new aQ("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(a){this.checkDestroyed(),this._automaticDataCollectionEnabled=a}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(a){this._isDeleted=a}checkDestroyed(){if(this.isDeleted)throw bs.create("app-deleted",{appName:this._name})}}function bu(a,b){let c=ap(a.split(".")[1]);null===c?console.error(`FirebaseServerApp ${b} is invalid: second part could not be parsed.`):void 0===JSON.parse(c).exp?console.error(`FirebaseServerApp ${b} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(c).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${b} is invalid: the token has expired.`)}class bv extends bt{constructor(a,b,c,d){const e=void 0===b.automaticDataCollectionEnabled||b.automaticDataCollectionEnabled,f={name:c,automaticDataCollectionEnabled:e};void 0!==a.apiKey?super(a,f,d):super(a.options,f,d),this._serverConfig={automaticDataCollectionEnabled:e,...b},this._serverConfig.authIdToken&&bu(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&bu(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,b.releaseOnDeref=void 0,bC(bb,bc,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(a){this.isDeleted||(this._refCount++,void 0!==a&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(a,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){bB(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw bs.create("server-app-deleted")}}let bw="12.9.0";function bx(a,b={}){let c=a;"object"!=typeof b&&(b={name:b});let d={name:be,automaticDataCollectionEnabled:!0,...b},e=d.name;if("string"!=typeof e||!e)throw bs.create("bad-app-name",{appName:String(e)});if(c||(c=ar()),!c)throw bs.create("no-options");let f=bg.get(e);if(f)if(aJ(c,f.options)&&aJ(d,f.config))return f;else throw bs.create("duplicate-app",{appName:e});let g=new aT(e);for(let a of bi.values())g.addComponent(a);let h=new bt(c,d,g);return bg.set(e,h),h}function by(a,b={}){let c;if(av()&&!av())throw bs.create("invalid-server-app-environment");let d=b||{};if(a&&(bo(a)?c=a.options:bp(a)?d=a:c=a),void 0===d.automaticDataCollectionEnabled&&(d.automaticDataCollectionEnabled=!0),c||(c=ar()),!c)throw bs.create("no-options");let e={...d,...c};if(void 0!==e.releaseOnDeref&&delete e.releaseOnDeref,void 0!==d.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw bs.create("finalization-registry-not-supported",{});let f=""+[...JSON.stringify(e)].reduce((a,b)=>Math.imul(31,a)+b.charCodeAt(0)|0,0),g=bh.get(f);if(g)return g.incRefCount(d.releaseOnDeref),g;let h=new aT(f);for(let a of bi.values())h.addComponent(a);let i=new bv(c,d,f,h);return bh.set(f,i),i}function bz(a=be){let b=bg.get(a);if(!b&&a===be&&ar())return bx();if(!b)throw bs.create("no-app",{appName:a});return b}function bA(){return Array.from(bg.values())}async function bB(a){let b=!1,c=a.name;bg.has(c)?(b=!0,bg.delete(c)):bh.has(c)&&0>=a.decRefCount()&&(bh.delete(c),b=!0),b&&(await Promise.all(a.container.getProviders().map(a=>a.delete())),a.isDeleted=!0)}function bC(a,b,c){let d=bf[a]??a;c&&(d+=`-${c}`);let e=d.match(/\s|\//),f=b.match(/\s|\//);if(e||f){let a=[`Unable to register library "${d}" with version "${b}":`];e&&a.push(`library name "${d}" contains illegal characters (whitespace or "/")`),e&&f&&a.push("and"),f&&a.push(`version name "${b}" contains illegal characters (whitespace or "/")`),bd.warn(a.join(" "));return}bl(new aQ(`${d}-version`,()=>({library:d,version:b}),"VERSION"))}function bD(a,b){if(null!==a&&"function"!=typeof a)throw bs.create("invalid-log-argument");for(let c of aU){let d=null;b&&b.level&&(d=aV[b.level]),null===a?c.userLogHandler=null:c.userLogHandler=(b,c,...e)=>{let f=e.map(a=>{if(null==a)return null;if("string"==typeof a)return a;if("number"==typeof a||"boolean"==typeof a)return a.toString();if(a instanceof Error)return a.message;try{return JSON.stringify(a)}catch(a){return null}}).filter(a=>a).join(" ");c>=(d??b.logLevel)&&a({level:t[c].toLowerCase(),message:f,args:e,type:b.name})}}}function bE(a){aU.forEach(b=>{b.setLogLevel(a)})}let bF="firebase-heartbeat-store",bG=null;function bH(){return bG||(bG=(function(a,b,{blocked:c,upgrade:d,blocking:e,terminated:f}={}){let g=indexedDB.open(a,1),h=a4(g);return d&&g.addEventListener("upgradeneeded",a=>{d(a4(g.result),a.oldVersion,a.newVersion,a4(g.transaction),a)}),c&&g.addEventListener("blocked",a=>c(a.oldVersion,a.newVersion,a)),h.then(a=>{f&&a.addEventListener("close",()=>f()),e&&a.addEventListener("versionchange",a=>e(a.oldVersion,a.newVersion,a))}).catch(()=>{}),h})("firebase-heartbeat-database",0,{upgrade:(a,b)=>{if(0===b)try{a.createObjectStore(bF)}catch(a){console.warn(a)}}}).catch(a=>{throw bs.create("idb-open",{originalErrorMessage:a.message})})),bG}async function bI(a){try{let b=(await bH()).transaction(bF),c=await b.objectStore(bF).get(bK(a));return await b.done,c}catch(a){if(a instanceof ax)bd.warn(a.message);else{let b=bs.create("idb-get",{originalErrorMessage:a?.message});bd.warn(b.message)}}}async function bJ(a,b){try{let c=(await bH()).transaction(bF,"readwrite"),d=c.objectStore(bF);await d.put(b,bK(a)),await c.done}catch(a){if(a instanceof ax)bd.warn(a.message);else{let b=bs.create("idb-set",{originalErrorMessage:a?.message});bd.warn(b.message)}}}function bK(a){return`${a.name}!${a.options.appId}`}class bL{constructor(a){this.container=a,this._heartbeatsCache=null;const b=this.container.getProvider("app").getImmediate();this._storage=new bN(b),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){try{let a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),b=bM();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===b||this._heartbeatsCache.heartbeats.some(a=>a.date===b))return;if(this._heartbeatsCache.heartbeats.push({date:b,agent:a}),this._heartbeatsCache.heartbeats.length>30){let a=function(a){if(0===a.length)return -1;let b=0,c=a[0].date;for(let d=1;d<a.length;d++)a[d].date<c&&(c=a[d].date,b=d);return b}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){bd.warn(a)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let a=bM(),{heartbeatsToSend:b,unsentEntries:c}=function(a,b=1024){let c=[],d=a.slice();for(let e of a){let a=c.find(a=>a.agent===e.agent);if(a){if(a.dates.push(e.date),bO(c)>b){a.dates.pop();break}}else if(c.push({agent:e.agent,dates:[e.date]}),bO(c)>b){c.pop();break}d=d.slice(1)}return{heartbeatsToSend:c,unsentEntries:d}}(this._heartbeatsCache.heartbeats),d=ao(JSON.stringify({version:2,heartbeats:b}));return this._heartbeatsCache.lastSentHeartbeatDate=a,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(a){return bd.warn(a),""}}}function bM(){return new Date().toISOString().substring(0,10)}class bN{constructor(a){this.app=a,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(a){return!1}}()&&new Promise((a,b)=>{try{let c=!0,d="validate-browser-context-for-indexeddb-analytics-module",e=self.indexedDB.open(d);e.onsuccess=()=>{e.result.close(),c||self.indexedDB.deleteDatabase(d),a(!0)},e.onupgradeneeded=()=>{c=!1},e.onerror=()=>{b(e.error?.message||"")}}catch(a){b(a)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let a=await bI(this.app);return a?.heartbeats?a:{heartbeats:[]}}}async overwrite(a){if(await this._canUseIndexedDBPromise){let b=await this.read();return bJ(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??b.lastSentHeartbeatDate,heartbeats:a.heartbeats})}}async add(a){if(await this._canUseIndexedDBPromise){let b=await this.read();return bJ(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??b.lastSentHeartbeatDate,heartbeats:[...b.heartbeats,...a.heartbeats]})}}}function bO(a){return ao(JSON.stringify({version:2,heartbeats:a})).length}bl(new aQ("platform-logger",a=>new ba(a),"PRIVATE")),bl(new aQ("heartbeat",a=>new bL(a),"PRIVATE")),bC(bb,bc,""),bC(bb,bc,"esm2020"),bC("fire-js",""),a.s(["SDK_VERSION",()=>bw,"_DEFAULT_ENTRY_NAME",()=>be,"_addComponent",()=>bj,"_addOrOverwriteComponent",()=>bk,"_apps",()=>bg,"_clearComponents",()=>br,"_components",()=>bi,"_getProvider",()=>bm,"_isFirebaseApp",()=>bo,"_isFirebaseServerApp",()=>bq,"_isFirebaseServerAppSettings",()=>bp,"_registerComponent",()=>bl,"_removeServiceInstance",()=>bn,"_serverApps",()=>bh,"deleteApp",()=>bB,"getApp",()=>bz,"getApps",()=>bA,"initializeApp",()=>bx,"initializeServerApp",()=>by,"onLog",()=>bD,"registerVersion",()=>bC,"setLogLevel",()=>bE],88156),bC("firebase","12.9.0","app"),a.i(88156);var bP=a.i(47760);let bQ=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,bR="websocket",bS="long_polling";class bT{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(a,b){null==b?delete this.cache_[a]:this.cache_[a]=b}get(a){return aF(this.cache_,a)?this.cache_[a]:null}remove(a){delete this.cache_[a]}}let bU=function(a){return new bT},bV=bU("localStorage"),bW=bU("sessionStorage"),bX=new aZ("@firebase/database"),bY=(n=1,function(){return n++}),bZ=function(a){let b=aN(a),c=new aL;c.update(b);let d=c.digest();return al.encodeByteArray(d)},b$=function(...a){let b="";for(let c=0;c<a.length;c++){let d=a[c];Array.isArray(d)||d&&"object"==typeof d&&"number"==typeof d.length?b+=b$.apply(null,d):"object"==typeof d?b+=aB(d):b+=d,b+=" "}return b},b_=null,b0=!0,b1=function(a,b){ah(!b||!0===a||!1===a,"Can't turn on custom loggers persistently."),!0===a?(bX.logLevel=t.VERBOSE,b_=bX.log.bind(bX),b&&bW.set("logging_enabled",!0)):"function"==typeof a?b_=a:(b_=null,bW.remove("logging_enabled"))},b2=function(...a){if(!0===b0&&(b0=!1,null===b_&&!0===bW.get("logging_enabled")&&b1(!0)),b_){let b=b$.apply(null,a);b_(b)}},b3=function(a){return function(...b){b2(a,...b)}},b4=function(...a){let b="FIREBASE INTERNAL ERROR: "+b$(...a);bX.error(b)},b5=function(...a){let b=`FIREBASE FATAL ERROR: ${b$(...a)}`;throw bX.error(b),Error(b)},b6=function(...a){let b="FIREBASE WARNING: "+b$(...a);bX.warn(b)},b7=function(){},b8=function(a){return"number"==typeof a&&(a!=a||a===1/0||a===-1/0)},b9=function(a){if(aw()||"complete"===document.readyState)a();else{let b=!1,c=function(){document.body?b||(b=!0,a()):setTimeout(c,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",c,!1),window.addEventListener("load",c,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&c()}),window.attachEvent("onload",c))}},ca="[MIN_NAME]",cb="[MAX_NAME]",cc=function(a,b){if(a===b)return 0;{if(a===ca||b===cb)return -1;if(b===ca||a===cb)return 1;let c=ck(a),d=ck(b);if(null!==c)if(null!==d)return c-d==0?a.length-b.length:c-d;else return -1;return null!==d?1:a<b?-1:1}},cd=function(a,b){return a===b?0:a<b?-1:1},ce=function(a,b){if(b&&a in b)return b[a];throw Error("Missing required key ("+a+") in object: "+aB(b))},cf=function(a){if("object"!=typeof a||null===a)return aB(a);let b=[];for(let c in a)b.push(c);b.sort();let c="{";for(let d=0;d<b.length;d++)0!==d&&(c+=","),c+=aB(b[d]),c+=":",c+=cf(a[b[d]]);return c+"}"},cg=function(a,b){let c=a.length;if(c<=b)return[a];let d=[];for(let e=0;e<c;e+=b)e+b>c?d.push(a.substring(e,c)):d.push(a.substring(e,e+b));return d};function ch(a,b){for(let c in a)a.hasOwnProperty(c)&&b(c,a[c])}let ci=function(a){let b,c,d,e,f;ah(!b8(a),"Invalid JSON number");0===a?(c=0,d=0,b=+(1/a==-1/0)):(b=a<0,(a=Math.abs(a))>=22250738585072014e-324?(c=(e=Math.min(Math.floor(Math.log(a)/Math.LN2),1023))+1023,d=Math.round(a*Math.pow(2,52-e)-0x10000000000000)):(c=0,d=Math.round(a/5e-324)));let g=[];for(f=52;f;f-=1)g.push(d%2?1:0),d=Math.floor(d/2);for(f=11;f;f-=1)g.push(c%2?1:0),c=Math.floor(c/2);g.push(+!!b),g.reverse();let h=g.join(""),i="";for(f=0;f<64;f+=8){let a=parseInt(h.substr(f,8),2).toString(16);1===a.length&&(a="0"+a),i+=a}return i.toLowerCase()},cj=RegExp("^-?(0*)\\d{1,10}$"),ck=function(a){if(cj.test(a)){let b=Number(a);if(b>=-0x80000000&&b<=0x7fffffff)return b}return null},cl=function(a){try{a()}catch(a){setTimeout(()=>{throw b6("Exception was thrown by user callback.",a.stack||""),a},Math.floor(0))}},cm=function(a,b){let c=setTimeout(a,b);return"number"==typeof c&&"u">typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(c):"object"==typeof c&&c.unref&&c.unref(),c};class cn{constructor(a,b,c,d,e=!1,f="",g=!1,h=!1,i=null){this.secure=b,this.namespace=c,this.webSocketOnly=d,this.nodeAdmin=e,this.persistenceKey=f,this.includeNamespaceInQueryParams=g,this.isUsingEmulator=h,this.emulatorOptions=i,this._host=a.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=bV.get("host:"+a)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(a){a!==this.internalHost&&(this.internalHost=a,this.isCacheableHost()&&bV.set("host:"+this._host,this.internalHost))}toString(){let a=this.toURLString();return this.persistenceKey&&(a+="<"+this.persistenceKey+">"),a}toURLString(){let a=this.secure?"https://":"http://",b=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${a}${this.host}/${b}`}}function co(a,b,c){let d;if(ah("string"==typeof b,"typeof type must == string"),ah("object"==typeof c,"typeof params must == object"),b===bR)d=(a.secure?"wss://":"ws://")+a.internalHost+"/.ws?";else if(b===bS)d=(a.secure?"https://":"http://")+a.internalHost+"/.lp?";else throw Error("Unknown connection type: "+b);(a.host!==a.internalHost||a.isCustomHost()||a.includeNamespaceInQueryParams)&&(c.ns=a.namespace);let e=[];return ch(c,(a,b)=>{e.push(a+"="+b)}),d+e.join("&")}class cp{constructor(){this.counters_={}}incrementCounter(a,b=1){aF(this.counters_,a)||(this.counters_[a]=0),this.counters_[a]+=b}get(){return function a(b,c){if(!(c instanceof Object))return c;switch(c.constructor){case Date:return new Date(c.getTime());case Object:void 0===b&&(b={});break;case Array:b=[];break;default:return c}for(let d in c)c.hasOwnProperty(d)&&"__proto__"!==d&&(b[d]=a(b[d],c[d]));return b}(void 0,this.counters_)}}let cq={},cr={};function cs(a){let b=a.toString();return cq[b]||(cq[b]=new cp),cq[b]}let ct="",cu=null;"u">typeof MozWebSocket?cu=MozWebSocket:"u">typeof WebSocket&&(cu=WebSocket);class cv{constructor(a,b,c,d,e,f,g){this.connId=a,this.applicationId=c,this.appCheckToken=d,this.authToken=e,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=b3(this.connId),this.stats_=cs(b),this.connURL=cv.connectionURL_(b,f,g,d,c),this.nodeAdmin=b.nodeAdmin}static connectionURL_(a,b,c,d,e){let f={};return f.v="5",!aw()&&"u">typeof location&&location.hostname&&bQ.test(location.hostname)&&(f.r="f"),b&&(f.s=b),c&&(f.ls=c),d&&(f.ac=d),e&&(f.p=e),co(a,bR,f)}open(a,b){this.onDisconnect=b,this.onMessage=a,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,bV.set("previous_websocket_failure",!0);try{let a;if(aw()){let b=this.nodeAdmin?"AdminNode":"Node";a={headers:{"User-Agent":`Firebase/5/${ct}/${process.platform}/${b}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(a.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(a.headers["X-Firebase-AppCheck"]=this.appCheckToken);let c=process.env,d=0===this.connURL.indexOf("wss://")?c.HTTPS_PROXY||c.https_proxy:c.HTTP_PROXY||c.http_proxy;d&&(a.proxy={origin:d})}this.mySock=new cu(this.connURL,[],a)}catch(b){this.log_("Error instantiating WebSocket.");let a=b.message||b.data;a&&this.log_(a),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=a=>{this.handleIncomingFrame(a)},this.mySock.onerror=a=>{this.log_("WebSocket error.  Closing connection.");let b=a.message||a.data;b&&this.log_(b),this.onClosed_()}}start(){}static forceDisallow(){cv.forceDisallow_=!0}static isAvailable(){let a=!1;if("u">typeof navigator&&navigator.userAgent){let b=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);b&&b.length>1&&4.4>parseFloat(b[1])&&(a=!0)}return!a&&null!==cu&&!cv.forceDisallow_}static previouslyFailed(){return bV.isInMemoryStorage||!0===bV.get("previous_websocket_failure")}markConnectionHealthy(){bV.remove("previous_websocket_failure")}appendFrame_(a){if(this.frames.push(a),this.frames.length===this.totalFrames){let a=this.frames.join("");this.frames=null;let b=aA(a);this.onMessage(b)}}handleNewFrameCount_(a){this.totalFrames=a,this.frames=[]}extractFrameCount_(a){if(ah(null===this.frames,"We already have a frame buffer"),a.length<=6){let b=Number(a);if(!isNaN(b))return this.handleNewFrameCount_(b),null}return this.handleNewFrameCount_(1),a}handleIncomingFrame(a){if(null===this.mySock)return;let b=a.data;if(this.bytesReceived+=b.length,this.stats_.incrementCounter("bytes_received",b.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(b);else{let a=this.extractFrameCount_(b);null!==a&&this.appendFrame_(a)}}send(a){this.resetKeepAlive();let b=aB(a);this.bytesSent+=b.length,this.stats_.incrementCounter("bytes_sent",b.length);let c=cg(b,16384);c.length>1&&this.sendString_(String(c.length));for(let a=0;a<c.length;a++)this.sendString_(c[a])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(a){try{this.mySock.send(a)}catch(a){this.log_("Exception thrown from WebSocket.send():",a.message||a.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}cv.responsesRequiredToBeHealthy=2,cv.healthyTimeout=3e4;let cw="@firebase/database",cx="1.1.0";class cy{constructor(a,b){this.appCheckProvider=b,this.appName=a.name,bq(a)&&a.settings.appCheckToken&&(this.serverAppAppCheckToken=a.settings.appCheckToken),this.appCheck=b?.getImmediate({optional:!0}),this.appCheck||b?.get().then(a=>this.appCheck=a)}getToken(a){if(this.serverAppAppCheckToken){if(a)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(a):new Promise((b,c)=>{setTimeout(()=>{this.appCheck?this.getToken(a).then(b,c):b(null)},0)})}addTokenChangeListener(a){this.appCheckProvider?.get().then(b=>b.addTokenListener(a))}notifyForInvalidToken(){b6(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class cz{constructor(a,b,c){this.appName_=a,this.firebaseOptions_=b,this.authProvider_=c,this.auth_=null,this.auth_=c.getImmediate({optional:!0}),this.auth_||c.onInit(a=>this.auth_=a)}getToken(a){return this.auth_?this.auth_.getToken(a).catch(a=>a&&"auth/token-not-initialized"===a.code?(b2("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(a)):new Promise((b,c)=>{setTimeout(()=>{this.auth_?this.getToken(a).then(b,c):b(null)},0)})}addTokenChangeListener(a){this.auth_?this.auth_.addAuthTokenListener(a):this.authProvider_.get().then(b=>b.addAuthTokenListener(a))}removeTokenChangeListener(a){this.authProvider_.get().then(b=>b.removeAuthTokenListener(a))}notifyForInvalidToken(){let a='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?a+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?a+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':a+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',b6(a)}}class cA{constructor(a){this.accessToken=a}getToken(a){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(a){a(this.accessToken)}removeTokenChangeListener(a){}notifyForInvalidToken(){}}cA.OWNER="owner";class cB{constructor(a){this.onMessage_=a,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(a,b){this.closeAfterResponse=a,this.onClose=b,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(a,b){for(this.pendingResponses[a]=b;this.pendingResponses[this.currentResponseNum];){let a=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let b=0;b<a.length;++b)a[b]&&cl(()=>{this.onMessage_(a[b])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let cC="start";class cD{constructor(a,b,c,d,e,f,g){this.connId=a,this.repoInfo=b,this.applicationId=c,this.appCheckToken=d,this.authToken=e,this.transportSessionId=f,this.lastSessionId=g,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=b3(a),this.stats_=cs(b),this.urlFn=a=>(this.appCheckToken&&(a.ac=this.appCheckToken),co(b,bS,a))}open(a,b){this.curSegmentNum=0,this.onDisconnect_=b,this.myPacketOrderer=new cB(a),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),b9(()=>{if(this.isClosed_)return;this.scriptTagHolder=new cE((...a)=>{let[b,c,d,e,f]=a;if(this.incrementIncomingBytes_(a),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,b===cC)this.id=c,this.password=d;else if("close"===b)c?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(c,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+b)},(...a)=>{let[b,c]=a;this.incrementIncomingBytes_(a),this.myPacketOrderer.handleResponse(b,c)},()=>{this.onClosed_()},this.urlFn);let a={};a[cC]="t",a.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(a.cb=this.scriptTagHolder.uniqueCallbackIdentifier),a.v="5",this.transportSessionId&&(a.s=this.transportSessionId),this.lastSessionId&&(a.ls=this.lastSessionId),this.applicationId&&(a.p=this.applicationId),this.appCheckToken&&(a.ac=this.appCheckToken),"u">typeof location&&location.hostname&&bQ.test(location.hostname)&&(a.r="f");let b=this.urlFn(a);this.log_("Connecting via long-poll to "+b),this.scriptTagHolder.addTag(b,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){cD.forceAllow_=!0}static forceDisallow(){cD.forceDisallow_=!0}static isAvailable(){return!aw()&&(!!cD.forceAllow_||!cD.forceDisallow_&&"u">typeof document&&null!=document.createElement&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(a){let b=aB(a);this.bytesSent+=b.length,this.stats_.incrementCounter("bytes_sent",b.length);let c=cg(an(b),1840);for(let a=0;a<c.length;a++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,c.length,c[a]),this.curSegmentNum++}addDisconnectPingFrame(a,b){if(aw())return;this.myDisconnFrame=document.createElement("iframe");let c={};c.dframe="t",c.id=a,c.pw=b,this.myDisconnFrame.src=this.urlFn(c),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(a){let b=aB(a).length;this.bytesReceived+=b,this.stats_.incrementCounter("bytes_received",b)}}class cE{constructor(a,b,c,d){if(this.onDisconnect=c,this.urlFn=d,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,aw())this.commandCB=a,this.onMessageCB=b;else{this.uniqueCallbackIdentifier=bY(),window["pLPCommand"+this.uniqueCallbackIdentifier]=a,window["pRTLPCB"+this.uniqueCallbackIdentifier]=b,this.myIFrame=cE.createIFrame_();let c="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(c='<script>document.domain="'+document.domain+'";</script>');const d="<html><body>"+c+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(d),this.myIFrame.doc.close()}catch(a){b2("frame writing exception"),a.stack&&b2(a.stack),b2(a)}}}static createIFrame_(){let a=document.createElement("iframe");if(a.style.display="none",document.body){document.body.appendChild(a);try{a.contentWindow.document||b2("No IE domain setting required")}catch(b){a.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return a.contentDocument?a.doc=a.contentDocument:a.contentWindow?a.doc=a.contentWindow.document:a.document&&(a.doc=a.document),a}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let a=this.onDisconnect;a&&(this.onDisconnect=null,a())}startLongPoll(a,b){for(this.myID=a,this.myPW=b,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let a={};a.id=this.myID,a.pw=this.myPW,a.ser=this.currentSerial;let b=this.urlFn(a),c="",d=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+c.length<=1870){let a=this.pendingSegs.shift();c=c+"&seg"+d+"="+a.seg+"&ts"+d+"="+a.ts+"&d"+d+"="+a.d,d++}else break;return b+=c,this.addLongPollTag_(b,this.currentSerial),!0}}enqueueSegment(a,b,c){this.pendingSegs.push({seg:a,ts:b,d:c}),this.alive&&this.newRequest_()}addLongPollTag_(a,b){this.outstandingRequests.add(b);let c=()=>{this.outstandingRequests.delete(b),this.newRequest_()},d=setTimeout(c,Math.floor(25e3));this.addTag(a,()=>{clearTimeout(d),c()})}addTag(a,b){aw()?this.doNodeLongPoll(a,b):setTimeout(()=>{try{if(!this.sendNewPolls)return;let c=this.myIFrame.doc.createElement("script");c.type="text/javascript",c.async=!0,c.src=a,c.onload=c.onreadystatechange=function(){let a=c.readyState;a&&"loaded"!==a&&"complete"!==a||(c.onload=c.onreadystatechange=null,c.parentNode&&c.parentNode.removeChild(c),b())},c.onerror=()=>{b2("Long-poll script failed to load: "+a),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(c)}catch(a){}},Math.floor(1))}}class cF{static get ALL_TRANSPORTS(){return[cD,cv]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(a){this.initTransports_(a)}initTransports_(a){let b=cv&&cv.isAvailable(),c=b&&!cv.previouslyFailed();if(a.webSocketOnly&&(b||b6("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),c=!0),c)this.transports_=[cv];else{let a=this.transports_=[];for(let b of cF.ALL_TRANSPORTS)b&&b.isAvailable()&&a.push(b);cF.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}cF.globalTransportInitialized_=!1;class cG{constructor(a,b,c,d,e,f,g,h,i,j){this.id=a,this.repoInfo_=b,this.applicationId_=c,this.appCheckToken_=d,this.authToken_=e,this.onMessage_=f,this.onReady_=g,this.onDisconnect_=h,this.onKill_=i,this.lastSessionId=j,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=b3("c:"+this.id+":"),this.transportManager_=new cF(b),this.log_("Connection created"),this.start_()}start_(){let a=this.transportManager_.initialTransport();this.conn_=new a(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=a.responsesRequiredToBeHealthy||0;let b=this.connReceiver_(this.conn_),c=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(b,c)},Math.floor(0));let d=a.healthyTimeout||0;d>0&&(this.healthyTimeout_=cm(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(d)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(a){return b=>{a===this.conn_?this.onConnectionLost_(b):a===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(a){return b=>{2!==this.state_&&(a===this.rx_?this.onPrimaryMessageReceived_(b):a===this.secondaryConn_?this.onSecondaryMessageReceived_(b):this.log_("message on old connection"))}}sendRequest(a){this.sendData_({t:"d",d:a})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(a){if("t"in a){let b=a.t;"a"===b?this.upgradeIfSecondaryHealthy_():"r"===b?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===b&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(a){let b=ce("t",a),c=ce("d",a);if("c"===b)this.onSecondaryControl_(c);else if("d"===b)this.pendingDataMessages.push(c);else throw Error("Unknown protocol layer: "+b)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(a){let b=ce("t",a),c=ce("d",a);"c"===b?this.onControl_(c):"d"===b&&this.onDataMessage_(c)}onDataMessage_(a){this.onPrimaryResponse_(),this.onMessage_(a)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(a){let b=ce("t",a);if("d"in a){let c=a.d;if("h"===b){let a={...c};this.repoInfo_.isUsingEmulator&&(a.h=this.repoInfo_.host),this.onHandshake_(a)}else if("n"===b){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let a=0;a<this.pendingDataMessages.length;++a)this.onDataMessage_(this.pendingDataMessages[a]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===b?this.onConnectionShutdown_(c):"r"===b?this.onReset_(c):"e"===b?b4("Server Error: "+c):"o"===b?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):b4("Unknown control packet command: "+b)}}onHandshake_(a){let b=a.ts,c=a.v,d=a.h;this.sessionId=a.s,this.repoInfo_.host=d,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,b),"5"!==c&&b6("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let a=this.transportManager_.upgradeTransport();a&&this.startUpgrade_(a)}startUpgrade_(a){this.secondaryConn_=new a(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=a.responsesRequiredToBeHealthy||0;let b=this.connReceiver_(this.secondaryConn_),c=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(b,c),cm(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(a){this.log_("Reset packet received.  New host: "+a),this.repoInfo_.host=a,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(a,b){this.log_("Realtime connection established."),this.conn_=a,this.state_=1,this.onReady_&&(this.onReady_(b,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):cm(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let a=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===a||this.rx_===a)&&this.close()}onConnectionLost_(a){this.conn_=null,a||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(bV.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(a){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(a),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(a){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(a)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class cH{put(a,b,c,d){}merge(a,b,c,d){}refreshAuthToken(a){}refreshAppCheckToken(a){}onDisconnectPut(a,b,c){}onDisconnectMerge(a,b,c){}onDisconnectCancel(a,b){}reportStats(a){}}class cI{constructor(a){this.allowedEvents_=a,this.listeners_={},ah(Array.isArray(a)&&a.length>0,"Requires a non-empty array")}trigger(a,...b){if(Array.isArray(this.listeners_[a])){let c=[...this.listeners_[a]];for(let a=0;a<c.length;a++)c[a].callback.apply(c[a].context,b)}}on(a,b,c){this.validateEventType_(a),this.listeners_[a]=this.listeners_[a]||[],this.listeners_[a].push({callback:b,context:c});let d=this.getInitialEvent(a);d&&b.apply(c,d)}off(a,b,c){this.validateEventType_(a);let d=this.listeners_[a]||[];for(let a=0;a<d.length;a++)if(d[a].callback===b&&(!c||c===d[a].context))return void d.splice(a,1)}validateEventType_(a){ah(this.allowedEvents_.find(b=>b===a),"Unknown event: "+a)}}class cJ extends cI{static getInstance(){return new cJ}constructor(){super(["online"]),this.online_=!0}getInitialEvent(a){return ah("online"===a,"Unknown event type: "+a),[this.online_]}currentlyOnline(){return this.online_}}class cK{constructor(a,b){if(void 0===b){this.pieces_=a.split("/");let b=0;for(let a=0;a<this.pieces_.length;a++)this.pieces_[a].length>0&&(this.pieces_[b]=this.pieces_[a],b++);this.pieces_.length=b,this.pieceNum_=0}else this.pieces_=a,this.pieceNum_=b}toString(){let a="";for(let b=this.pieceNum_;b<this.pieces_.length;b++)""!==this.pieces_[b]&&(a+="/"+this.pieces_[b]);return a||"/"}}function cL(){return new cK("")}function cM(a){return a.pieceNum_>=a.pieces_.length?null:a.pieces_[a.pieceNum_]}function cN(a){return a.pieces_.length-a.pieceNum_}function cO(a){let b=a.pieceNum_;return b<a.pieces_.length&&b++,new cK(a.pieces_,b)}function cP(a){return a.pieceNum_<a.pieces_.length?a.pieces_[a.pieces_.length-1]:null}function cQ(a,b=0){return a.pieces_.slice(a.pieceNum_+b)}function cR(a){if(a.pieceNum_>=a.pieces_.length)return null;let b=[];for(let c=a.pieceNum_;c<a.pieces_.length-1;c++)b.push(a.pieces_[c]);return new cK(b,0)}function cS(a,b){let c=[];for(let b=a.pieceNum_;b<a.pieces_.length;b++)c.push(a.pieces_[b]);if(b instanceof cK)for(let a=b.pieceNum_;a<b.pieces_.length;a++)c.push(b.pieces_[a]);else{let a=b.split("/");for(let b=0;b<a.length;b++)a[b].length>0&&c.push(a[b])}return new cK(c,0)}function cT(a){return a.pieceNum_>=a.pieces_.length}function cU(a,b){let c=cM(a),d=cM(b);if(null===c)return b;if(c===d)return cU(cO(a),cO(b));throw Error("INTERNAL ERROR: innerPath ("+b+") is not within outerPath ("+a+")")}function cV(a,b){let c=cQ(a,0),d=cQ(b,0);for(let a=0;a<c.length&&a<d.length;a++){let b=cc(c[a],d[a]);if(0!==b)return b}return c.length===d.length?0:c.length<d.length?-1:1}function cW(a,b){if(cN(a)!==cN(b))return!1;for(let c=a.pieceNum_,d=b.pieceNum_;c<=a.pieces_.length;c++,d++)if(a.pieces_[c]!==b.pieces_[d])return!1;return!0}function cX(a,b){let c=a.pieceNum_,d=b.pieceNum_;if(cN(a)>cN(b))return!1;for(;c<a.pieces_.length;){if(a.pieces_[c]!==b.pieces_[d])return!1;++c,++d}return!0}class cY{constructor(a,b){this.errorPrefix_=b,this.parts_=cQ(a,0),this.byteLength_=Math.max(1,this.parts_.length);for(let a=0;a<this.parts_.length;a++)this.byteLength_+=aO(this.parts_[a]);cZ(this)}}function cZ(a){if(a.byteLength_>768)throw Error(a.errorPrefix_+"has a key path longer than 768 bytes ("+a.byteLength_+").");if(a.parts_.length>32)throw Error(a.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+c$(a))}function c$(a){return 0===a.parts_.length?"":"in property '"+a.parts_.join(".")+"'"}class c_ extends cI{static getInstance(){return new c_}constructor(){let a,b;super(["visible"]),"u">typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(b="visibilitychange",a="hidden"):void 0!==document.mozHidden?(b="mozvisibilitychange",a="mozHidden"):void 0!==document.msHidden?(b="msvisibilitychange",a="msHidden"):void 0!==document.webkitHidden&&(b="webkitvisibilitychange",a="webkitHidden")),this.visible_=!0,b&&document.addEventListener(b,()=>{let b=!document[a];b!==this.visible_&&(this.visible_=b,this.trigger("visible",b))},!1)}getInitialEvent(a){return ah("visible"===a,"Unknown event type: "+a),[this.visible_]}}class c0 extends cH{constructor(a,b,c,d,e,f,g,h){if(super(),this.repoInfo_=a,this.applicationId_=b,this.onDataUpdate_=c,this.onConnectStatus_=d,this.onServerInfoUpdate_=e,this.authTokenProvider_=f,this.appCheckTokenProvider_=g,this.authOverride_=h,this.id=c0.nextPersistentConnectionId_++,this.log_=b3("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,h&&!aw())throw Error("Auth override specified in options, but not supported on non Node.js platforms");c_.getInstance().on("visible",this.onVisible_,this),-1===a.host.indexOf("fblocal")&&cJ.getInstance().on("online",this.onOnline_,this)}sendRequest(a,b,c){let d=++this.requestNumber_,e={r:d,a:a,b:b};this.log_(aB(e)),ah(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(e),c&&(this.requestCBHash_[d]=c)}get(a){this.initConnection_();let b=new as,c={p:a._path.toString(),q:a._queryObject};this.outstandingGets_.push({action:"g",request:c,onComplete:a=>{let c=a.d;"ok"===a.s?b.resolve(c):b.reject(c)}}),this.outstandingGetCount_++;let d=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(d),b.promise}listen(a,b,c,d){this.initConnection_();let e=a._queryIdentifier,f=a._path.toString();this.log_("Listen called for "+f+" "+e),this.listens.has(f)||this.listens.set(f,new Map),ah(a._queryParams.isDefault()||!a._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ah(!this.listens.get(f).has(e),"listen() called twice for same path/queryId.");let g={onComplete:d,hashFn:b,query:a,tag:c};this.listens.get(f).set(e,g),this.connected_&&this.sendListen_(g)}sendGet_(a){let b=this.outstandingGets_[a];this.sendRequest("g",b.request,c=>{delete this.outstandingGets_[a],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),b.onComplete&&b.onComplete(c)})}sendListen_(a){let b=a.query,c=b._path.toString(),d=b._queryIdentifier;this.log_("Listen on "+c+" for "+d);let e={p:c};a.tag&&(e.q=b._queryObject,e.t=a.tag),e.h=a.hashFn(),this.sendRequest("q",e,e=>{let f=e.d,g=e.s;c0.warnOnListenWarnings_(f,b),(this.listens.get(c)&&this.listens.get(c).get(d))===a&&(this.log_("listen response",e),"ok"!==g&&this.removeListen_(c,d),a.onComplete&&a.onComplete(g,f))})}static warnOnListenWarnings_(a,b){if(a&&"object"==typeof a&&aF(a,"w")){let c=aG(a,"w");if(Array.isArray(c)&&~c.indexOf("no_index")){let a='".indexOn": "'+b._queryParams.getIndex().toString()+'"',c=b._path.toString();b6(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${a} at ${c} to your security rules for better performance.`)}}}refreshAuthToken(a){this.authToken_=a,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(a)}reduceReconnectDelayIfAdminCredential_(a){(a&&40===a.length||aE(a))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(a){this.appCheckToken_=a,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let a=this.authToken_,b=aD(a)?"auth":"gauth",c={cred:a};null===this.authOverride_?c.noauth=!0:"object"==typeof this.authOverride_&&(c.authvar=this.authOverride_),this.sendRequest(b,c,b=>{let c=b.s,d=b.d||"error";this.authToken_===a&&("ok"===c?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(c,d))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},a=>{let b=a.s,c=a.d||"error";"ok"===b?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(b,c)})}unlisten(a,b){let c=a._path.toString(),d=a._queryIdentifier;this.log_("Unlisten called for "+c+" "+d),ah(a._queryParams.isDefault()||!a._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(c,d)&&this.connected_&&this.sendUnlisten_(c,d,a._queryObject,b)}sendUnlisten_(a,b,c,d){this.log_("Unlisten on "+a+" for "+b);let e={p:a};d&&(e.q=c,e.t=d),this.sendRequest("n",e)}onDisconnectPut(a,b,c){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",a,b,c):this.onDisconnectRequestQueue_.push({pathString:a,action:"o",data:b,onComplete:c})}onDisconnectMerge(a,b,c){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",a,b,c):this.onDisconnectRequestQueue_.push({pathString:a,action:"om",data:b,onComplete:c})}onDisconnectCancel(a,b){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",a,null,b):this.onDisconnectRequestQueue_.push({pathString:a,action:"oc",data:null,onComplete:b})}sendOnDisconnect_(a,b,c,d){let e={p:b,d:c};this.log_("onDisconnect "+a,e),this.sendRequest(a,e,a=>{d&&setTimeout(()=>{d(a.s,a.d)},Math.floor(0))})}put(a,b,c,d){this.putInternal("p",a,b,c,d)}merge(a,b,c,d){this.putInternal("m",a,b,c,d)}putInternal(a,b,c,d,e){this.initConnection_();let f={p:b,d:c};void 0!==e&&(f.h=e),this.outstandingPuts_.push({action:a,request:f,onComplete:d}),this.outstandingPutCount_++;let g=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(g):this.log_("Buffering put: "+b)}sendPut_(a){let b=this.outstandingPuts_[a].action,c=this.outstandingPuts_[a].request,d=this.outstandingPuts_[a].onComplete;this.outstandingPuts_[a].queued=this.connected_,this.sendRequest(b,c,c=>{this.log_(b+" response",c),delete this.outstandingPuts_[a],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),d&&d(c.s,c.d)})}reportStats(a){if(this.connected_){let b={c:a};this.log_("reportStats",b),this.sendRequest("s",b,a=>{if("ok"!==a.s){let b=a.d;this.log_("reportStats","Error sending stats: "+b)}})}}onDataMessage_(a){if("r"in a){this.log_("from server: "+aB(a));let b=a.r,c=this.requestCBHash_[b];c&&(delete this.requestCBHash_[b],c(a.b))}else if("error"in a)throw"A server-side error has occurred: "+a.error;else"a"in a&&this.onDataPush_(a.a,a.b)}onDataPush_(a,b){this.log_("handleServerMessage",a,b),"d"===a?this.onDataUpdate_(b.p,b.d,!1,b.t):"m"===a?this.onDataUpdate_(b.p,b.d,!0,b.t):"c"===a?this.onListenRevoked_(b.p,b.q):"ac"===a?this.onAuthRevoked_(b.s,b.d):"apc"===a?this.onAppCheckRevoked_(b.s,b.d):"sd"===a?this.onSecurityDebugPacket_(b):b4("Unrecognized action received from server: "+aB(a)+"\nAre you using the latest client?")}onReady_(a,b){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(a),this.lastSessionId=b,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(a){ah(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(a))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(a){a&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=a}onOnline_(a){a?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let a=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),b=Math.max(0,this.reconnectDelay_-a);b=Math.random()*b,this.log_("Trying to reconnect in "+b+"ms"),this.scheduleConnect_(b),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let a=this.onDataMessage_.bind(this),b=this.onReady_.bind(this),c=this.onRealtimeDisconnect_.bind(this),d=this.id+":"+c0.nextConnectionId_++,e=this.lastSessionId,f=!1,g=null,h=function(){g?g.close():(f=!0,c())};this.realtime_={close:h,sendRequest:function(a){ah(g,"sendRequest call when we're not connected not allowed."),g.sendRequest(a)}};let i=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[h,j]=await Promise.all([this.authTokenProvider_.getToken(i),this.appCheckTokenProvider_.getToken(i)]);f?b2("getToken() completed but was canceled"):(b2("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=j&&j.token,g=new cG(d,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,a,b,c,a=>{b6(a+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},e))}catch(a){this.log_("Failed to get token: "+a),f||(this.repoInfo_.nodeAdmin&&b6(a),h())}}}interrupt(a){b2("Interrupting connection for reason: "+a),this.interruptReasons_[a]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(a){b2("Resuming connection for reason: "+a),delete this.interruptReasons_[a],aH(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(a){let b=a-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:b})}cancelSentTransactions_(){for(let a=0;a<this.outstandingPuts_.length;a++){let b=this.outstandingPuts_[a];b&&"h"in b.request&&b.queued&&(b.onComplete&&b.onComplete("disconnect"),delete this.outstandingPuts_[a],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(a,b){let c;c=b?b.map(a=>cf(a)).join("$"):"default";let d=this.removeListen_(a,c);d&&d.onComplete&&d.onComplete("permission_denied")}removeListen_(a,b){let c,d=new cK(a).toString();if(this.listens.has(d)){let a=this.listens.get(d);c=a.get(b),a.delete(b),0===a.size&&this.listens.delete(d)}else c=void 0;return c}onAuthRevoked_(a,b){b2("Auth token revoked: "+a+"/"+b),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===a||"permission_denied"===a)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(a,b){b2("App check token revoked: "+a+"/"+b),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===a||"permission_denied"===a)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(a){this.securityDebugCallback_?this.securityDebugCallback_(a):"msg"in a&&console.log("FIREBASE: "+a.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let a of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let b of a.values())this.sendListen_(b);for(let a=0;a<this.outstandingPuts_.length;a++)this.outstandingPuts_[a]&&this.sendPut_(a);for(;this.onDisconnectRequestQueue_.length;){let a=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(a.action,a.pathString,a.data,a.onComplete)}for(let a=0;a<this.outstandingGets_.length;a++)this.outstandingGets_[a]&&this.sendGet_(a)}sendConnectStats_(){let a={},b="js";aw()&&(b=this.repoInfo_.nodeAdmin?"admin_node":"node"),a["sdk."+b+"."+ct.replace(/\./g,"-")]=1,"object"==typeof navigator&&"ReactNative"===navigator.product&&(a["framework.reactnative"]=1),this.reportStats(a)}shouldReconnect_(){let a=cJ.getInstance().currentlyOnline();return aH(this.interruptReasons_)&&a}}c0.nextPersistentConnectionId_=0,c0.nextConnectionId_=0;class c1{constructor(a,b){this.name=a,this.node=b}static Wrap(a,b){return new c1(a,b)}}class c2{getCompare(){return this.compare.bind(this)}indexedValueChanged(a,b){let c=new c1(ca,a),d=new c1(ca,b);return 0!==this.compare(c,d)}minPost(){return c1.MIN}}class c3 extends c2{static get __EMPTY_NODE(){return d}static set __EMPTY_NODE(a){d=a}compare(a,b){return cc(a.name,b.name)}isDefinedOn(a){throw ai("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(a,b){return!1}minPost(){return c1.MIN}maxPost(){return new c1(cb,d)}makePost(a,b){return ah("string"==typeof a,"KeyIndex indexValue must always be a string."),new c1(a,d)}toString(){return".key"}}let c4=new c3;class c5{constructor(a,b,c,d,e=null){this.isReverse_=d,this.resultGenerator_=e,this.nodeStack_=[];let f=1;for(;!a.isEmpty();)if(f=b?c(a.key,b):1,d&&(f*=-1),f<0)a=this.isReverse_?a.left:a.right;else if(0===f){this.nodeStack_.push(a);break}else this.nodeStack_.push(a),a=this.isReverse_?a.right:a.left}getNext(){let a;if(0===this.nodeStack_.length)return null;let b=this.nodeStack_.pop();if(a=this.resultGenerator_?this.resultGenerator_(b.key,b.value):{key:b.key,value:b.value},this.isReverse_)for(b=b.left;!b.isEmpty();)this.nodeStack_.push(b),b=b.right;else for(b=b.right;!b.isEmpty();)this.nodeStack_.push(b),b=b.left;return a}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let a=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(a.key,a.value):{key:a.key,value:a.value}}}class c6{constructor(a,b,c,d,e){this.key=a,this.value=b,this.color=null!=c?c:c6.RED,this.left=null!=d?d:c7.EMPTY_NODE,this.right=null!=e?e:c7.EMPTY_NODE}copy(a,b,c,d,e){return new c6(null!=a?a:this.key,null!=b?b:this.value,null!=c?c:this.color,null!=d?d:this.left,null!=e?e:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(a){return this.left.inorderTraversal(a)||!!a(this.key,this.value)||this.right.inorderTraversal(a)}reverseTraversal(a){return this.right.reverseTraversal(a)||a(this.key,this.value)||this.left.reverseTraversal(a)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(a,b,c){let d=this,e=c(a,d.key);return(d=e<0?d.copy(null,null,null,d.left.insert(a,b,c),null):0===e?d.copy(null,b,null,null,null):d.copy(null,null,null,null,d.right.insert(a,b,c))).fixUp_()}removeMin_(){if(this.left.isEmpty())return c7.EMPTY_NODE;let a=this;return a.left.isRed_()||a.left.left.isRed_()||(a=a.moveRedLeft_()),(a=a.copy(null,null,null,a.left.removeMin_(),null)).fixUp_()}remove(a,b){let c,d;if(c=this,0>b(a,c.key))c.left.isEmpty()||c.left.isRed_()||c.left.left.isRed_()||(c=c.moveRedLeft_()),c=c.copy(null,null,null,c.left.remove(a,b),null);else{if(c.left.isRed_()&&(c=c.rotateRight_()),c.right.isEmpty()||c.right.isRed_()||c.right.left.isRed_()||(c=c.moveRedRight_()),0===b(a,c.key))if(c.right.isEmpty())return c7.EMPTY_NODE;else d=c.right.min_(),c=c.copy(d.key,d.value,null,null,c.right.removeMin_());c=c.copy(null,null,null,null,c.right.remove(a,b))}return c.fixUp_()}isRed_(){return this.color}fixUp_(){let a=this;return a.right.isRed_()&&!a.left.isRed_()&&(a=a.rotateLeft_()),a.left.isRed_()&&a.left.left.isRed_()&&(a=a.rotateRight_()),a.left.isRed_()&&a.right.isRed_()&&(a=a.colorFlip_()),a}moveRedLeft_(){let a=this.colorFlip_();return a.right.left.isRed_()&&(a=(a=(a=a.copy(null,null,null,null,a.right.rotateRight_())).rotateLeft_()).colorFlip_()),a}moveRedRight_(){let a=this.colorFlip_();return a.left.left.isRed_()&&(a=(a=a.rotateRight_()).colorFlip_()),a}rotateLeft_(){let a=this.copy(null,null,c6.RED,null,this.right.left);return this.right.copy(null,null,this.color,a,null)}rotateRight_(){let a=this.copy(null,null,c6.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,a)}colorFlip_(){let a=this.left.copy(null,null,!this.left.color,null,null),b=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,a,b)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let a=this.left.check_();if(a===this.right.check_())return a+ +!this.isRed_();throw Error("Black depths differ")}}c6.RED=!0,c6.BLACK=!1;class c7{constructor(a,b=c7.EMPTY_NODE){this.comparator_=a,this.root_=b}insert(a,b){return new c7(this.comparator_,this.root_.insert(a,b,this.comparator_).copy(null,null,c6.BLACK,null,null))}remove(a){return new c7(this.comparator_,this.root_.remove(a,this.comparator_).copy(null,null,c6.BLACK,null,null))}get(a){let b,c=this.root_;for(;!c.isEmpty();){if(0===(b=this.comparator_(a,c.key)))return c.value;b<0?c=c.left:b>0&&(c=c.right)}return null}getPredecessorKey(a){let b,c=this.root_,d=null;for(;!c.isEmpty();){if(0===(b=this.comparator_(a,c.key)))if(c.left.isEmpty())if(d)return d.key;else return null;else{for(c=c.left;!c.right.isEmpty();)c=c.right;return c.key}b<0?c=c.left:b>0&&(d=c,c=c.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(a){return this.root_.inorderTraversal(a)}reverseTraversal(a){return this.root_.reverseTraversal(a)}getIterator(a){return new c5(this.root_,null,this.comparator_,!1,a)}getIteratorFrom(a,b){return new c5(this.root_,a,this.comparator_,!1,b)}getReverseIteratorFrom(a,b){return new c5(this.root_,a,this.comparator_,!0,b)}getReverseIterator(a){return new c5(this.root_,null,this.comparator_,!0,a)}}function c8(a,b){return cc(a.name,b.name)}function c9(a,b){return cc(a,b)}c7.EMPTY_NODE=new class{copy(a,b,c,d,e){return this}insert(a,b,c){return new c6(a,b,null)}remove(a,b){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(a){return!1}reverseTraversal(a){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let da=function(a){return"number"==typeof a?"number:"+ci(a):"string:"+a},db=function(a){if(a.isLeafNode()){let b=a.val();ah("string"==typeof b||"number"==typeof b||"object"==typeof b&&aF(b,".sv"),"Priority must be a string or number.")}else ah(a===e||a.isEmpty(),"priority of unexpected type.");ah(a===e||a.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class dc{static set __childrenNodeConstructor(a){f=a}static get __childrenNodeConstructor(){return f}constructor(a,b=dc.__childrenNodeConstructor.EMPTY_NODE){this.value_=a,this.priorityNode_=b,this.lazyHash_=null,ah(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),db(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(a){return new dc(this.value_,a)}getImmediateChild(a){return".priority"===a?this.priorityNode_:dc.__childrenNodeConstructor.EMPTY_NODE}getChild(a){return cT(a)?this:".priority"===cM(a)?this.priorityNode_:dc.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(a,b){return null}updateImmediateChild(a,b){return".priority"===a?this.updatePriority(b):b.isEmpty()&&".priority"!==a?this:dc.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(a,b).updatePriority(this.priorityNode_)}updateChild(a,b){let c=cM(a);return null===c?b:b.isEmpty()&&".priority"!==c?this:(ah(".priority"!==c||1===cN(a),".priority must be the last token in a path"),this.updateImmediateChild(c,dc.__childrenNodeConstructor.EMPTY_NODE.updateChild(cO(a),b)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(a,b){return!1}val(a){return a&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let a="";this.priorityNode_.isEmpty()||(a+="priority:"+da(this.priorityNode_.val())+":");let b=typeof this.value_;a+=b+":","number"===b?a+=ci(this.value_):a+=this.value_,this.lazyHash_=bZ(a)}return this.lazyHash_}getValue(){return this.value_}compareTo(a){return a===dc.__childrenNodeConstructor.EMPTY_NODE?1:a instanceof dc.__childrenNodeConstructor?-1:(ah(a.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(a))}compareToLeafNode_(a){let b=typeof a.value_,c=typeof this.value_,d=dc.VALUE_TYPE_ORDER.indexOf(b),e=dc.VALUE_TYPE_ORDER.indexOf(c);return(ah(d>=0,"Unknown leaf type: "+b),ah(e>=0,"Unknown leaf type: "+c),d!==e)?e-d:"object"===c?0:this.value_<a.value_?-1:1*(this.value_!==a.value_)}withIndex(){return this}isIndexed(){return!0}equals(a){return a===this||!!a.isLeafNode()&&this.value_===a.value_&&this.priorityNode_.equals(a.priorityNode_)}}dc.VALUE_TYPE_ORDER=["object","boolean","number","string"];let dd=new class extends c2{compare(a,b){let c=a.node.getPriority(),d=b.node.getPriority(),e=c.compareTo(d);return 0===e?cc(a.name,b.name):e}isDefinedOn(a){return!a.getPriority().isEmpty()}indexedValueChanged(a,b){return!a.getPriority().equals(b.getPriority())}minPost(){return c1.MIN}maxPost(){return new c1(cb,new dc("[PRIORITY-POST]",h))}makePost(a,b){return new c1(b,new dc("[PRIORITY-POST]",g(a)))}toString(){return".priority"}},de=Math.log(2);class df{constructor(a){this.count=(a=>parseInt(Math.log(a)/de,10))(a+1),this.current_=this.count-1;const b=(a=>parseInt(Array(a+1).join("1"),2))(this.count);this.bits_=a+1&b}nextBitIsOne(){let a=!(this.bits_&1<<this.current_);return this.current_--,a}}let dg=function(a,b,c,d){a.sort(b);let e=function(b,d){let f,g=d-b;if(0===g)return null;if(1===g)return f=a[b],new c6(c?c(f):f,f.node,c6.BLACK,null,null);{let h=parseInt(g/2,10)+b,i=e(b,h),j=e(h+1,d);return f=a[h],new c6(c?c(f):f,f.node,c6.BLACK,i,j)}};return new c7(d||b,function(b){let d=null,f=null,g=a.length,h=function(b,d){let f=g-b,h=g;g-=b;let j=e(f+1,h),k=a[f];i(new c6(c?c(k):k,k.node,d,null,j))},i=function(a){d?d.left=a:f=a,d=a};for(let a=0;a<b.count;++a){let c=b.nextBitIsOne(),d=Math.pow(2,b.count-(a+1));c?h(d,c6.BLACK):(h(d,c6.BLACK),h(d,c6.RED))}return f}(new df(a.length)))},dh={};class di{static get Default(){return ah(dh&&dd,"ChildrenNode.ts has not been loaded"),i=i||new di({".priority":dh},{".priority":dd})}constructor(a,b){this.indexes_=a,this.indexSet_=b}get(a){let b=aG(this.indexes_,a);if(!b)throw Error("No index defined for "+a);return b instanceof c7?b:null}hasIndex(a){return aF(this.indexSet_,a.toString())}addIndex(a,b){let c;ah(a!==c4,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let d=[],e=!1,f=b.getIterator(c1.Wrap),g=f.getNext();for(;g;)e=e||a.isDefinedOn(g.node),d.push(g),g=f.getNext();c=e?dg(d,a.getCompare()):dh;let h=a.toString(),i={...this.indexSet_};i[h]=a;let j={...this.indexes_};return j[h]=c,new di(j,i)}addToIndexes(a,b){return new di(aI(this.indexes_,(c,d)=>{let e=aG(this.indexSet_,d);if(ah(e,"Missing index implementation for "+d),c===dh)if(!e.isDefinedOn(a.node))return dh;else{let c=[],d=b.getIterator(c1.Wrap),f=d.getNext();for(;f;)f.name!==a.name&&c.push(f),f=d.getNext();return c.push(a),dg(c,e.getCompare())}{let d=b.get(a.name),e=c;return d&&(e=e.remove(new c1(a.name,d))),e.insert(a,a.node)}}),this.indexSet_)}removeFromIndexes(a,b){return new di(aI(this.indexes_,c=>{if(c===dh)return c;{let d=b.get(a.name);return d?c.remove(new c1(a.name,d)):c}}),this.indexSet_)}}class dj{static get EMPTY_NODE(){return j||(j=new dj(new c7(c9),null,di.Default))}constructor(a,b,c){this.children_=a,this.priorityNode_=b,this.indexMap_=c,this.lazyHash_=null,this.priorityNode_&&db(this.priorityNode_),this.children_.isEmpty()&&ah(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||j}updatePriority(a){return this.children_.isEmpty()?this:new dj(this.children_,a,this.indexMap_)}getImmediateChild(a){if(".priority"===a)return this.getPriority();{let b=this.children_.get(a);return null===b?j:b}}getChild(a){let b=cM(a);return null===b?this:this.getImmediateChild(b).getChild(cO(a))}hasChild(a){return null!==this.children_.get(a)}updateImmediateChild(a,b){if(ah(b,"We should always be passing snapshot nodes"),".priority"===a)return this.updatePriority(b);{let c,d,e=new c1(a,b);b.isEmpty()?(c=this.children_.remove(a),d=this.indexMap_.removeFromIndexes(e,this.children_)):(c=this.children_.insert(a,b),d=this.indexMap_.addToIndexes(e,this.children_));let f=c.isEmpty()?j:this.priorityNode_;return new dj(c,f,d)}}updateChild(a,b){let c=cM(a);if(null===c)return b;{ah(".priority"!==cM(a)||1===cN(a),".priority must be the last token in a path");let d=this.getImmediateChild(c).updateChild(cO(a),b);return this.updateImmediateChild(c,d)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(a){if(this.isEmpty())return null;let b={},c=0,d=0,e=!0;if(this.forEachChild(dd,(f,g)=>{b[f]=g.val(a),c++,e&&dj.INTEGER_REGEXP_.test(f)?d=Math.max(d,Number(f)):e=!1}),a||!e||!(d<2*c))return a&&!this.getPriority().isEmpty()&&(b[".priority"]=this.getPriority().val()),b;{let a=[];for(let c in b)a[c]=b[c];return a}}hash(){if(null===this.lazyHash_){let a="";this.getPriority().isEmpty()||(a+="priority:"+da(this.getPriority().val())+":"),this.forEachChild(dd,(b,c)=>{let d=c.hash();""!==d&&(a+=":"+b+":"+d)}),this.lazyHash_=""===a?"":bZ(a)}return this.lazyHash_}getPredecessorChildName(a,b,c){let d=this.resolveIndex_(c);if(!d)return this.children_.getPredecessorKey(a);{let c=d.getPredecessorKey(new c1(a,b));return c?c.name:null}}getFirstChildName(a){let b=this.resolveIndex_(a);if(!b)return this.children_.minKey();{let a=b.minKey();return a&&a.name}}getFirstChild(a){let b=this.getFirstChildName(a);return b?new c1(b,this.children_.get(b)):null}getLastChildName(a){let b=this.resolveIndex_(a);if(!b)return this.children_.maxKey();{let a=b.maxKey();return a&&a.name}}getLastChild(a){let b=this.getLastChildName(a);return b?new c1(b,this.children_.get(b)):null}forEachChild(a,b){let c=this.resolveIndex_(a);return c?c.inorderTraversal(a=>b(a.name,a.node)):this.children_.inorderTraversal(b)}getIterator(a){return this.getIteratorFrom(a.minPost(),a)}getIteratorFrom(a,b){let c=this.resolveIndex_(b);if(c)return c.getIteratorFrom(a,a=>a);{let c=this.children_.getIteratorFrom(a.name,c1.Wrap),d=c.peek();for(;null!=d&&0>b.compare(d,a);)c.getNext(),d=c.peek();return c}}getReverseIterator(a){return this.getReverseIteratorFrom(a.maxPost(),a)}getReverseIteratorFrom(a,b){let c=this.resolveIndex_(b);if(c)return c.getReverseIteratorFrom(a,a=>a);{let c=this.children_.getReverseIteratorFrom(a.name,c1.Wrap),d=c.peek();for(;null!=d&&b.compare(d,a)>0;)c.getNext(),d=c.peek();return c}}compareTo(a){if(this.isEmpty())if(a.isEmpty())return 0;else return -1;return a.isLeafNode()||a.isEmpty()?1:a===dk?-1:0}withIndex(a){if(a===c4||this.indexMap_.hasIndex(a))return this;{let b=this.indexMap_.addIndex(a,this.children_);return new dj(this.children_,this.priorityNode_,b)}}isIndexed(a){return a===c4||this.indexMap_.hasIndex(a)}equals(a){if(a===this)return!0;if(a.isLeafNode()||!this.getPriority().equals(a.getPriority()))return!1;if(this.children_.count()!==a.children_.count())return!1;{let b=this.getIterator(dd),c=a.getIterator(dd),d=b.getNext(),e=c.getNext();for(;d&&e;){if(d.name!==e.name||!d.node.equals(e.node))return!1;d=b.getNext(),e=c.getNext()}return null===d&&null===e}}resolveIndex_(a){return a===c4?null:this.indexMap_.get(a.toString())}}dj.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;let dk=new class extends dj{constructor(){super(new c7(c9),dj.EMPTY_NODE,di.Default)}compareTo(a){return+(a!==this)}equals(a){return a===this}getPriority(){return this}getImmediateChild(a){return dj.EMPTY_NODE}isEmpty(){return!1}};function dl(a,b=null){if(null===a)return dj.EMPTY_NODE;if("object"==typeof a&&".priority"in a&&(b=a[".priority"]),ah(null===b||"string"==typeof b||"number"==typeof b||"object"==typeof b&&".sv"in b,"Invalid priority type found: "+typeof b),"object"==typeof a&&".value"in a&&null!==a[".value"]&&(a=a[".value"]),"object"!=typeof a||".sv"in a)return new dc(a,dl(b));if(a instanceof Array){let c=dj.EMPTY_NODE;return ch(a,(b,d)=>{if(aF(a,b)&&"."!==b.substring(0,1)){let a=dl(d);(a.isLeafNode()||!a.isEmpty())&&(c=c.updateImmediateChild(b,a))}}),c.updatePriority(dl(b))}{let c=[],d=!1;if(ch(a,(a,b)=>{if("."!==a.substring(0,1)){let e=dl(b);e.isEmpty()||(d=d||!e.getPriority().isEmpty(),c.push(new c1(a,e)))}}),0===c.length)return dj.EMPTY_NODE;let e=dg(c,c8,a=>a.name,c9);if(!d)return new dj(e,dl(b),di.Default);{let a=dg(c,dd.getCompare());return new dj(e,dl(b),new di({".priority":a},{".priority":dd}))}}}Object.defineProperties(c1,{MIN:{value:new c1(ca,dj.EMPTY_NODE)},MAX:{value:new c1(cb,dk)}}),c3.__EMPTY_NODE=dj.EMPTY_NODE,dc.__childrenNodeConstructor=dj,e=dk,h=dk,g=dl;class dm extends c2{constructor(a){super(),this.indexPath_=a,ah(!cT(a)&&".priority"!==cM(a),"Can't create PathIndex with empty path or .priority key")}extractChild(a){return a.getChild(this.indexPath_)}isDefinedOn(a){return!a.getChild(this.indexPath_).isEmpty()}compare(a,b){let c=this.extractChild(a.node),d=this.extractChild(b.node),e=c.compareTo(d);return 0===e?cc(a.name,b.name):e}makePost(a,b){let c=dl(a);return new c1(b,dj.EMPTY_NODE.updateChild(this.indexPath_,c))}maxPost(){return new c1(cb,dj.EMPTY_NODE.updateChild(this.indexPath_,dk))}toString(){return cQ(this.indexPath_,0).join("/")}}let dn=new class extends c2{compare(a,b){let c=a.node.compareTo(b.node);return 0===c?cc(a.name,b.name):c}isDefinedOn(a){return!0}indexedValueChanged(a,b){return!a.equals(b)}minPost(){return c1.MIN}maxPost(){return c1.MAX}makePost(a,b){return new c1(b,dl(a))}toString(){return".value"}};function dp(a){return{type:"value",snapshotNode:a}}function dq(a,b){return{type:"child_added",snapshotNode:b,childName:a}}function dr(a,b){return{type:"child_removed",snapshotNode:b,childName:a}}function ds(a,b,c){return{type:"child_changed",snapshotNode:b,childName:a,oldSnap:c}}class dt{constructor(a){this.index_=a}updateChild(a,b,c,d,e,f){ah(a.isIndexed(this.index_),"A node must be indexed if only a child is updated");let g=a.getImmediateChild(b);return g.getChild(d).equals(c.getChild(d))&&g.isEmpty()===c.isEmpty()||(null!=f&&(c.isEmpty()?a.hasChild(b)?f.trackChildChange(dr(b,g)):ah(a.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):g.isEmpty()?f.trackChildChange(dq(b,c)):f.trackChildChange(ds(b,c,g))),a.isLeafNode()&&c.isEmpty())?a:a.updateImmediateChild(b,c).withIndex(this.index_)}updateFullNode(a,b,c){return null!=c&&(a.isLeafNode()||a.forEachChild(dd,(a,d)=>{b.hasChild(a)||c.trackChildChange(dr(a,d))}),b.isLeafNode()||b.forEachChild(dd,(b,d)=>{if(a.hasChild(b)){let e=a.getImmediateChild(b);e.equals(d)||c.trackChildChange(ds(b,d,e))}else c.trackChildChange(dq(b,d))})),b.withIndex(this.index_)}updatePriority(a,b){return a.isEmpty()?dj.EMPTY_NODE:a.updatePriority(b)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class du{constructor(a){this.indexedFilter_=new dt(a.getIndex()),this.index_=a.getIndex(),this.startPost_=du.getStartPost_(a),this.endPost_=du.getEndPost_(a),this.startIsInclusive_=!a.startAfterSet_,this.endIsInclusive_=!a.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(a){let b=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),a):0>this.index_.compare(this.getStartPost(),a),c=this.endIsInclusive_?0>=this.index_.compare(a,this.getEndPost()):0>this.index_.compare(a,this.getEndPost());return b&&c}updateChild(a,b,c,d,e,f){return this.matches(new c1(b,c))||(c=dj.EMPTY_NODE),this.indexedFilter_.updateChild(a,b,c,d,e,f)}updateFullNode(a,b,c){b.isLeafNode()&&(b=dj.EMPTY_NODE);let d=b.withIndex(this.index_);d=d.updatePriority(dj.EMPTY_NODE);let e=this;return b.forEachChild(dd,(a,b)=>{e.matches(new c1(a,b))||(d=d.updateImmediateChild(a,dj.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(a,d,c)}updatePriority(a,b){return a}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(a){if(!a.hasStart())return a.getIndex().minPost();{let b=a.getIndexStartName();return a.getIndex().makePost(a.getIndexStartValue(),b)}}static getEndPost_(a){if(!a.hasEnd())return a.getIndex().maxPost();{let b=a.getIndexEndName();return a.getIndex().makePost(a.getIndexEndValue(),b)}}}class dv{constructor(a){this.withinDirectionalStart=a=>this.reverse_?this.withinEndPost(a):this.withinStartPost(a),this.withinDirectionalEnd=a=>this.reverse_?this.withinStartPost(a):this.withinEndPost(a),this.withinStartPost=a=>{let b=this.index_.compare(this.rangedFilter_.getStartPost(),a);return this.startIsInclusive_?b<=0:b<0},this.withinEndPost=a=>{let b=this.index_.compare(a,this.rangedFilter_.getEndPost());return this.endIsInclusive_?b<=0:b<0},this.rangedFilter_=new du(a),this.index_=a.getIndex(),this.limit_=a.getLimit(),this.reverse_=!a.isViewFromLeft(),this.startIsInclusive_=!a.startAfterSet_,this.endIsInclusive_=!a.endBeforeSet_}updateChild(a,b,c,d,e,f){return(this.rangedFilter_.matches(new c1(b,c))||(c=dj.EMPTY_NODE),a.getImmediateChild(b).equals(c))?a:a.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(a,b,c,d,e,f):this.fullLimitUpdateChild_(a,b,c,e,f)}updateFullNode(a,b,c){let d;if(b.isLeafNode()||b.isEmpty())d=dj.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<b.numChildren()&&b.isIndexed(this.index_)){let a;d=dj.EMPTY_NODE.withIndex(this.index_),a=this.reverse_?b.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):b.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let c=0;for(;a.hasNext()&&c<this.limit_;){let b=a.getNext();if(this.withinDirectionalStart(b))if(this.withinDirectionalEnd(b))d=d.updateImmediateChild(b.name,b.node),c++;else break}}else{let a;d=(d=b.withIndex(this.index_)).updatePriority(dj.EMPTY_NODE),a=this.reverse_?d.getReverseIterator(this.index_):d.getIterator(this.index_);let c=0;for(;a.hasNext();){let b=a.getNext();c<this.limit_&&this.withinDirectionalStart(b)&&this.withinDirectionalEnd(b)?c++:d=d.updateImmediateChild(b.name,dj.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(a,d,c)}updatePriority(a,b){return a}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(a,b,c,d,e){let f;if(this.reverse_){let a=this.index_.getCompare();f=(b,c)=>a(c,b)}else f=this.index_.getCompare();ah(a.numChildren()===this.limit_,"");let g=new c1(b,c),h=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),i=this.rangedFilter_.matches(g);if(a.hasChild(b)){let j=a.getImmediateChild(b),k=d.getChildAfterChild(this.index_,h,this.reverse_);for(;null!=k&&(k.name===b||a.hasChild(k.name));)k=d.getChildAfterChild(this.index_,k,this.reverse_);let l=null==k?1:f(k,g);if(i&&!c.isEmpty()&&l>=0)return null!=e&&e.trackChildChange(ds(b,c,j)),a.updateImmediateChild(b,c);{null!=e&&e.trackChildChange(dr(b,j));let c=a.updateImmediateChild(b,dj.EMPTY_NODE);return null!=k&&this.rangedFilter_.matches(k)?(null!=e&&e.trackChildChange(dq(k.name,k.node)),c.updateImmediateChild(k.name,k.node)):c}}return c.isEmpty()?a:i?f(h,g)>=0?(null!=e&&(e.trackChildChange(dr(h.name,h.node)),e.trackChildChange(dq(b,c))),a.updateImmediateChild(b,c).updateImmediateChild(h.name,dj.EMPTY_NODE)):a:a}}class dw{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=dd}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return ah(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(ah(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:ca}hasEnd(){return this.endSet_}getIndexEndValue(){return ah(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(ah(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:cb}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return ah(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===dd}copy(){let a=new dw;return a.limitSet_=this.limitSet_,a.limit_=this.limit_,a.startSet_=this.startSet_,a.startAfterSet_=this.startAfterSet_,a.indexStartValue_=this.indexStartValue_,a.startNameSet_=this.startNameSet_,a.indexStartName_=this.indexStartName_,a.endSet_=this.endSet_,a.endBeforeSet_=this.endBeforeSet_,a.indexEndValue_=this.indexEndValue_,a.endNameSet_=this.endNameSet_,a.indexEndName_=this.indexEndName_,a.index_=this.index_,a.viewFrom_=this.viewFrom_,a}}function dx(a){let b,c={};if(a.isDefault())return c;if(a.index_===dd?b="$priority":a.index_===dn?b="$value":a.index_===c4?b="$key":(ah(a.index_ instanceof dm,"Unrecognized index type!"),b=a.index_.toString()),c.orderBy=aB(b),a.startSet_){let b=a.startAfterSet_?"startAfter":"startAt";c[b]=aB(a.indexStartValue_),a.startNameSet_&&(c[b]+=","+aB(a.indexStartName_))}if(a.endSet_){let b=a.endBeforeSet_?"endBefore":"endAt";c[b]=aB(a.indexEndValue_),a.endNameSet_&&(c[b]+=","+aB(a.indexEndName_))}return a.limitSet_&&(a.isViewFromLeft()?c.limitToFirst=a.limit_:c.limitToLast=a.limit_),c}function dy(a){let b={};if(a.startSet_&&(b.sp=a.indexStartValue_,a.startNameSet_&&(b.sn=a.indexStartName_),b.sin=!a.startAfterSet_),a.endSet_&&(b.ep=a.indexEndValue_,a.endNameSet_&&(b.en=a.indexEndName_),b.ein=!a.endBeforeSet_),a.limitSet_){b.l=a.limit_;let c=a.viewFrom_;""===c&&(c=a.isViewFromLeft()?"l":"r"),b.vf=c}return a.index_!==dd&&(b.i=a.index_.toString()),b}class dz extends cH{reportStats(a){throw Error("Method not implemented.")}static getListenId_(a,b){return void 0!==b?"tag$"+b:(ah(a._queryParams.isDefault(),"should have a tag if it's not a default query."),a._path.toString())}constructor(a,b,c,d){super(),this.repoInfo_=a,this.onDataUpdate_=b,this.authTokenProvider_=c,this.appCheckTokenProvider_=d,this.log_=b3("p:rest:"),this.listens_={}}listen(a,b,c,d){let e=a._path.toString();this.log_("Listen called for "+e+" "+a._queryIdentifier);let f=dz.getListenId_(a,c),g={};this.listens_[f]=g;let h=dx(a._queryParams);this.restRequest_(e+".json",h,(a,b)=>{let h=b;(404===a&&(h=null,a=null),null===a&&this.onDataUpdate_(e,h,!1,c),aG(this.listens_,f)===g)&&d(a?401===a?"permission_denied":"rest_error:"+a:"ok",null)})}unlisten(a,b){let c=dz.getListenId_(a,b);delete this.listens_[c]}get(a){let b=dx(a._queryParams),c=a._path.toString(),d=new as;return this.restRequest_(c+".json",b,(a,b)=>{let e=b;404===a&&(e=null,a=null),null===a?(this.onDataUpdate_(c,e,!1,null),d.resolve(e)):d.reject(Error(e))}),d.promise}refreshAuthToken(a){}restRequest_(a,b={},c){return b.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([d,e])=>{d&&d.accessToken&&(b.auth=d.accessToken),e&&e.token&&(b.ac=e.token);let f=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+a+"?ns="+this.repoInfo_.namespace+function(a){let b=[];for(let[c,d]of Object.entries(a))Array.isArray(d)?d.forEach(a=>{b.push(encodeURIComponent(c)+"="+encodeURIComponent(a))}):b.push(encodeURIComponent(c)+"="+encodeURIComponent(d));return b.length?"&"+b.join("&"):""}(b);this.log_("Sending REST request for "+f);let g=new XMLHttpRequest;g.onreadystatechange=()=>{if(c&&4===g.readyState){this.log_("REST Response for "+f+" received. status:",g.status,"response:",g.responseText);let a=null;if(g.status>=200&&g.status<300){try{a=aA(g.responseText)}catch(a){b6("Failed to parse JSON response for "+f+": "+g.responseText)}c(null,a)}else 401!==g.status&&404!==g.status&&b6("Got unsuccessful REST response for "+f+" Status: "+g.status),c(g.status);c=null}},g.open("GET",f,!0),g.send()})}}class dA{constructor(){this.rootNode_=dj.EMPTY_NODE}getNode(a){return this.rootNode_.getChild(a)}updateSnapshot(a,b){this.rootNode_=this.rootNode_.updateChild(a,b)}}function dB(){return{value:null,children:new Map}}function dC(a,b,c){if(cT(b))a.value=c,a.children.clear();else if(null!==a.value)a.value=a.value.updateChild(b,c);else{let d=cM(b);a.children.has(d)||a.children.set(d,dB()),dC(a.children.get(d),b=cO(b),c)}}function dD(a,b,c){var d,e;null!==a.value?c(b,a.value):(d=a,e=(a,d)=>{dD(d,new cK(b.toString()+"/"+a),c)},d.children.forEach((a,b)=>{e(b,a)}))}class dE{constructor(a){this.collection_=a,this.last_=null}get(){let a=this.collection_.get(),b={...a};return this.last_&&ch(this.last_,(a,c)=>{b[a]=b[a]-c}),this.last_=a,b}}class dF{constructor(a,b){this.server_=b,this.statsToReport_={},this.statsListener_=new dE(a);const c=1e4+2e4*Math.random();cm(this.reportStats_.bind(this),Math.floor(c))}reportStats_(){let a=this.statsListener_.get(),b={},c=!1;ch(a,(a,d)=>{d>0&&aF(this.statsToReport_,a)&&(b[a]=d,c=!0)}),c&&this.server_.reportStats(b),cm(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function dG(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function dH(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function dI(a){return{fromUser:!1,fromServer:!0,queryId:a,tagged:!0}}(s=u||(u={}))[s.OVERWRITE=0]="OVERWRITE",s[s.MERGE=1]="MERGE",s[s.ACK_USER_WRITE=2]="ACK_USER_WRITE",s[s.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class dJ{constructor(a,b,c){this.path=a,this.affectedTree=b,this.revert=c,this.type=u.ACK_USER_WRITE,this.source=dG()}operationForChild(a){if(!cT(this.path))return ah(cM(this.path)===a,"operationForChild called for unrelated child."),new dJ(cO(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return ah(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let b=this.affectedTree.subtree(new cK(a));return new dJ(cL(),b,this.revert)}}}class dK{constructor(a,b){this.source=a,this.path=b,this.type=u.LISTEN_COMPLETE}operationForChild(a){return cT(this.path)?new dK(this.source,cL()):new dK(this.source,cO(this.path))}}class dL{constructor(a,b,c){this.source=a,this.path=b,this.snap=c,this.type=u.OVERWRITE}operationForChild(a){return cT(this.path)?new dL(this.source,cL(),this.snap.getImmediateChild(a)):new dL(this.source,cO(this.path),this.snap)}}class dM{constructor(a,b,c){this.source=a,this.path=b,this.children=c,this.type=u.MERGE}operationForChild(a){if(!cT(this.path))return ah(cM(this.path)===a,"Can't get a merge for a child not on the path of the operation"),new dM(this.source,cO(this.path),this.children);{let b=this.children.subtree(new cK(a));return b.isEmpty()?null:b.value?new dL(this.source,cL(),b.value):new dM(this.source,cL(),b)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class dN{constructor(a,b,c){this.node_=a,this.fullyInitialized_=b,this.filtered_=c}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(a){if(cT(a))return this.isFullyInitialized()&&!this.filtered_;let b=cM(a);return this.isCompleteForChild(b)}isCompleteForChild(a){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(a)}getNode(){return this.node_}}class dO{constructor(a){this.query_=a,this.index_=this.query_._queryParams.getIndex()}}function dP(a,b,c,d,e,f){let g=d.filter(a=>a.type===c);g.sort((b,c)=>(function(a,b,c){if(null==b.childName||null==c.childName)throw ai("Should only compare child_ events.");let d=new c1(b.childName,b.snapshotNode),e=new c1(c.childName,c.snapshotNode);return a.index_.compare(d,e)})(a,b,c)),g.forEach(c=>{var d,g,h;let i=(d=a,g=c,h=f,"value"===g.type||"child_removed"===g.type||(g.prevName=h.getPredecessorChildName(g.childName,g.snapshotNode,d.index_)),g);e.forEach(d=>{d.respondsTo(c.type)&&b.push(d.createEvent(i,a.query_))})})}function dQ(a,b){return{eventCache:a,serverCache:b}}function dR(a,b,c,d){return dQ(new dN(b,c,d),a.serverCache)}function dS(a,b,c,d){return dQ(a.eventCache,new dN(b,c,d))}function dT(a){return a.eventCache.isFullyInitialized()?a.eventCache.getNode():null}function dU(a){return a.serverCache.isFullyInitialized()?a.serverCache.getNode():null}class dV{static fromObject(a){let b=new dV(null);return ch(a,(a,c)=>{b=b.set(new cK(a),c)}),b}constructor(a,b=(!k&&(k=new c7(cd)),k)){this.value=a,this.children=b}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(a,b){if(null!=this.value&&b(this.value))return{path:cL(),value:this.value};{if(cT(a))return null;let c=cM(a),d=this.children.get(c);if(null===d)return null;{let e=d.findRootMostMatchingPathAndValue(cO(a),b);return null!=e?{path:cS(new cK(c),e.path),value:e.value}:null}}}findRootMostValueAndPath(a){return this.findRootMostMatchingPathAndValue(a,()=>!0)}subtree(a){if(cT(a))return this;{let b=cM(a),c=this.children.get(b);return null!==c?c.subtree(cO(a)):new dV(null)}}set(a,b){if(cT(a))return new dV(b,this.children);{let c=cM(a),d=(this.children.get(c)||new dV(null)).set(cO(a),b),e=this.children.insert(c,d);return new dV(this.value,e)}}remove(a){if(cT(a))if(this.children.isEmpty())return new dV(null);else return new dV(null,this.children);{let b=cM(a),c=this.children.get(b);if(!c)return this;{let d,e=c.remove(cO(a));return(d=e.isEmpty()?this.children.remove(b):this.children.insert(b,e),null===this.value&&d.isEmpty())?new dV(null):new dV(this.value,d)}}}get(a){if(cT(a))return this.value;{let b=cM(a),c=this.children.get(b);return c?c.get(cO(a)):null}}setTree(a,b){if(cT(a))return b;{let c,d=cM(a),e=(this.children.get(d)||new dV(null)).setTree(cO(a),b);return c=e.isEmpty()?this.children.remove(d):this.children.insert(d,e),new dV(this.value,c)}}fold(a){return this.fold_(cL(),a)}fold_(a,b){let c={};return this.children.inorderTraversal((d,e)=>{c[d]=e.fold_(cS(a,d),b)}),b(a,this.value,c)}findOnPath(a,b){return this.findOnPath_(a,cL(),b)}findOnPath_(a,b,c){let d=!!this.value&&c(b,this.value);if(d)return d;{if(cT(a))return null;let d=cM(a),e=this.children.get(d);return e?e.findOnPath_(cO(a),cS(b,d),c):null}}foreachOnPath(a,b){return this.foreachOnPath_(a,cL(),b)}foreachOnPath_(a,b,c){if(cT(a))return this;{this.value&&c(b,this.value);let d=cM(a),e=this.children.get(d);return e?e.foreachOnPath_(cO(a),cS(b,d),c):new dV(null)}}foreach(a){this.foreach_(cL(),a)}foreach_(a,b){this.children.inorderTraversal((c,d)=>{d.foreach_(cS(a,c),b)}),this.value&&b(a,this.value)}foreachChild(a){this.children.inorderTraversal((b,c)=>{c.value&&a(b,c.value)})}}class dW{constructor(a){this.writeTree_=a}static empty(){return new dW(new dV(null))}}function dX(a,b,c){if(cT(b))return new dW(new dV(c));{let d=a.writeTree_.findRootMostValueAndPath(b);if(null!=d){let e=d.path,f=d.value,g=cU(e,b);return f=f.updateChild(g,c),new dW(a.writeTree_.set(e,f))}{let d=new dV(c);return new dW(a.writeTree_.setTree(b,d))}}}function dY(a,b,c){let d=a;return ch(c,(a,c)=>{d=dX(d,cS(b,a),c)}),d}function dZ(a,b){return cT(b)?dW.empty():new dW(a.writeTree_.setTree(b,new dV(null)))}function d$(a,b){return null!=d_(a,b)}function d_(a,b){let c=a.writeTree_.findRootMostValueAndPath(b);return null!=c?a.writeTree_.get(c.path).getChild(cU(c.path,b)):null}function d0(a){let b=[],c=a.writeTree_.value;return null!=c?c.isLeafNode()||c.forEachChild(dd,(a,c)=>{b.push(new c1(a,c))}):a.writeTree_.children.inorderTraversal((a,c)=>{null!=c.value&&b.push(new c1(a,c.value))}),b}function d1(a,b){if(cT(b))return a;{let c=d_(a,b);return new dW(null!=c?new dV(c):a.writeTree_.subtree(b))}}function d2(a){return a.writeTree_.isEmpty()}function d3(a,b){return function a(b,c,d){if(null!=c.value)return d.updateChild(b,c.value);{let e=null;return c.children.inorderTraversal((c,f)=>{".priority"===c?(ah(null!==f.value,"Priority writes must always be leaf nodes"),e=f.value):d=a(cS(b,c),f,d)}),d.getChild(b).isEmpty()||null===e||(d=d.updateChild(cS(b,".priority"),e)),d}}(cL(),a.writeTree_,b)}function d4(a){return a.visible}function d5(a,b,c){let d=dW.empty();for(let e=0;e<a.length;++e){let f=a[e];if(b(f)){let a,b=f.path;if(f.snap)cX(c,b)?d=dX(d,a=cU(c,b),f.snap):cX(b,c)&&(a=cU(b,c),d=dX(d,cL(),f.snap.getChild(a)));else if(f.children){if(cX(c,b))d=dY(d,a=cU(c,b),f.children);else if(cX(b,c))if(cT(a=cU(b,c)))d=dY(d,cL(),f.children);else{let b=aG(f.children,cM(a));if(b){let c=b.getChild(cO(a));d=dX(d,cL(),c)}}}else throw ai("WriteRecord should have .snap or .children")}}return d}function d6(a,b,c,d,e){if(d||e){let f=d1(a.visibleWrites,b);return!e&&d2(f)?c:e||null!=c||d$(f,cL())?d3(d5(a.allWrites,function(a){return(a.visible||e)&&(!d||!~d.indexOf(a.writeId))&&(cX(a.path,b)||cX(b,a.path))},b),c||dj.EMPTY_NODE):null}{let d=d_(a.visibleWrites,b);if(null!=d)return d;{let d=d1(a.visibleWrites,b);return d2(d)?c:null!=c||d$(d,cL())?d3(d,c||dj.EMPTY_NODE):null}}}function d7(a,b,c,d){return d6(a.writeTree,a.treePath,b,c,d)}function d8(a,b){return function(a,b,c){let d=dj.EMPTY_NODE,e=d_(a.visibleWrites,b);if(e)return e.isLeafNode()||e.forEachChild(dd,(a,b)=>{d=d.updateImmediateChild(a,b)}),d;if(!c)return d0(d1(a.visibleWrites,b)).forEach(a=>{d=d.updateImmediateChild(a.name,a.node)}),d;{let e=d1(a.visibleWrites,b);return c.forEachChild(dd,(a,b)=>{let c=d3(d1(e,new cK(a)),b);d=d.updateImmediateChild(a,c)}),d0(e).forEach(a=>{d=d.updateImmediateChild(a.name,a.node)}),d}}(a.writeTree,a.treePath,b)}function d9(a,b,c,d){return function(a,b,c,d,e){ah(d||e,"Either existingEventSnap or existingServerSnap must exist");let f=cS(b,c);if(d$(a.visibleWrites,f))return null;{let b=d1(a.visibleWrites,f);return d2(b)?e.getChild(c):d3(b,e.getChild(c))}}(a.writeTree,a.treePath,b,c,d)}function ea(a,b){var c,d;return c=a.writeTree,d=cS(a.treePath,b),d_(c.visibleWrites,d)}function eb(a,b,c){var d,e;let f,g;return d=a.writeTree,e=a.treePath,f=cS(e,b),null!=(g=d_(d.visibleWrites,f))?g:c.isCompleteForChild(b)?d3(d1(d.visibleWrites,f),c.getNode().getImmediateChild(b)):null}function ec(a,b){return ed(cS(a.treePath,b),a.writeTree)}function ed(a,b){return{treePath:a,writeTree:b}}class ee{constructor(){this.changeMap=new Map}trackChildChange(a){let b=a.type,c=a.childName;ah("child_added"===b||"child_changed"===b||"child_removed"===b,"Only child changes supported for tracking"),ah(".priority"!==c,"Only non-priority child changes can be tracked.");let d=this.changeMap.get(c);if(d){let e=d.type;if("child_added"===b&&"child_removed"===e)this.changeMap.set(c,ds(c,a.snapshotNode,d.snapshotNode));else if("child_removed"===b&&"child_added"===e)this.changeMap.delete(c);else if("child_removed"===b&&"child_changed"===e)this.changeMap.set(c,dr(c,d.oldSnap));else if("child_changed"===b&&"child_added"===e)this.changeMap.set(c,dq(c,a.snapshotNode));else if("child_changed"===b&&"child_changed"===e)this.changeMap.set(c,ds(c,a.snapshotNode,d.oldSnap));else throw ai("Illegal combination of changes: "+a+" occurred after "+d)}else this.changeMap.set(c,a)}getChanges(){return Array.from(this.changeMap.values())}}let ef=new class{getCompleteChild(a){return null}getChildAfterChild(a,b,c){return null}};class eg{constructor(a,b,c=null){this.writes_=a,this.viewCache_=b,this.optCompleteServerCache_=c}getCompleteChild(a){let b=this.viewCache_.eventCache;if(b.isCompleteForChild(a))return b.getNode().getImmediateChild(a);{let b=null!=this.optCompleteServerCache_?new dN(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return eb(this.writes_,a,b)}}getChildAfterChild(a,b,c){var d;let e=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:dU(this.viewCache_),f=(d=this.writes_,function(a,b,c,d,e,f,g){let h,i=d1(a.visibleWrites,b),j=d_(i,cL());if(null!=j)h=j;else{if(null==c)return[];h=d3(i,c)}if((h=h.withIndex(g)).isEmpty()||h.isLeafNode())return[];{let a=[],b=g.getCompare(),c=f?h.getReverseIteratorFrom(d,g):h.getIteratorFrom(d,g),e=c.getNext();for(;e&&a.length<1;)0!==b(e,d)&&a.push(e),e=c.getNext();return a}}(d.writeTree,d.treePath,e,b,1,c,a));return 0===f.length?null:f[0]}}function eh(a,b,c,d,e,f){let g=b.eventCache;if(null!=ea(d,c))return b;{let h,i;if(cT(c))if(ah(b.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),b.serverCache.isFiltered()){let c=dU(b),e=d8(d,c instanceof dj?c:dj.EMPTY_NODE);h=a.filter.updateFullNode(b.eventCache.getNode(),e,f)}else{let c=d7(d,dU(b));h=a.filter.updateFullNode(b.eventCache.getNode(),c,f)}else{let j=cM(c);if(".priority"===j){ah(1===cN(c),"Can't have a priority with additional path components");let e=g.getNode(),f=d9(d,c,e,i=b.serverCache.getNode());h=null!=f?a.filter.updatePriority(e,f):g.getNode()}else{let k,l=cO(c);if(g.isCompleteForChild(j)){i=b.serverCache.getNode();let a=d9(d,c,g.getNode(),i);k=null!=a?g.getNode().getImmediateChild(j).updateChild(l,a):g.getNode().getImmediateChild(j)}else k=eb(d,j,b.serverCache);h=null!=k?a.filter.updateChild(g.getNode(),j,k,l,e,f):g.getNode()}}return dR(b,h,g.isFullyInitialized()||cT(c),a.filter.filtersNodes())}}function ei(a,b,c,d,e,f,g,h){let i,j=b.serverCache,k=g?a.filter:a.filter.getIndexedFilter();if(cT(c))i=k.updateFullNode(j.getNode(),d,null);else if(k.filtersNodes()&&!j.isFiltered()){let a=j.getNode().updateChild(c,d);i=k.updateFullNode(j.getNode(),a,null)}else{let a=cM(c);if(!j.isCompleteForPath(c)&&cN(c)>1)return b;let e=cO(c),f=j.getNode().getImmediateChild(a).updateChild(e,d);i=".priority"===a?k.updatePriority(j.getNode(),f):k.updateChild(j.getNode(),a,f,e,ef,null)}let l=dS(b,i,j.isFullyInitialized()||cT(c),k.filtersNodes()),m=new eg(e,l,f);return eh(a,l,c,e,m,h)}function ej(a,b,c,d,e,f,g){let h,i,j=b.eventCache,k=new eg(e,b,f);if(cT(c))i=a.filter.updateFullNode(b.eventCache.getNode(),d,g),h=dR(b,i,!0,a.filter.filtersNodes());else{let e=cM(c);if(".priority"===e)i=a.filter.updatePriority(b.eventCache.getNode(),d),h=dR(b,i,j.isFullyInitialized(),j.isFiltered());else{let f,i=cO(c),l=j.getNode().getImmediateChild(e);if(cT(i))f=d;else{let a=k.getCompleteChild(e);f=null!=a?".priority"===cP(i)&&a.getChild(cR(i)).isEmpty()?a:a.updateChild(i,d):dj.EMPTY_NODE}h=l.equals(f)?b:dR(b,a.filter.updateChild(j.getNode(),e,f,i,k,g),j.isFullyInitialized(),a.filter.filtersNodes())}}return h}function ek(a,b){return a.eventCache.isCompleteForChild(b)}function el(a,b,c){return c.foreach((a,c)=>{b=b.updateChild(a,c)}),b}function em(a,b,c,d,e,f,g,h){let i;if(b.serverCache.getNode().isEmpty()&&!b.serverCache.isFullyInitialized())return b;let j=b;i=cT(c)?d:new dV(null).setTree(c,d);let k=b.serverCache.getNode();return i.children.inorderTraversal((c,d)=>{if(k.hasChild(c)){let i=el(a,b.serverCache.getNode().getImmediateChild(c),d);j=ei(a,j,new cK(c),i,e,f,g,h)}}),i.children.inorderTraversal((c,d)=>{let i=!b.serverCache.isCompleteForChild(c)&&null===d.value;if(!k.hasChild(c)&&!i){let i=el(a,b.serverCache.getNode().getImmediateChild(c),d);j=ei(a,j,new cK(c),i,e,f,g,h)}}),j}class en{constructor(a,b){this.query_=a,this.eventRegistrations_=[];const c=this.query_._queryParams,d=new dt(c.getIndex()),e=function(a){return a.loadsAllData()?new dt(a.getIndex()):a.hasLimit()?new dv(a):new du(a)}(c);this.processor_=function(a){return{filter:a}}(e);const f=b.serverCache,g=b.eventCache,h=d.updateFullNode(dj.EMPTY_NODE,f.getNode(),null),i=e.updateFullNode(dj.EMPTY_NODE,g.getNode(),null),j=new dN(h,f.isFullyInitialized(),d.filtersNodes()),k=new dN(i,g.isFullyInitialized(),e.filtersNodes());this.viewCache_=dQ(k,j),this.eventGenerator_=new dO(this.query_)}get query(){return this.query_}}function eo(a){return 0===a.eventRegistrations_.length}function ep(a,b,c){let d=[];if(c){ah(null==b,"A cancel should cancel all event registrations.");let e=a.query._path;a.eventRegistrations_.forEach(a=>{let b=a.createCancelEvent(c,e);b&&d.push(b)})}if(b){let c=[];for(let d=0;d<a.eventRegistrations_.length;++d){let e=a.eventRegistrations_[d];if(e.matches(b)){if(b.hasAnyCallback()){c=c.concat(a.eventRegistrations_.slice(d+1));break}}else c.push(e)}a.eventRegistrations_=c}else a.eventRegistrations_=[];return d}function eq(a,b,c,d){var e,f;b.type===u.MERGE&&null!==b.source.queryId&&(ah(dU(a.viewCache_),"We should always have a full cache before handling merges"),ah(dT(a.viewCache_),"Missing event cache, even though we have a server cache"));let g=a.viewCache_,h=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q;let r,s,t=new ee;if(c.type===u.OVERWRITE)c.source.fromUser?r=ej(a,b,c.path,c.snap,d,e,t):(ah(c.source.fromServer,"Unknown source."),s=c.source.tagged||b.serverCache.isFiltered()&&!cT(c.path),r=ei(a,b,c.path,c.snap,d,e,s,t));else if(c.type===u.MERGE){let m;c.source.fromUser?(f=a,g=b,h=c.path,i=c.children,j=d,k=e,l=t,m=g,i.foreach((a,b)=>{let c=cS(h,a);ek(g,cM(c))&&(m=ej(f,m,c,b,j,k,l))}),i.foreach((a,b)=>{let c=cS(h,a);ek(g,cM(c))||(m=ej(f,m,c,b,j,k,l))}),r=m):(ah(c.source.fromServer,"Unknown source."),s=c.source.tagged||b.serverCache.isFiltered(),r=em(a,b,c.path,c.children,d,e,s,t))}else if(c.type===u.ACK_USER_WRITE)r=c.revert?function(a,b,c,d,e,f){let g;if(null!=ea(d,c))return b;{let h,i=new eg(d,b,e),j=b.eventCache.getNode();if(cT(c)||".priority"===cM(c)){let c;if(b.serverCache.isFullyInitialized())c=d7(d,dU(b));else{let a=b.serverCache.getNode();ah(a instanceof dj,"serverChildren would be complete if leaf node"),c=d8(d,a)}h=a.filter.updateFullNode(j,c,f)}else{let e=cM(c),k=eb(d,e,b.serverCache);null==k&&b.serverCache.isCompleteForChild(e)&&(k=j.getImmediateChild(e)),(h=null!=k?a.filter.updateChild(j,e,k,cO(c),i,f):b.eventCache.getNode().hasChild(e)?a.filter.updateChild(j,e,dj.EMPTY_NODE,cO(c),i,f):j).isEmpty()&&b.serverCache.isFullyInitialized()&&(g=d7(d,dU(b))).isLeafNode()&&(h=a.filter.updateFullNode(h,g,f))}return g=b.serverCache.isFullyInitialized()||null!=ea(d,cL()),dR(b,h,g,a.filter.filtersNodes())}}(a,b,c.path,d,e,t):function(a,b,c,d,e,f,g){if(null!=ea(e,c))return b;let h=b.serverCache.isFiltered(),i=b.serverCache;if(null!=d.value)if(cT(c)&&i.isFullyInitialized()||i.isCompleteForPath(c))return ei(a,b,c,i.getNode().getChild(c),e,f,h,g);else{if(!cT(c))return b;let d=new dV(null);return i.getNode().forEachChild(c4,(a,b)=>{d=d.set(new cK(a),b)}),em(a,b,c,d,e,f,h,g)}{let j=new dV(null);return d.foreach((a,b)=>{let d=cS(c,a);i.isCompleteForPath(d)&&(j=j.set(a,i.getNode().getChild(d)))}),em(a,b,c,j,e,f,h,g)}}(a,b,c.path,c.affectedTree,d,e,t);else if(c.type===u.LISTEN_COMPLETE){let e;m=a,n=b,o=c.path,p=d,q=t,e=n.serverCache,r=eh(m,dS(n,e.getNode(),e.isFullyInitialized()||cT(o),e.isFiltered()),o,p,ef,q)}else throw ai("Unknown operation type: "+c.type);let v=t.getChanges();return function(a,b,c){let d=b.eventCache;if(d.isFullyInitialized()){let e=d.getNode().isLeafNode()||d.getNode().isEmpty(),f=dT(a);!(c.length>0)&&a.eventCache.isFullyInitialized()&&(!e||d.getNode().equals(f))&&d.getNode().getPriority().equals(f.getPriority())||c.push(dp(dT(b)))}}(b,r,v),{viewCache:r,changes:v}}(a.processor_,g,b,c,d);return e=a.processor_,ah((f=h.viewCache).eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),ah(f.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed"),ah(h.viewCache.serverCache.isFullyInitialized()||!g.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),a.viewCache_=h.viewCache,er(a,h.changes,h.viewCache.eventCache.getNode(),null)}function er(a,b,c,d){var e;let f,g,h=d?[d]:a.eventRegistrations_;return e=a.eventGenerator_,f=[],g=[],b.forEach(a=>{var b;"child_changed"===a.type&&e.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&g.push((b=a.childName,{type:"child_moved",snapshotNode:a.snapshotNode,childName:b}))}),dP(e,f,"child_removed",b,h,c),dP(e,f,"child_added",b,h,c),dP(e,f,"child_moved",g,h,c),dP(e,f,"child_changed",b,h,c),dP(e,f,"value",b,h,c),f}class es{constructor(){this.views=new Map}}function et(a,b,c,d){let e=b.source.queryId;if(null!==e){let f=a.views.get(e);return ah(null!=f,"SyncTree gave us an op for an invalid query."),eq(f,b,c,d)}{let e=[];for(let f of a.views.values())e=e.concat(eq(f,b,c,d));return e}}function eu(a){let b=[];for(let c of a.views.values())c.query._queryParams.loadsAllData()||b.push(c);return b}function ev(a,b){let c=null;for(let d of a.views.values())c=c||function(a,b){let c=dU(a.viewCache_);return c&&(a.query._queryParams.loadsAllData()||!cT(b)&&!c.getImmediateChild(cM(b)).isEmpty())?c.getChild(b):null}(d,b);return c}function ew(a,b){if(b._queryParams.loadsAllData())return ey(a);{let c=b._queryIdentifier;return a.views.get(c)}}function ex(a){return null!=ey(a)}function ey(a){for(let b of a.views.values())if(b.query._queryParams.loadsAllData())return b;return null}let ez=1;class eA{constructor(a){this.listenProvider_=a,this.syncPointTree_=new dV(null),this.pendingWriteTree_={visibleWrites:dW.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function eB(a,b,c,d,e){var f,g;return(f=a.pendingWriteTree_,g=e,ah(d>f.lastWriteId,"Stacking an older write on top of newer ones"),void 0===g&&(g=!0),f.allWrites.push({path:b,snap:c,writeId:d,visible:g}),g&&(f.visibleWrites=dX(f.visibleWrites,b,c)),f.lastWriteId=d,e)?eH(a,new dL(dG(),b,c)):[]}function eC(a,b,c=!1){let d=function(a,b){for(let c=0;c<a.allWrites.length;c++){let d=a.allWrites[c];if(d.writeId===b)return d}return null}(a.pendingWriteTree_,b);if(!function(a,b){var c;let d=a.allWrites.findIndex(a=>a.writeId===b);ah(d>=0,"removeWrite called with nonexistent writeId.");let e=a.allWrites[d];a.allWrites.splice(d,1);let f=e.visible,g=!1,h=a.allWrites.length-1;for(;f&&h>=0;){let b=a.allWrites[h];b.visible&&(h>=d&&function(a,b){if(a.snap)return cX(a.path,b);for(let c in a.children)if(a.children.hasOwnProperty(c)&&cX(cS(a.path,c),b))return!0;return!1}(b,e.path)?f=!1:cX(e.path,b.path)&&(g=!0)),h--}return!!f&&(g?((c=a).visibleWrites=d5(c.allWrites,d4,cL()),c.allWrites.length>0?c.lastWriteId=c.allWrites[c.allWrites.length-1].writeId:c.lastWriteId=-1):e.snap?a.visibleWrites=dZ(a.visibleWrites,e.path):ch(e.children,b=>{a.visibleWrites=dZ(a.visibleWrites,cS(e.path,b))}),!0)}(a.pendingWriteTree_,b))return[];{let b=new dV(null);return null!=d.snap?b=b.set(cL(),!0):ch(d.children,a=>{b=b.set(new cK(a),!0)}),eH(a,new dJ(d.path,b,c))}}function eD(a,b,c){return eH(a,new dL(dH(),b,c))}function eE(a,b,c,d,e=!1){let f=b._path,g=a.syncPointTree_.get(f),h=[];if(g&&("default"===b._queryIdentifier||null!=ew(g,b))){let k=function(a,b,c,d){let e=b._queryIdentifier,f=[],g=[],h=ex(a);if("default"===e)for(let[b,e]of a.views.entries())g=g.concat(ep(e,c,d)),eo(e)&&(a.views.delete(b),e.query._queryParams.loadsAllData()||f.push(e.query));else{let b=a.views.get(e);b&&(g=g.concat(ep(b,c,d)),eo(b)&&(a.views.delete(e),b.query._queryParams.loadsAllData()||f.push(b.query)))}return h&&!ex(a)&&f.push(new(ah(l,"Reference.ts has not been loaded"),l)(b._repo,b._path)),{removed:f,events:g}}(g,b,c,d);0===g.views.size&&(a.syncPointTree_=a.syncPointTree_.remove(f));let m=k.removed;if(h=k.events,!e){let c=-1!==m.findIndex(a=>a._queryParams.loadsAllData()),e=a.syncPointTree_.findOnPath(f,(a,b)=>ex(b));if(c&&!e){let b=a.syncPointTree_.subtree(f);if(!b.isEmpty()){let c=b.fold((a,b,c)=>{if(b&&ex(b))return[ey(b)];{let a=[];return b&&(a=eu(b)),ch(c,(b,c)=>{a=a.concat(c)}),a}});for(let b=0;b<c.length;++b){let d=c[b],e=d.query,f=eI(a,d);a.listenProvider_.startListening(eO(e),eJ(a,e),f.hashFn,f.onComplete)}}}e||!(m.length>0)||d||(c?a.listenProvider_.stopListening(eO(b),null):m.forEach(b=>{let c=a.queryToTagMap.get(eK(b));a.listenProvider_.stopListening(eO(b),c)}))}var i=a,j=m;for(let a=0;a<j.length;++a){let b=j[a];if(!b._queryParams.loadsAllData()){let a=eK(b),c=i.queryToTagMap.get(a);i.queryToTagMap.delete(a),i.tagToQueryMap.delete(c)}}}return h}function eF(a,b,c,d=!1){var e;let f,g,h,i,j=b._path,k=null,l=!1;a.syncPointTree_.foreachOnPath(j,(a,b)=>{let c=cU(a,j);k=k||ev(b,c),l=l||ex(b)});let m=a.syncPointTree_.get(j);m?(l=l||ex(m),k=k||ev(m,cL())):(m=new es,a.syncPointTree_=a.syncPointTree_.set(j,m)),null!=k?f=!0:(f=!1,k=dj.EMPTY_NODE,a.syncPointTree_.subtree(j).foreachChild((a,b)=>{let c=ev(b,cL());c&&(k=k.updateImmediateChild(a,c))}));let n=null!=ew(m,b);if(!n&&!b._queryParams.loadsAllData()){let c=eK(b);ah(!a.queryToTagMap.has(c),"View does not exist, but we have a tag");let d=ez++;a.queryToTagMap.set(c,d),a.tagToQueryMap.set(d,c)}let o=ed(j,a.pendingWriteTree_),p=(g=function(a,b,c,d,e){let f=b._queryIdentifier,g=a.views.get(f);if(!g){let a=d7(c,e?d:null),f=!1;return a?f=!0:(a=d instanceof dj?d8(c,d):dj.EMPTY_NODE,f=!1),new en(b,dQ(new dN(a,f,!1),new dN(d,e,!1)))}return g}(e=m,b,o,k,f),e.views.has(b._queryIdentifier)||e.views.set(b._queryIdentifier,g),g.eventRegistrations_.push(c),h=g.viewCache_.eventCache,i=[],h.getNode().isLeafNode()||h.getNode().forEachChild(dd,(a,b)=>{i.push(dq(a,b))}),h.isFullyInitialized()&&i.push(dp(h.getNode())),er(g,i,h.getNode(),c));if(!n&&!l&&!d){let c=ew(m,b);p=p.concat(function(a,b,c){let d=b._path,e=eJ(a,b),f=eI(a,c),g=a.listenProvider_.startListening(eO(b),e,f.hashFn,f.onComplete),h=a.syncPointTree_.subtree(d);if(e)ah(!ex(h.value),"If we're adding a query, it shouldn't be shadowed");else{let b=h.fold((a,b,c)=>{if(!cT(a)&&b&&ex(b))return[ey(b).query];{let a=[];return b&&(a=a.concat(eu(b).map(a=>a.query))),ch(c,(b,c)=>{a=a.concat(c)}),a}});for(let c=0;c<b.length;++c){let d=b[c];a.listenProvider_.stopListening(eO(d),eJ(a,d))}}return g}(a,b,c))}return p}function eG(a,b,c){let d=a.pendingWriteTree_,e=a.syncPointTree_.findOnPath(b,(a,c)=>{let d=ev(c,cU(a,b));if(d)return d});return d6(d,b,e,c,!0)}function eH(a,b){var c;return function a(b,c,d,e){if(cT(b.path))return function a(b,c,d,e){let f=c.get(cL());null==d&&null!=f&&(d=ev(f,cL()));let g=[];return c.children.inorderTraversal((c,f)=>{let h=d?d.getImmediateChild(c):null,i=ec(e,c),j=b.operationForChild(c);j&&(g=g.concat(a(j,f,h,i)))}),f&&(g=g.concat(et(f,b,e,d))),g}(b,c,d,e);{let f=c.get(cL());null==d&&null!=f&&(d=ev(f,cL()));let g=[],h=cM(b.path),i=b.operationForChild(h),j=c.children.get(h);if(j&&i){let b=d?d.getImmediateChild(h):null,c=ec(e,h);g=g.concat(a(i,j,b,c))}return f&&(g=g.concat(et(f,b,e,d))),g}}(b,a.syncPointTree_,null,(c=a.pendingWriteTree_,ed(cL(),c)))}function eI(a,b){let c=b.query,d=eJ(a,c);return{hashFn:()=>(b.viewCache_.serverCache.getNode()||dj.EMPTY_NODE).hash(),onComplete:b=>{var e;if("ok"===b)if(d)return function(a,b,c){let d=eL(a,c);if(!d)return[];{let c=eM(d),e=c.path,f=c.queryId,g=cU(e,b);return eN(a,e,new dK(dI(f),g))}}(a,c._path,d);else return e=c._path,eH(a,new dK(dH(),e));{let d,e,f=(d="Unknown Error","too_big"===b?d="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===b?d="Client doesn't have permission to access the desired data.":"unavailable"===b&&(d="The service is unavailable"),(e=Error(b+" at "+c._path.toString()+": "+d)).code=b.toUpperCase(),e);return eE(a,c,null,f)}}}}function eJ(a,b){let c=eK(b);return a.queryToTagMap.get(c)}function eK(a){return a._path.toString()+"$"+a._queryIdentifier}function eL(a,b){return a.tagToQueryMap.get(b)}function eM(a){let b=a.indexOf("$");return ah(-1!==b&&b<a.length-1,"Bad queryKey."),{queryId:a.substr(b+1),path:new cK(a.substr(0,b))}}function eN(a,b,c){let d=a.syncPointTree_.get(b);return ah(d,"Missing sync point for query tag that we're tracking"),et(d,c,ed(b,a.pendingWriteTree_),null)}function eO(a){return a._queryParams.loadsAllData()&&!a._queryParams.isDefault()?new(ah(m,"Reference.ts has not been loaded"),m)(a._repo,a._path):a}class eP{constructor(a){this.node_=a}getImmediateChild(a){return new eP(this.node_.getImmediateChild(a))}node(){return this.node_}}class eQ{constructor(a,b){this.syncTree_=a,this.path_=b}getImmediateChild(a){let b=cS(this.path_,a);return new eQ(this.syncTree_,b)}node(){return eG(this.syncTree_,this.path_)}}let eR=function(a,b,c){return a&&"object"==typeof a?(ah(".sv"in a,"Unexpected leaf node or priority contents"),"string"==typeof a[".sv"])?eS(a[".sv"],b,c):"object"==typeof a[".sv"]?eT(a[".sv"],b):void ah(!1,"Unexpected server value: "+JSON.stringify(a,null,2)):a},eS=function(a,b,c){if("timestamp"===a)return c.timestamp;ah(!1,"Unexpected server value: "+a)},eT=function(a,b,c){a.hasOwnProperty("increment")||ah(!1,"Unexpected server value: "+JSON.stringify(a,null,2));let d=a.increment;"number"!=typeof d&&ah(!1,"Unexpected increment value: "+d);let e=b.node();if(ah(null!=e,"Expected ChildrenNode.EMPTY_NODE for nulls"),!e.isLeafNode())return d;let f=e.getValue();return"number"!=typeof f?d:f+d},eU=function(a,b,c){return eV(a,new eP(b),c)};function eV(a,b,c){let d,e=eR(a.getPriority().val(),b.getImmediateChild(".priority"),c);if(!a.isLeafNode())return d=a,e!==a.getPriority().val()&&(d=d.updatePriority(new dc(e))),a.forEachChild(dd,(a,e)=>{let f=eV(e,b.getImmediateChild(a),c);f!==e&&(d=d.updateImmediateChild(a,f))}),d;{let d=eR(a.getValue(),b,c);return d!==a.getValue()||e!==a.getPriority().val()?new dc(d,dl(e)):a}}class eW{constructor(a="",b=null,c={children:{},childCount:0}){this.name=a,this.parent=b,this.node=c}}function eX(a,b){let c=b instanceof cK?b:new cK(b),d=a,e=cM(c);for(;null!==e;){let a=aG(d.node.children,e)||{children:{},childCount:0};d=new eW(e,d,a),e=cM(c=cO(c))}return d}function eY(a){return a.node.value}function eZ(a,b){a.node.value=b,function a(b){null!==b.parent&&function(b,c,d){let e=void 0===eY(d)&&!e$(d),f=aF(b.node.children,c);e&&f?(delete b.node.children[c],b.node.childCount--,a(b)):e||f||(b.node.children[c]=d.node,b.node.childCount++,a(b))}(b.parent,b.name,b)}(a)}function e$(a){return a.node.childCount>0}function e_(a,b){ch(a.node.children,(c,d)=>{b(new eW(c,a,d))})}function e0(a){return new cK(null===a.parent?a.name:e0(a.parent)+"/"+a.name)}let e1=/[\[\].#$\/\u0000-\u001F\u007F]/,e2=/[\[\].#$\u0000-\u001F\u007F]/,e3=function(a){return"string"==typeof a&&0!==a.length&&!e1.test(a)},e4=function(a){return"string"==typeof a&&0!==a.length&&!e2.test(a)},e5=function(a){return null===a||"string"==typeof a||"number"==typeof a&&!b8(a)||a&&"object"==typeof a&&aF(a,".sv")},e6=function(a,b,c,d){d&&void 0===b||e7(aM(a,"value"),b,c)},e7=function(a,b,c){let d=c instanceof cK?new cY(c,a):c;if(void 0===b)throw Error(a+"contains undefined "+c$(d));if("function"==typeof b)throw Error(a+"contains a function "+c$(d)+" with contents = "+b.toString());if(b8(b))throw Error(a+"contains "+b.toString()+" "+c$(d));if("string"==typeof b&&b.length>3495253.3333333335&&aO(b)>0xa00000)throw Error(a+"contains a string greater than 10485760 utf8 bytes "+c$(d)+" ('"+b.substring(0,50)+"...')");if(b&&"object"==typeof b){let c=!1,e=!1;if(ch(b,(b,f)=>{let g;if(".value"===b)c=!0;else if(".priority"!==b&&".sv"!==b&&(e=!0,!e3(b)))throw Error(a+" contains an invalid key ("+b+") "+c$(d)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');d.parts_.length>0&&(d.byteLength_+=1),d.parts_.push(b),d.byteLength_+=aO(b),cZ(d),e7(a,f,d),g=d.parts_.pop(),d.byteLength_-=aO(g),d.parts_.length>0&&(d.byteLength_-=1)}),c&&e)throw Error(a+' contains ".value" child '+c$(d)+" in addition to actual children.")}},e8=function(a,b){let c,d;for(c=0;c<b.length;c++){let e=cQ(d=b[c]);for(let b=0;b<e.length;b++)if(".priority"===e[b]&&b===e.length-1);else if(!e3(e[b]))throw Error(a+"contains an invalid key ("+e[b]+") in path "+d.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}b.sort(cV);let e=null;for(c=0;c<b.length;c++){if(d=b[c],null!==e&&cX(e,d))throw Error(a+"contains a path "+e.toString()+" that is ancestor of another path "+d.toString());e=d}},e9=function(a,b,c,d){if(d&&void 0===b)return;let e=aM(a,"values");if(!(b&&"object"==typeof b)||Array.isArray(b))throw Error(e+" must be an object containing the children to replace.");let f=[];ch(b,(a,b)=>{let d=new cK(a);if(e7(e,b,cS(c,d)),".priority"===cP(d)&&!e5(b))throw Error(e+"contains an invalid value for '"+d.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");f.push(d)}),e8(e,f)},fa=function(a,b,c){if(!c||void 0!==b){if(b8(b))throw Error(aM(a,"priority")+"is "+b.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!e5(b))throw Error(aM(a,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},fb=function(a,b,c,d){if((!d||void 0!==c)&&!e4(c))throw Error(aM(a,b)+'was an invalid path = "'+c+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},fc=function(a,b,c,d){c&&(c=c.replace(/^\/*\.info(\/|$)/,"/")),fb(a,b,c,d)},fd=function(a,b){if(".info"===cM(b))throw Error(a+" failed = Can't modify data under /.info/")},fe=function(a,b){var c;let d=b.path.toString();if("string"!=typeof b.repoInfo.host||0===b.repoInfo.host.length||!e3(b.repoInfo.namespace)&&"localhost"!==b.repoInfo.host.split(":")[0]||0!==d.length&&((c=d)&&(c=c.replace(/^\/*\.info(\/|$)/,"/")),!e4(c)))throw Error(aM(a,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class ff{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function fg(a,b){let c=null;for(let d=0;d<b.length;d++){let e=b[d],f=e.getPath();null===c||cW(f,c.path)||(a.eventLists_.push(c),c=null),null===c&&(c={events:[],path:f}),c.events.push(e)}c&&a.eventLists_.push(c)}function fh(a,b,c){fg(a,c),fj(a,a=>cW(a,b))}function fi(a,b,c){fg(a,c),fj(a,a=>cX(a,b)||cX(b,a))}function fj(a,b){a.recursionDepth_++;let c=!0;for(let d=0;d<a.eventLists_.length;d++){let e=a.eventLists_[d];e&&(b(e.path)?(function(a){for(let b=0;b<a.events.length;b++){let c=a.events[b];if(null!==c){a.events[b]=null;let d=c.getEventRunner();b_&&b2("event: "+c.toString()),cl(d)}}}(a.eventLists_[d]),a.eventLists_[d]=null):c=!1)}c&&(a.eventLists_=[]),a.recursionDepth_--}class fk{constructor(a,b,c,d){this.repoInfo_=a,this.forceRestClient_=b,this.authTokenProvider_=c,this.appCheckProvider_=d,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ff,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=dB(),this.transactionQueueTree_=new eW,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function fl(a){let b=a.infoData_.getNode(new cK(".info/serverTimeOffset")).val()||0;return new Date().getTime()+b}function fm(a){var b;return(b=b={timestamp:fl(a)}).timestamp=b.timestamp||new Date().getTime(),b}function fn(a,b,c,d,e){a.dataUpdateCount++;let f=new cK(b);c=a.interceptServerDataCallback_?a.interceptServerDataCallback_(b,c):c;let g=[];if(e)if(d){let b=aI(c,a=>dl(a));g=function(a,b,c,d){let e=eL(a,d);if(!e)return[];{let d=eM(e),f=d.path,g=d.queryId,h=cU(f,b),i=dV.fromObject(c);return eN(a,f,new dM(dI(g),h,i))}}(a.serverSyncTree_,f,b,e)}else{let b=dl(c);g=function(a,b,c,d){let e=eL(a,d);if(null==e)return[];{let d=eM(e),f=d.path,g=d.queryId,h=cU(f,b);return eN(a,f,new dL(dI(g),h,c))}}(a.serverSyncTree_,f,b,e)}else if(d){var h;let b,d=aI(c,a=>dl(a));h=a.serverSyncTree_,b=dV.fromObject(d),g=eH(h,new dM(dH(),f,b))}else{let b=dl(c);g=eD(a.serverSyncTree_,f,b)}let i=f;g.length>0&&(i=fw(a,f)),fi(a.eventQueue_,i,g)}function fo(a,b){var c;let d,e,f;fp(a,"connected",b),!1===b&&(ft(c=a,"onDisconnectEvents"),d=fm(c),e=dB(),dD(c.onDisconnect_,cL(),(a,b)=>{var f;let g=(f=c.serverSyncTree_,eV(b,new eQ(f,a),d));dC(e,a,g)}),f=[],dD(e,cL(),(a,b)=>{f=f.concat(eD(c.serverSyncTree_,a,b));let d=fA(c,a);fw(c,d)}),c.onDisconnect_=dB(),fi(c.eventQueue_,cL(),f))}function fp(a,b,c){let d=new cK("/.info/"+b),e=dl(c);a.infoData_.updateSnapshot(d,e);let f=eD(a.infoSyncTree_,d,e);fi(a.eventQueue_,d,f)}function fq(a){return a.nextWriteId_++}function fr(a,b,c,d){let e=dl(c);a.server_.onDisconnectPut(b.toString(),e.val(!0),(c,f)=>{"ok"===c&&dC(a.onDisconnect_,b,e),fu(a,d,c,f)})}function fs(a,b,c){let d;d=".info"===cM(b._path)?eE(a.infoSyncTree_,b,c):eE(a.serverSyncTree_,b,c),fh(a.eventQueue_,b._path,d)}function ft(a,...b){let c="";a.persistentConnection_&&(c=a.persistentConnection_.id+":"),b2(c,...b)}function fu(a,b,c,d){b&&cl(()=>{if("ok"===c)b(null);else{let a=(c||"error").toUpperCase(),e=a;d&&(e+=": "+d);let f=Error(e);f.code=a,b(f)}})}function fv(a,b,c){return eG(a.serverSyncTree_,b,c)||dj.EMPTY_NODE}function fw(a,b){let c=fx(a,b),d=e0(c),e=fy(a,c);return function(a,b,c){if(0===b.length)return;let d=[],e=[],f=b.filter(a=>0===a.status).map(a=>a.currentWriteId);for(let g=0;g<b.length;g++){let h=b[g],i=cU(c,h.path),j=!1,k;if(ah(null!==i,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)j=!0,k=h.abortReason,e=e.concat(eC(a.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=25)j=!0,k="maxretry",e=e.concat(eC(a.serverSyncTree_,h.currentWriteId,!0));else{let c=fv(a,h.path,f);h.currentInputSnapshot=c;let d=b[g].update(c.val());if(void 0!==d){e7("transaction failed: Data returned ",d,h.path);let b=dl(d);"object"==typeof d&&null!=d&&aF(d,".priority")||(b=b.updatePriority(c.getPriority()));let g=h.currentWriteId,i=eU(b,c,fm(a));h.currentOutputSnapshotRaw=b,h.currentOutputSnapshotResolved=i,h.currentWriteId=fq(a),f.splice(f.indexOf(g),1),e=(e=e.concat(eB(a.serverSyncTree_,h.path,i,h.currentWriteId,h.applyLocally))).concat(eC(a.serverSyncTree_,g,!0))}else j=!0,k="nodata",e=e.concat(eC(a.serverSyncTree_,h.currentWriteId,!0))}fi(a.eventQueue_,c,e),e=[],j&&(b[g].status=2,setTimeout(b[g].unwatcher,Math.floor(0)),b[g].onComplete&&("nodata"===k?d.push(()=>b[g].onComplete(null,!1,b[g].currentInputSnapshot)):d.push(()=>b[g].onComplete(Error(k),!1,null))))}fz(a,a.transactionQueueTree_);for(let a=0;a<d.length;a++)cl(d[a]);!function a(b,c=b.transactionQueueTree_){if(c||fz(b,c),eY(c)){let d=fy(b,c);ah(d.length>0,"Sending zero length transaction queue"),d.every(a=>0===a.status)&&function(b,c,d){let e=fv(b,c,d.map(a=>a.currentWriteId)),f=e,g=e.hash();for(let a=0;a<d.length;a++){let b=d[a];ah(0===b.status,"tryToSendTransactionQueue_: items in queue should all be run."),b.status=1,b.retryCount++;let e=cU(c,b.path);f=f.updateChild(e,b.currentOutputSnapshotRaw)}let h=f.val(!0);b.server_.put(c.toString(),h,e=>{ft(b,"transaction put response",{path:c.toString(),status:e});let f=[];if("ok"===e){let e=[];for(let a=0;a<d.length;a++)d[a].status=2,f=f.concat(eC(b.serverSyncTree_,d[a].currentWriteId)),d[a].onComplete&&e.push(()=>d[a].onComplete(null,!0,d[a].currentOutputSnapshotResolved)),d[a].unwatcher();fz(b,eX(b.transactionQueueTree_,c)),a(b,b.transactionQueueTree_),fi(b.eventQueue_,c,f);for(let a=0;a<e.length;a++)cl(e[a])}else{if("datastale"===e)for(let a=0;a<d.length;a++)3===d[a].status?d[a].status=4:d[a].status=0;else{b6("transaction at "+c.toString()+" failed: "+e);for(let a=0;a<d.length;a++)d[a].status=4,d[a].abortReason=e}fw(b,c)}},g)}(b,e0(c),d)}else e$(c)&&e_(c,c=>{a(b,c)})}(a,a.transactionQueueTree_)}(a,e,d),d}function fx(a,b){let c,d=a.transactionQueueTree_;for(c=cM(b);null!==c&&void 0===eY(d);)d=eX(d,c),c=cM(b=cO(b));return d}function fy(a,b){let c=[];return function a(b,c,d){let e=eY(c);if(e)for(let a=0;a<e.length;a++)d.push(e[a]);e_(c,c=>{a(b,c,d)})}(a,b,c),c.sort((a,b)=>a.order-b.order),c}function fz(a,b){let c=eY(b);if(c){let a=0;for(let b=0;b<c.length;b++)2!==c[b].status&&(c[a]=c[b],a++);c.length=a,eZ(b,c.length>0?c:void 0)}e_(b,b=>{fz(a,b)})}function fA(a,b){let c=e0(fx(a,b)),d=eX(a.transactionQueueTree_,b);return!function(a,b,c){let d=a.parent;for(;null!==d;){if(b(d))return!0;d=d.parent}}(d,b=>{fB(a,b)}),fB(a,d),!function a(b,c,d,e){d&&!e&&c(b),e_(b,b=>{a(b,c,!0,e)}),d&&e&&c(b)}(d,b=>{fB(a,b)}),c}function fB(a,b){let c=eY(b);if(c){let d=[],e=[],f=-1;for(let b=0;b<c.length;b++)3===c[b].status||(1===c[b].status?(ah(f===b-1,"All SENT items should be at beginning of queue."),f=b,c[b].status=3,c[b].abortReason="set"):(ah(0===c[b].status,"Unexpected transaction status in abort"),c[b].unwatcher(),e=e.concat(eC(a.serverSyncTree_,c[b].currentWriteId,!0)),c[b].onComplete&&d.push(c[b].onComplete.bind(null,Error("set"),!1,null))));-1===f?eZ(b,void 0):c.length=f+1,fi(a.eventQueue_,e0(b),e);for(let a=0;a<d.length;a++)cl(d[a])}}let fC=function(a,b){let c=fD(a),d=c.namespace;"firebase.com"===c.domain&&b5(c.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),d&&"undefined"!==d||"localhost"===c.domain||b5("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),c.secure||b7();let e="ws"===c.scheme||"wss"===c.scheme;return{repoInfo:new cn(c.host,c.secure,d,e,b,"",d!==c.subdomain),path:new cK(c.pathString)}},fD=function(a){let b="",c="",d="",e="",f="",g=!0,h="https",i=443;if("string"==typeof a){let j=a.indexOf("//");j>=0&&(h=a.substring(0,j-1),a=a.substring(j+2));let k=a.indexOf("/");-1===k&&(k=a.length);let l=a.indexOf("?");-1===l&&(l=a.length),b=a.substring(0,Math.min(k,l)),k<l&&(e=function(a){let b="",c=a.split("/");for(let a=0;a<c.length;a++)if(c[a].length>0){let d=c[a];try{d=decodeURIComponent(d.replace(/\+/g," "))}catch(a){}b+="/"+d}return b}(a.substring(k,l)));let m=function(a){let b={};for(let c of("?"===a.charAt(0)&&(a=a.substring(1)),a.split("&"))){if(0===c.length)continue;let d=c.split("=");2===d.length?b[decodeURIComponent(d[0])]=decodeURIComponent(d[1]):b6(`Invalid query segment '${c}' in query '${a}'`)}return b}(a.substring(Math.min(a.length,l)));(j=b.indexOf(":"))>=0?(g="https"===h||"wss"===h,i=parseInt(b.substring(j+1),10)):j=b.length;let n=b.slice(0,j);if("localhost"===n.toLowerCase())c="localhost";else if(n.split(".").length<=2)c=n;else{let a=b.indexOf(".");d=b.substring(0,a).toLowerCase(),c=b.substring(a+1),f=d}"ns"in m&&(f=m.ns)}return{host:b,port:i,domain:c,subdomain:d,secure:g,scheme:h,pathString:e,namespace:f}},fE="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",fF=(o=0,p=[],function(a){let b,c=a===o;o=a;let d=Array(8);for(b=7;b>=0;b--)d[b]=fE.charAt(a%64),a=Math.floor(a/64);ah(0===a,"Cannot push at time == 0");let e=d.join("");if(c){for(b=11;b>=0&&63===p[b];b--)p[b]=0;p[b]++}else for(b=0;b<12;b++)p[b]=Math.floor(64*Math.random());for(b=0;b<12;b++)e+=fE.charAt(p[b]);return ah(20===e.length,"nextPushId: Length should be 20."),e});class fG{constructor(a,b,c,d){this.eventType=a,this.eventRegistration=b,this.snapshot=c,this.prevName=d}getPath(){let a=this.snapshot.ref;return"value"===this.eventType?a._path:a.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+aB(this.snapshot.exportVal())}}class fH{constructor(a,b,c){this.eventRegistration=a,this.error=b,this.path=c}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class fI{constructor(a,b){this.snapshotCallback=a,this.cancelCallback=b}onValue(a,b){this.snapshotCallback.call(null,a,b)}onCancel(a){return ah(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,a)}get hasCancelCallback(){return!!this.cancelCallback}matches(a){return this.snapshotCallback===a.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===a.snapshotCallback.userCallback&&this.snapshotCallback.context===a.snapshotCallback.context}}class fJ{constructor(a,b){this._repo=a,this._path=b}cancel(){var a,b,c;let d=new as;return a=this._repo,b=this._path,c=d.wrapCallback(()=>{}),a.server_.onDisconnectCancel(b.toString(),(d,e)=>{"ok"===d&&function a(b,c){if(cT(c))return b.value=null,b.children.clear(),!0;if(null!==b.value)if(b.value.isLeafNode())return!1;else{let d=b.value;return b.value=null,d.forEachChild(dd,(a,c)=>{dC(b,new cK(a),c)}),a(b,c)}if(!(b.children.size>0))return!0;{let d=cM(c);return c=cO(c),b.children.has(d)&&a(b.children.get(d),c)&&b.children.delete(d),0===b.children.size}}(a.onDisconnect_,b),fu(a,c,d,e)}),d.promise}remove(){fd("OnDisconnect.remove",this._path);let a=new as;return fr(this._repo,this._path,null,a.wrapCallback(()=>{})),a.promise}set(a){fd("OnDisconnect.set",this._path),e6("OnDisconnect.set",a,this._path,!1);let b=new as;return fr(this._repo,this._path,a,b.wrapCallback(()=>{})),b.promise}setWithPriority(a,b){var c,d,e;let f;fd("OnDisconnect.setWithPriority",this._path),e6("OnDisconnect.setWithPriority",a,this._path,!1),fa("OnDisconnect.setWithPriority",b,!1);let g=new as;return c=this._repo,d=this._path,e=g.wrapCallback(()=>{}),f=dl(a,b),c.server_.onDisconnectPut(d.toString(),f.val(!0),(a,b)=>{"ok"===a&&dC(c.onDisconnect_,d,f),fu(c,e,a,b)}),g.promise}update(a){fd("OnDisconnect.update",this._path),e9("OnDisconnect.update",a,this._path,!1);let b=new as;return!function(a,b,c,d){if(aH(c)){b2("onDisconnect().update() called with empty data.  Don't do anything."),fu(a,d,"ok",void 0);return}a.server_.onDisconnectMerge(b.toString(),c,(e,f)=>{"ok"===e&&ch(c,(c,d)=>{let e=dl(d);dC(a.onDisconnect_,cS(b,c),e)}),fu(a,d,e,f)})}(this._repo,this._path,a,b.wrapCallback(()=>{})),b.promise}}class fK{constructor(a,b,c,d){this._repo=a,this._path=b,this._queryParams=c,this._orderByCalled=d}get key(){return cT(this._path)?null:cP(this._path)}get ref(){return new fL(this._repo,this._path)}get _queryIdentifier(){let a=cf(dy(this._queryParams));return"{}"===a?"default":a}get _queryObject(){return dy(this._queryParams)}isEqual(a){if(!((a=aP(a))instanceof fK))return!1;let b=this._repo===a._repo,c=cW(this._path,a._path),d=this._queryIdentifier===a._queryIdentifier;return b&&c&&d}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(a){let b="";for(let c=a.pieceNum_;c<a.pieces_.length;c++)""!==a.pieces_[c]&&(b+="/"+encodeURIComponent(String(a.pieces_[c])));return b||"/"}(this._path)}}class fL extends fK{constructor(a,b){super(a,b,new dw,!1)}get parent(){let a=cR(this._path);return null===a?null:new fL(this._repo,a)}get root(){let a=this;for(;null!==a.parent;)a=a.parent;return a}}class fM{constructor(a,b,c){this._node=a,this.ref=b,this._index=c}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(a){let b=new cK(a),c=fO(this.ref,a);return new fM(this._node.getChild(b),c,dd)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(a){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(b,c)=>a(new fM(c,fO(this.ref,b),dd)))}hasChild(a){let b=new cK(a);return!this._node.getChild(b).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function fN(a,b){return(a=aP(a))._checkNotDeleted("ref"),void 0!==b?fO(a._root,b):a._root}function fO(a,b){return null===cM((a=aP(a))._path)?fc("child","path",b,!1):fb("child","path",b,!1),new fL(a._repo,cS(a._path,b))}function fP(a,b){var c,d,e;let f,g,h,i,j,k;fd("set",(a=aP(a))._path),e6("set",b,a._path,!1);let l=new as;return c=a._repo,d=a._path,e=l.wrapCallback(()=>{}),ft(c,"set",{path:d.toString(),value:b,priority:null}),f=fm(c),h=eU(g=dl(b,null),eG(c.serverSyncTree_,d),f),i=fq(c),j=eB(c.serverSyncTree_,d,h,i,!0),fg(c.eventQueue_,j),c.server_.put(d.toString(),g.val(!0),(a,b)=>{let f="ok"===a;f||b6("set at "+d+" failed: "+a);let g=eC(c.serverSyncTree_,i,!f);fi(c.eventQueue_,d,g),fu(c,e,a,b)}),k=fA(c,d),fw(c,k),fi(c.eventQueue_,k,[]),l.promise}class fQ{constructor(a){this.callbackContext=a}respondsTo(a){return"value"===a}createEvent(a,b){let c=b._queryParams.getIndex();return new fG("value",this,new fM(a.snapshotNode,new fL(b._repo,b._path),c))}getEventRunner(a){return"cancel"===a.getEventType()?()=>this.callbackContext.onCancel(a.error):()=>this.callbackContext.onValue(a.snapshot,null)}createCancelEvent(a,b){return this.callbackContext.hasCancelCallback?new fH(this,a,b):null}matches(a){return a instanceof fQ&&(!a.callbackContext||!this.callbackContext||a.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class fR{constructor(a,b){this.eventType=a,this.callbackContext=b}respondsTo(a){let b="children_added"===a?"child_added":a;return b="children_removed"===b?"child_removed":b,this.eventType===b}createCancelEvent(a,b){return this.callbackContext.hasCancelCallback?new fH(this,a,b):null}createEvent(a,b){ah(null!=a.childName,"Child events should have a childName.");let c=fO(new fL(b._repo,b._path),a.childName),d=b._queryParams.getIndex();return new fG(a.type,this,new fM(a.snapshotNode,c,d),a.prevName)}getEventRunner(a){return"cancel"===a.getEventType()?()=>this.callbackContext.onCancel(a.error):()=>this.callbackContext.onValue(a.snapshot,a.prevName)}matches(a){return a instanceof fR&&this.eventType===a.eventType&&(!this.callbackContext||!a.callbackContext||this.callbackContext.matches(a.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function fS(a,b,c,d){return function(a,b,c,d,e){var f;let g,h;if("object"==typeof d&&(g=void 0,e=d),"function"==typeof d&&(g=d),e&&e.onlyOnce){let b=c,d=(c,d)=>{fs(a._repo,a,j),b(c,d)};d.userCallback=c.userCallback,d.context=c.context,c=d}let i=new fI(c,g||void 0),j="value"===b?new fQ(i):new fR(b,i);return f=a._repo,h=".info"===cM(a._path)?eF(f.infoSyncTree_,a,j):eF(f.serverSyncTree_,a,j),fh(f.eventQueue_,a._path,h),()=>fs(a._repo,a,j)}(a,"value",b,c,d)}class fT{}class fU extends fT{constructor(a){super(),this._limit=a,this.type="limitToLast"}_apply(a){var b,c;let d;if(a._queryParams.hasLimit())throw Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new fK(a._repo,a._path,(b=a._queryParams,c=this._limit,(d=b.copy()).limitSet_=!0,d.limit_=c,d.viewFrom_="r",d),a._orderByCalled)}}class fV extends fT{constructor(a){super(),this._path=a,this.type="orderByChild"}_apply(a){var b;let c;if(!0===a._orderByCalled)throw Error("orderByChild: You can't combine multiple orderBy calls.");let d=new cK(this._path);if(cT(d))throw Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let e=new dm(d),f=(b=a._queryParams,(c=b.copy()).index_=e,c),g=null,h=null;if(f.hasStart()&&(g=f.getIndexStartValue()),f.hasEnd()&&(h=f.getIndexEndValue()),f.getIndex()===c4){let a="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",b="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(f.hasStart()){if(f.getIndexStartName()!==ca)throw Error(a);if("string"!=typeof g)throw Error(b)}if(f.hasEnd()){if(f.getIndexEndName()!==cb)throw Error(a);if("string"!=typeof h)throw Error(b)}}else if(f.getIndex()===dd){if(null!=g&&!e5(g)||null!=h&&!e5(h))throw Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(ah(f.getIndex()instanceof dm||f.getIndex()===dn,"unknown index type."),null!=g&&"object"==typeof g||null!=h&&"object"==typeof h)throw Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.");return new fK(a._repo,a._path,f,!0)}}ah(!l,"__referenceConstructor has already been defined"),l=fL,ah(!m,"__referenceConstructor has already been defined"),m=fL;let fW={};class fX{constructor(a,b){this._repoInternal=a,this.app=b,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(a,b,c){var d;let e;if(a.stats_=cs(a.repoInfo_),a.forceRestClient_||"".search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)a.server_=new dz(a.repoInfo_,(b,c,d,e)=>{fn(a,b,c,d,e)},a.authTokenProvider_,a.appCheckProvider_),setTimeout(()=>fo(a,!0),0);else{if(null!=c){if("object"!=typeof c)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{aB(c)}catch(a){throw Error("Invalid authOverride provided: "+a)}}a.persistentConnection_=new c0(a.repoInfo_,b,(b,c,d,e)=>{fn(a,b,c,d,e)},b=>{fo(a,b)},b=>{var c;c=a,ch(b,(a,b)=>{fp(c,a,b)})},a.authTokenProvider_,a.appCheckProvider_,c),a.server_=a.persistentConnection_}a.authTokenProvider_.addTokenChangeListener(b=>{a.server_.refreshAuthToken(b)}),a.appCheckProvider_.addTokenChangeListener(b=>{a.server_.refreshAppCheckToken(b.token)}),d=a.repoInfo_,cr[e=d.toString()]||(cr[e]=(()=>new dF(a.stats_,a.server_))()),a.statsReporter_=cr[e],a.infoData_=new dA,a.infoSyncTree_=new eA({startListening:(b,c,d,e)=>{let f=[],g=a.infoData_.getNode(b._path);return g.isEmpty()||(f=eD(a.infoSyncTree_,b._path,g),setTimeout(()=>{e("ok")},0)),f},stopListening:()=>{}}),fp(a,"connected",!1),a.serverSyncTree_=new eA({startListening:(b,c,d,e)=>(a.server_.listen(b,d,c,(c,d)=>{let f=e(c,d);fi(a.eventQueue_,b._path,f)}),[]),stopListening:(b,c)=>{a.server_.unlisten(b,c)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new fL(this._repo,cL())),this._rootInternal}_delete(){if(null!==this._rootInternal){var a,b;let c;a=this._repo,(c=fW[b=this.app.name])&&c[a.key]===a||b5(`Database ${b}(${a.repoInfo_}) has already been deleted.`),a.persistentConnection_&&a.persistentConnection_.interrupt("repo_interrupt"),delete c[a.key],this._repoInternal=null,this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(a){null===this._rootInternal&&b5("Cannot call "+a+" on a deleted database.")}}c0.prototype.simpleListen=function(a,b){this.sendRequest("q",{p:a},b)},c0.prototype.echo=function(a,b){this.sendRequest("echo",{d:a},b)},cu=bP.default.Client;ct=bw,bl(new aQ("database",(a,{instanceIdentifier:b})=>{var c,d,e,f;let g,h,i,j,k,l,m,n=a.getProvider("app").getImmediate(),o=a.getProvider("auth-internal"),p=a.getProvider("app-check-internal");return void 0===(i=b||n.options.databaseURL)&&(n.options.projectId||b5("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),b2("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`),k=(j=fC(i,void 0)).repoInfo,"u">typeof process&&process.env&&(l=process.env.FIREBASE_DATABASE_EMULATOR_HOST),l?k=(j=fC(i=`http://${l}?ns=${k.namespace}`,void 0)).repoInfo:!j.repoInfo.secure,m=new cz(n.name,n.options,o),fe("Invalid Firebase Database URL",j),cT(j.path)||b5("Database URL must point to the root of a Firebase Database (not including a child path)."),new fX((c=k,d=n,e=m,f=new cy(n,p),(g=fW[d.name])||(g={},fW[d.name]=g),(h=g[c.toURLString()])&&b5("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),h=new fk(c,!1,e,f),g[c.toURLString()]=h,h),n)},"PUBLIC").setMultipleInstances(!0)),bC(cw,cx,"node"),bC(cw,cx,"esm2020");let fY={apiKey:"your_firebase_api_key_here",authDomain:"your_firebase_auth_domain_here",databaseURL:"your_firebase_database_url_here",projectId:"your_firebase_project_id_here",storageBucket:"your_firebase_storage_bucket_here",messagingSenderId:"your_firebase_messaging_sender_id_here",appId:"your_firebase_app_id_here",measurementId:"your_firebase_measurement_id_here"},fZ=null,f$=null;try{fY.apiKey&&!fY.apiKey.includes("your_firebase_api_key")&&fY.databaseURL?.startsWith("http")?(fZ=bx(fY),f$=function(a=bz(),b){let c=bm(a,"database").getImmediate({identifier:void 0});if(!c._instanceStarted){let a=(a=>{let b=aq()?.emulatorHosts?.[a];if(!b)return;let c=b.lastIndexOf(":");if(c<=0||c+1===b.length)throw Error(`Invalid host ${b} with no separate hostname and port!`);let d=parseInt(b.substring(c+1),10);return"["===b[0]?[b.substring(1,c-1),d]:[b.substring(0,c),d]})("database");a&&function(a,b,c,d={}){var e;let f,g,h;(a=aP(a))._checkNotDeleted("useEmulator");let i=`${b}:${c}`,j=a._repoInternal;if(a._instanceStarted){if(i===a._repoInternal.repoInfo_.host&&aJ(d,j.repoInfo_.emulatorOptions))return;b5("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}j.repoInfo_.nodeAdmin?(d.mockUserToken&&b5('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),f=new cA(cA.OWNER)):d.mockUserToken&&(f=new cA("string"==typeof d.mockUserToken?d.mockUserToken:function(a,b){if(a.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let c=b||"demo-project",d=a.iat||0,e=a.sub||a.user_id;if(!e)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let f={iss:`https://securetoken.google.com/${c}`,aud:c,iat:d,exp:d+3600,auth_time:d,sub:e,user_id:e,firebase:{sign_in_provider:"custom",identities:{}},...a};return[ao(JSON.stringify({alg:"none",type:"JWT"})),ao(JSON.stringify(f)),""].join(".")}(d.mockUserToken,a.app.options.projectId))),at(b)&&au(b),e=f,g=i.lastIndexOf(":"),h=at(i.substring(0,g)),j.repoInfo_=new cn(i,h,j.repoInfo_.namespace,j.repoInfo_.webSocketOnly,j.repoInfo_.nodeAdmin,j.repoInfo_.persistenceKey,j.repoInfo_.includeNamespaceInQueryParams,!0,d),e&&(j.authTokenProvider_=e)}(c,...a)}return c}(fZ)):console.warn("Firebase initialization skipped: Missing or invalid configuration.")}catch(a){console.error("Failed to initialize Firebase:",a)}function f_(a){return"user_"+Math.abs(a.split("").reduce((a,b)=>(a<<5)-a+b.charCodeAt(0),0)).toString(36).substring(0,8)}function f0(){let{user:a,isAuthenticated:b}=(0,y.useAuth)(),[c,d]=(0,w.useState)(!1),[e,f]=(0,w.useState)([]),[g,h]=(0,w.useState)(null),[i,j]=(0,w.useState)([]),[k,l]=(0,w.useState)(""),[m,n]=(0,w.useState)(null),o=(0,w.useRef)(null);return((0,w.useEffect)(()=>{if(b&&a?.id){let b=function(a){var b;if(!f$)return null;if(!a?.id)return;let c=f_(a.id),d=fN(f$,`presence/${c}`);return fP(d,{id:c,name:a.name,email:a.email,picture:a.picture,lastSeen:Date.now(),online:!0}),new fJ((b=aP(b=d))._repo,b._path).remove(),c}(a);return n(b),()=>{var a,c;a=b,f$&&a&&(fd("remove",(c=fN(f$,`presence/${a}`))._path),fP(c,null))}}},[b,a]),(0,w.useEffect)(()=>{var a;if(!b)return;let c=(a=a=>{f(a.filter(a=>a.id!==m))},f$?fS(fN(f$,"presence"),b=>{let c=[];b.forEach(a=>{c.push(a.val())}),a(c)}):(a([]),()=>{}));return()=>c&&c()},[b,m]),(0,w.useEffect)(()=>{if(!g||!m)return;let a=function(a,b,c){if(!f$)return c([]),()=>{};let d=[a,b].sort().join("_");return fS(function(a,...b){let c=aP(a);for(let a of b)c=a._apply(c);return c}(fN(f$,`messages/${d}`),function(a){if("$key"===a)throw Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===a)throw Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===a)throw Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return fb("orderByChild","path",a,!1),new fV(a)}("timestamp"),function(a){if(50!==Math.floor(50))throw Error("limitToLast: First argument must be a positive integer.");return new fU(50)}(0)),a=>{let b=[];a.forEach(a=>{b.push({id:a.key,...a.val()})}),c(b)})}(m,g.id,a=>{j(a)});return()=>a&&a()},[g,m]),(0,w.useEffect)(()=>{o.current?.scrollIntoView({behavior:"smooth"})},[i]),b)?(0,v.jsxs)("div",{className:"live-chat-container",children:[(0,v.jsxs)("button",{className:`live-chat-toggle ${c?"active":""}`,onClick:()=>d(!c),children:[c?(0,v.jsx)(O.X,{size:24}):(0,v.jsx)(D.MessageCircle,{size:24}),e.length>0&&!c&&(0,v.jsx)("span",{className:"online-badge",children:e.length})]}),c&&(0,v.jsxs)("div",{className:"live-chat-window",children:[(0,v.jsx)("div",{className:"live-chat-header",children:g?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("button",{className:"back-btn",onClick:()=>h(null),children:(0,v.jsx)(af,{size:18})}),(0,v.jsx)("img",{src:g.picture,alt:g.name,className:"chat-user-avatar"}),(0,v.jsxs)("div",{className:"chat-user-info",children:[(0,v.jsx)("span",{className:"chat-user-name",children:g.name}),(0,v.jsx)("span",{className:"chat-user-status",children:"Online"})]})]}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(ae,{size:20}),(0,v.jsxs)("span",{children:["Online Users (",e.length,")"]})]})}),(0,v.jsx)("div",{className:"live-chat-content",children:g?(0,v.jsxs)("div",{className:"messages-container",children:[0===i.length?(0,v.jsxs)("div",{className:"no-messages",children:[(0,v.jsx)("p",{children:"No messages yet"}),(0,v.jsx)("span",{children:"Say hello! "})]}):i.map(a=>(0,v.jsxs)("div",{className:`message ${a.senderId===m?"sent":"received"}`,children:[a.senderId!==m&&(0,v.jsx)("img",{src:a.senderPicture,alt:"",className:"message-avatar"}),(0,v.jsxs)("div",{className:"message-bubble",children:[(0,v.jsx)("p",{children:a.text}),(0,v.jsx)("span",{className:"message-time",children:new Date(a.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},a.id)),(0,v.jsx)("div",{ref:o})]}):(0,v.jsx)("div",{className:"online-users-list",children:0===e.length?(0,v.jsxs)("div",{className:"no-users",children:[(0,v.jsx)(ae,{size:48}),(0,v.jsx)("p",{children:"No other users online"}),(0,v.jsx)("span",{children:"Share your site to chat with others!"})]}):e.map(a=>(0,v.jsxs)("div",{className:"online-user-item",onClick:()=>h(a),children:[(0,v.jsx)("img",{src:a.picture,alt:a.name,className:"user-avatar"}),(0,v.jsxs)("div",{className:"user-info",children:[(0,v.jsx)("span",{className:"user-name",children:a.name}),(0,v.jsx)("span",{className:"user-email",children:a.email})]}),(0,v.jsx)("span",{className:"online-dot"})]},a.id))})}),g&&(0,v.jsxs)("form",{className:"message-input-form",onSubmit:b=>{b.preventDefault(),k.trim()&&g&&(!function(a,b,c){var d,e;let f,g,h,i;if(!f$||!a||!b||!c.trim())return;let j=f_(a.id),k=[j,b].sort().join("_");d=fN(f$,`messages/${k}`),e={senderId:j,senderName:a.name,senderPicture:a.picture,receiverId:b,text:c.trim(),timestamp:Date.now()},fd("push",(d=aP(d))._path),e6("push",e,d._path,!0),g=fF(fl(d._repo)),h=fO(d,g),i=fO(d,g),h.then=(f=null!=e?fP(i,e).then(()=>i):Promise.resolve(i)).then.bind(f),h.catch=f.then.bind(f,void 0)}(a,g.id,k),l(""))},children:[(0,v.jsx)("input",{type:"text",placeholder:"Type a message...",value:k,onChange:a=>l(a.target.value),className:"message-input"}),(0,v.jsx)("button",{type:"submit",className:"send-btn",disabled:!k.trim(),children:(0,v.jsx)(ad,{size:18})})]}),(0,v.jsxs)("div",{className:"my-chat-id",children:["Your ID: ",(0,v.jsx)("code",{children:m})]})]})]}):null}let f1=(0,F.default)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]),f2=(0,F.default)("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);var f3=a.i(4720),f4=a.i(63588);let f5=(0,F.default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);async function f6(a,b=""){try{let c={contents:[{parts:[{text:b?`${b}

User: ${a}`:a}]}],generationConfig:{temperature:.7,topK:40,topP:.95,maxOutputTokens:1024}},d=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=your_gemini_api_key_here",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!d.ok){let a=await d.json();throw console.error("Gemini API Error:",a),Error(a.error?.message||"AI request failed")}let e=await d.json();return e.candidates?.[0]?.content?.parts?.[0]?.text||"No response generated"}catch(a){throw console.error("Gemini call failed:",a),a}}async function f7(a,b={}){return f6(a,`You are Kiro, a friendly AI assistant for AnyDo, a personal productivity app. 
You help users manage their files, links, todos, and chats.
Be helpful, concise, and friendly. Use emojis occasionally.
Answer questions based on the user's data context provided.

User's current data:
- Files: ${b.files?.length||0} files stored
- Links: ${b.links?.length||0} bookmarks saved
- Todos: ${b.todos?.length||0} tasks (${b.todos?.filter(a=>a.completed)?.length||0} completed)
- Chats: ${b.chats?.length||0} imported chats

${b.files?.length?"Files: "+b.files.map(a=>a.name).join(", "):""}
${b.links?.length?"Links: "+b.links.map(a=>a.title||a.url).join(", "):""}
${b.todos?.length?"Todos: "+b.todos.map(a=>`${a.completed?"":""} ${a.title}`).join(", "):""}`)}async function f8(a,b={}){let c=`Search query: "${a}"

Available data to search:
FILES:
${b.files?.map(a=>`- ${a.name} (${a.type}, ${a.size} bytes)`).join("\n")||"No files"}

LINKS:
${b.links?.map(a=>`- ${a.title||"Untitled"}: ${a.url}`).join("\n")||"No links"}

TODOS:
${b.todos?.map(a=>`- [${a.completed?"x":" "}] ${a.title}${a.description?": "+a.description:""}`).join("\n")||"No todos"}

CHATS:
${b.chats?.map(a=>`- ${a.name} (${a.messageCount} messages)`).join("\n")||"No chats"}

Based on the search query, find and return the most relevant items. 
Format as a JSON array with objects having: { type: "file"|"link"|"todo"|"chat", name: string, reason: string }
Return only the JSON array, no other text.`;try{let a=(await f6(c)).match(/\[[\s\S]*\]/);if(a)return JSON.parse(a[0]);return[]}catch(a){return console.error("AI Search error:",a),[]}}async function f9(a,b="chat"){let c={chat:`Summarize this chat conversation in 2-3 sentences. Highlight key topics and any action items:

${a}`,file:`Summarize this file content briefly:

${a}`,todos:`Give a quick status overview of these todos:

${a}`};return f6(c[b]||c.chat)}async function ga(a={}){let b=`Based on the user's current data, suggest 3-5 actionable tasks they might want to add.

Current todos:
${a.todos?.map(a=>`- [${a.completed?"x":" "}] ${a.title}`).join("\n")||"No current todos"}

Links they've saved:
${a.links?.slice(0,10).map(a=>`- ${a.title||a.url}`).join("\n")||"No links"}

Files they have:
${a.files?.slice(0,10).map(a=>a.name).join(", ")||"No files"}

Suggest practical, specific tasks. Return as a JSON array of strings.
Return only the JSON array, no other text.`;try{let a=(await f6(b)).match(/\[[\s\S]*\]/);if(a)return JSON.parse(a[0]);return["Organize your files into folders","Review pending tasks","Clean up old bookmarks"]}catch(a){return console.error("AI Suggestions error:",a),["Organize your files into folders","Review pending tasks","Clean up old bookmarks"]}}function gb({files:a,links:b,todos:c,chats:d,onAddTodo:e}){let[f,g]=(0,w.useState)(!1),[h,i]=(0,w.useState)("chat"),[j,k]=(0,w.useState)([{role:"assistant",content:"Hi! I'm Kiro, your AI assistant  How can I help you today?"}]),[l,m]=(0,w.useState)(""),[n,o]=(0,w.useState)(!1),[p,q]=(0,w.useState)([]),[r,s]=(0,w.useState)([]),[t,u]=(0,w.useState)(""),x=(0,w.useRef)(null),y={files:a,links:b,todos:c,chats:d};(0,w.useEffect)(()=>{x.current?.scrollIntoView({behavior:"smooth"})},[j]);let z=async a=>{if(a?.preventDefault(),!l.trim()||n)return;let b=l.trim();m(""),k(a=>[...a,{role:"user",content:b}]),o(!0);try{let a=await f7(b,y);k(b=>[...b,{role:"assistant",content:a}])}catch{k(a=>[...a,{role:"assistant",content:"Sorry, I encountered an error. Please try again. "}])}finally{o(!1)}},A=async a=>{if(a?.preventDefault(),l.trim()&&!n){o(!0),q([]);try{let a=await f8(l,y);q(a)}catch(a){console.error("Search error:",a)}finally{o(!1)}}},B=async()=>{o(!0),s([]);try{let a=await ga(y);s(a)}catch(a){console.error("Suggestions error:",a)}finally{o(!1)}},C=async a=>{o(!0),u("");try{let b="";"todos"===a?b=c?.map(a=>`${a.completed?"":""} ${a.title}`).join("\n")||"No todos":"chats"===a&&d?.length&&(b=d[0].content.substring(0,2e3));let e=await f9(b,"chats"===a?"chat":"todos");u(e)}catch{u("Could not generate summary")}finally{o(!1)}},D=[{id:"chat",label:"Chat",icon:f4.MessageSquare},{id:"search",label:"Search",icon:$},{id:"suggest",label:"Suggest",icon:f2},{id:"summary",label:"Summary",icon:f3.FileText}];return(0,v.jsxs)("div",{className:"ai-assistant-container",children:[(0,v.jsx)("button",{className:`ai-toggle-btn ${f?"active":""}`,onClick:()=>g(!f),children:f?(0,v.jsx)(O.X,{size:24}):(0,v.jsx)(f1,{size:24})}),f&&(0,v.jsxs)("div",{className:"ai-panel",children:[(0,v.jsxs)("div",{className:"ai-header",children:[(0,v.jsx)(f1,{size:20}),(0,v.jsx)("span",{children:"Kiro AI"})]}),(0,v.jsx)("div",{className:"ai-tabs",children:D.map(a=>(0,v.jsxs)("button",{className:`ai-tab ${h===a.id?"active":""}`,onClick:()=>i(a.id),children:[(0,v.jsx)(a.icon,{size:16}),(0,v.jsx)("span",{children:a.label})]},a.id))}),(0,v.jsxs)("div",{className:"ai-content",children:["chat"===h&&(0,v.jsx)("div",{className:"ai-chat",children:(0,v.jsxs)("div",{className:"ai-messages",children:[j.map((a,b)=>(0,v.jsx)("div",{className:`ai-message ${a.role}`,children:a.content},b)),n&&(0,v.jsxs)("div",{className:"ai-message assistant loading",children:[(0,v.jsx)(f5,{className:"spin",size:16}),"Thinking..."]}),(0,v.jsx)("div",{ref:x})]})}),"search"===h&&(0,v.jsx)("div",{className:"ai-search",children:p.length>0?(0,v.jsx)("div",{className:"search-results",children:p.map((a,b)=>(0,v.jsxs)("div",{className:"search-result-item",children:[(0,v.jsx)("span",{className:"result-type",children:a.type}),(0,v.jsx)("span",{className:"result-name",children:a.name}),(0,v.jsx)("span",{className:"result-reason",children:a.reason})]},b))}):(0,v.jsxs)("div",{className:"ai-placeholder",children:[(0,v.jsx)($,{size:48}),(0,v.jsx)("p",{children:"Ask anything in natural language"}),(0,v.jsx)("span",{children:'"Find my project files" or "Show urgent tasks"'})]})}),"suggest"===h&&(0,v.jsx)("div",{className:"ai-suggest",children:r.length>0?(0,v.jsx)("div",{className:"suggestions-list",children:r.map((a,b)=>(0,v.jsxs)("div",{className:"suggestion-item",children:[(0,v.jsx)("span",{children:a}),(0,v.jsx)("button",{className:"add-suggestion-btn",onClick:()=>{e&&(e({title:a,completed:!1}),s(b=>b.filter(b=>b!==a)))},title:"Add as Todo",children:(0,v.jsx)(_.Plus,{size:16})})]},b))}):(0,v.jsxs)("div",{className:"ai-placeholder",children:[(0,v.jsx)(f2,{size:48}),(0,v.jsx)("p",{children:"Get smart task suggestions"}),(0,v.jsx)("button",{className:"generate-btn",onClick:B,disabled:n,children:n?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(f5,{className:"spin",size:16})," Generating..."]}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(f1,{size:16})," Generate Suggestions"]})})]})}),"summary"===h&&(0,v.jsx)("div",{className:"ai-summary",children:t?(0,v.jsx)("div",{className:"summary-content",children:(0,v.jsx)("p",{children:t})}):(0,v.jsxs)("div",{className:"ai-placeholder",children:[(0,v.jsx)(f3.FileText,{size:48}),(0,v.jsx)("p",{children:"Summarize your data"}),(0,v.jsxs)("div",{className:"summary-options",children:[(0,v.jsxs)("button",{onClick:()=>C("todos"),disabled:n,children:[(0,v.jsx)(L,{size:14}),"Summarize Todos"]}),d?.length>0&&(0,v.jsxs)("button",{onClick:()=>C("chats"),disabled:n,children:[(0,v.jsx)(L,{size:14}),"Summarize Latest Chat"]})]}),n&&(0,v.jsx)("div",{className:"loading-indicator",children:(0,v.jsx)(f5,{className:"spin",size:20})})]})})]}),("chat"===h||"search"===h)&&(0,v.jsxs)("form",{className:"ai-input-form",onSubmit:"chat"===h?z:A,children:[(0,v.jsx)("input",{type:"text",placeholder:"chat"===h?"Ask me anything...":"Search in natural language...",value:l,onChange:a=>m(a.target.value),className:"ai-input"}),(0,v.jsx)("button",{type:"submit",className:"ai-send-btn",disabled:!l.trim()||n,children:n?(0,v.jsx)(f5,{className:"spin",size:18}):(0,v.jsx)(ad,{size:18})})]})]})]})}function gc({children:a}){let b=(0,x.usePathname)(),c=(0,x.useRouter)(),{isAuthenticated:d,isLoading:e}=(0,y.useAuth)(),[f,g]=(0,w.useState)(!1),{files:h,links:i,todos:j,chats:k,setSearchQuery:l,handleSync:m,isSyncing:n,handleTodoAdd:o}=(0,z.useAppContext)(),p="/"===b?"dashboard":b.split("/")[1],q=a=>{"dashboard"===a?c.push("/"):c.push(`/${a}`),g(!1)};return e?(0,v.jsx)("div",{className:"loading-screen",children:"Loading..."}):d?(0,v.jsxs)("div",{className:"app-container",children:[(0,v.jsx)(Z,{activeSection:p,onSectionChange:q}),(0,v.jsx)(ab,{onSearch:l,onAddClick:()=>{"dashboard"===p&&c.push("/files")},onMenuChange:q,onMenuClick:()=>g(!f),showMobileMenu:f,onSync:m,isSyncing:n}),(0,v.jsx)("main",{className:"main-content",children:a}),(0,v.jsx)(f0,{}),(0,v.jsx)(gb,{files:h,links:i,todos:j,chats:k,onAddTodo:o})]}):(0,v.jsx)(ac,{})}a.s(["default",()=>gc],21877)},33354,(a,b,c)=>{"use strict";c._=function(a){return a&&a.__esModule?a:{default:a}}},92966,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HeadManagerContext},30089,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"setAttributesFromProps",{enumerable:!0,get:function(){return g}});let d={acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv",noModule:"noModule"},e=["onLoad","onReady","dangerouslySetInnerHTML","children","onError","strategy","stylesheets"];function f(a){return["async","defer","noModule"].includes(a)}function g(a,b){for(let[c,g]of Object.entries(b)){if(!b.hasOwnProperty(c)||e.includes(c)||void 0===g)continue;let h=d[c]||c.toLowerCase();"SCRIPT"===a.tagName&&f(h)?a[h]=!!g:a.setAttribute(h,String(g)),(!1===g||"SCRIPT"===a.tagName&&f(h)&&(!g||"false"===g))&&(a.setAttribute(h,""),a.removeAttribute(h))}}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},12962,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={cancelIdleCallback:function(){return g},requestIdleCallback:function(){return f}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="u">typeof self&&self.requestIdleCallback&&self.requestIdleCallback.bind(window)||function(a){let b=Date.now();return self.setTimeout(function(){a({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-b))}})},1)},g="u">typeof self&&self.cancelIdleCallback&&self.cancelIdleCallback.bind(window)||function(a){return clearTimeout(a)};("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},96665,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={default:function(){return t},handleClientScriptLoad:function(){return q},initScriptLoader:function(){return r}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(33354),g=a.r(46058),h=a.r(87924),i=f._(a.r(35112)),j=g._(a.r(72131)),k=a.r(92966),l=a.r(30089),m=a.r(12962),n=new Map,o=new Set,p=a=>{let{src:b,id:c,onLoad:d=()=>{},onReady:e=null,dangerouslySetInnerHTML:f,children:g="",strategy:h="afterInteractive",onError:j,stylesheets:k}=a,m=c||b;if(m&&o.has(m))return;if(n.has(b)){o.add(m),n.get(b).then(d,j);return}let p=()=>{e&&e(),o.add(m)},q=document.createElement("script"),r=new Promise((a,b)=>{q.addEventListener("load",function(b){a(),d&&d.call(this,b),p()}),q.addEventListener("error",function(a){b(a)})}).catch(function(a){j&&j(a)});f?(q.innerHTML=f.__html||"",p()):g?(q.textContent="string"==typeof g?g:Array.isArray(g)?g.join(""):"",p()):b&&(q.src=b,n.set(b,r)),(0,l.setAttributesFromProps)(q,a),"worker"===h&&q.setAttribute("type","text/partytown"),q.setAttribute("data-nscript",h),k&&(a=>{if(i.default.preinit)return a.forEach(a=>{i.default.preinit(a,{as:"style"})})})(k),document.body.appendChild(q)};function q(a){let{strategy:b="afterInteractive"}=a;"lazyOnload"===b?window.addEventListener("load",()=>{(0,m.requestIdleCallback)(()=>p(a))}):p(a)}function r(a){a.forEach(q),[...document.querySelectorAll('[data-nscript="beforeInteractive"]'),...document.querySelectorAll('[data-nscript="beforePageRender"]')].forEach(a=>{let b=a.id||a.getAttribute("src");o.add(b)})}function s(a){let{id:b,src:c="",onLoad:d=()=>{},onReady:e=null,strategy:f="afterInteractive",onError:g,stylesheets:l,...n}=a,{updateScripts:q,scripts:r,getIsSsr:s,appDir:t,nonce:u}=(0,j.useContext)(k.HeadManagerContext);u=n.nonce||u;let v=(0,j.useRef)(!1);(0,j.useEffect)(()=>{let a=b||c;v.current||(e&&a&&o.has(a)&&e(),v.current=!0)},[e,b,c]);let w=(0,j.useRef)(!1);if((0,j.useEffect)(()=>{if(!w.current){if("afterInteractive"===f)p(a);else"lazyOnload"===f&&("complete"===document.readyState?(0,m.requestIdleCallback)(()=>p(a)):window.addEventListener("load",()=>{(0,m.requestIdleCallback)(()=>p(a))}));w.current=!0}},[a,f]),("beforeInteractive"===f||"worker"===f)&&(q?(r[f]=(r[f]||[]).concat([{id:b,src:c,onLoad:d,onReady:e,onError:g,...n,nonce:u}]),q(r)):s&&s()?o.add(b||c):s&&!s()&&p({...a,nonce:u})),t){if(l&&l.forEach(a=>{i.default.preinit(a,{as:"style"})}),"beforeInteractive"===f)if(!c)return n.dangerouslySetInnerHTML&&(n.children=n.dangerouslySetInnerHTML.__html,delete n.dangerouslySetInnerHTML),(0,h.jsx)("script",{nonce:u,dangerouslySetInnerHTML:{__html:`(self.__next_s=self.__next_s||[]).push(${JSON.stringify([0,{...n,id:b}])})`}});else return i.default.preload(c,n.integrity?{as:"script",integrity:n.integrity,nonce:u,crossOrigin:n.crossOrigin}:{as:"script",nonce:u,crossOrigin:n.crossOrigin}),(0,h.jsx)("script",{nonce:u,dangerouslySetInnerHTML:{__html:`(self.__next_s=self.__next_s||[]).push(${JSON.stringify([c,{...n,id:b}])})`}});"afterInteractive"===f&&c&&i.default.preload(c,n.integrity?{as:"script",integrity:n.integrity,nonce:u,crossOrigin:n.crossOrigin}:{as:"script",nonce:u,crossOrigin:n.crossOrigin})}return null}Object.defineProperty(s,"__nextScript",{value:!0});let t=s;("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__37a8f630._.js.map