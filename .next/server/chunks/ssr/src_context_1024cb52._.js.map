{"version":3,"sources":["../../../../src/context/AuthContext.tsx","../../../../src/utils/emailService.ts","../../../../src/context/AppContext.tsx","../../../../src/utils/storage.ts","../../../../src/utils/driveStorage.ts"],"sourcesContent":["\"use client\";\r\nimport { createContext, useContext, useState, useEffect, useCallback, ReactNode } from 'react';\r\nimport { sendLoginNotification } from '../utils/emailService';\r\n\r\ndeclare global {\r\n    interface Window {\r\n        google?: any;\r\n    }\r\n}\r\n\r\nconst AuthContext = createContext<any>(null);\r\n\r\n// Your Google Cloud OAuth Client ID\r\nconst GOOGLE_CLIENT_ID = '654874405185-6koeq1ij3q1onptd6rj2s6rctot99nid.apps.googleusercontent.com';\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n    const [user, setUser] = useState<any>(null);\r\n    const [accessToken, setAccessToken] = useState<string | null>(null);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [tokenClient, setTokenClient] = useState<any>(null);\r\n\r\n    // Initialize Google Identity Services\r\n    useEffect(() => {\r\n        const initializeGoogleAuth = () => {\r\n            if (window.google?.accounts) {\r\n                // Initialize token client for Drive API access\r\n                const client = window.google.accounts.oauth2.initTokenClient({\r\n                    client_id: GOOGLE_CLIENT_ID,\r\n                    scope: 'https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.readonly https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email',\r\n                    callback: handleTokenResponse,\r\n                });\r\n                setTokenClient(client);\r\n\r\n                // Check for existing session\r\n                const savedUser = localStorage.getItem('anydo_user');\r\n                const savedToken = localStorage.getItem('anydo_token');\r\n                if (savedUser && savedToken) {\r\n                    setUser(JSON.parse(savedUser));\r\n                    setAccessToken(savedToken);\r\n                }\r\n                setIsLoading(false);\r\n            } else {\r\n                // Wait for Google script to load\r\n                setTimeout(initializeGoogleAuth, 100);\r\n            }\r\n        };\r\n\r\n        initializeGoogleAuth();\r\n    }, []);\r\n\r\n    const handleTokenResponse = async (response: any) => {\r\n        if (response.access_token) {\r\n            setAccessToken(response.access_token);\r\n            localStorage.setItem('anydo_token', response.access_token);\r\n\r\n            // Fetch user profile\r\n            try {\r\n                const profileRes = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {\r\n                    headers: { Authorization: `Bearer ${response.access_token}` }\r\n                });\r\n                const profile = await profileRes.json();\r\n                const userData = {\r\n                    id: profile.id,\r\n                    name: profile.name,\r\n                    email: profile.email,\r\n                    picture: profile.picture,\r\n                };\r\n                setUser(userData);\r\n                localStorage.setItem('anydo_user', JSON.stringify(userData));\r\n\r\n                // Send login notification email\r\n                sendLoginNotification(userData);\r\n            } catch (error) {\r\n                console.error('Error fetching user profile:', error);\r\n            }\r\n        }\r\n    };\r\n\r\n    const login = useCallback(() => {\r\n        if (tokenClient) {\r\n            tokenClient.requestAccessToken();\r\n        }\r\n    }, [tokenClient]);\r\n\r\n    const logout = useCallback(() => {\r\n        if (accessToken && window.google?.accounts) {\r\n            window.google.accounts.oauth2.revoke(accessToken);\r\n        }\r\n        setUser(null);\r\n        setAccessToken(null);\r\n\r\n        // Clear all user data from localStorage\r\n        localStorage.removeItem('anydo_user');\r\n        localStorage.removeItem('anydo_token');\r\n        localStorage.removeItem('anydo_files');\r\n        localStorage.removeItem('anydo_links');\r\n        localStorage.removeItem('anydo_todos');\r\n        localStorage.removeItem('anydo_chats');\r\n    }, [accessToken]);\r\n\r\n    const value = {\r\n        user,\r\n        accessToken,\r\n        isLoading,\r\n        isAuthenticated: !!user,\r\n        login,\r\n        logout,\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={value}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n\r\n// eslint-disable-next-line react-refresh/only-export-components\r\nexport function useAuth() {\r\n    const context = useContext(AuthContext);\r\n    if (!context) {\r\n        throw new Error('useAuth must be used within an AuthProvider');\r\n    }\r\n    return context;\r\n}\r\n\r\nexport default AuthContext;\r\n","// EmailJS Email Notification Service\r\n// Free service - no backend required!\r\n\r\n// ============================================\r\n// CONFIGURATION - Update these values!\r\n// ============================================\r\nconst EMAILJS_CONFIG = {\r\n    serviceId: 'service_ryxggsl',\r\n    loginTemplateId: 'template_wyw6slw',    // Welcome/Login notification\r\n    deleteTemplateId: 'template_faoxn1n',   // Account deletion notification\r\n    publicKey: '7EA5pgn595Ku0EKJ-'\r\n};\r\n\r\ndeclare global {\r\n    interface Window {\r\n        emailjs?: any;\r\n    }\r\n}\r\n\r\n// Load EmailJS SDK\r\nconst loadEmailJS = () => {\r\n    return new Promise((resolve, reject) => {\r\n        if (window.emailjs) {\r\n            resolve(window.emailjs);\r\n            return;\r\n        }\r\n\r\n        const script = document.createElement('script');\r\n        script.src = 'https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js';\r\n        script.onload = () => {\r\n            window.emailjs.init(EMAILJS_CONFIG.publicKey);\r\n            resolve(window.emailjs);\r\n        };\r\n        script.onerror = reject;\r\n        document.head.appendChild(script);\r\n    });\r\n};\r\n\r\n/**\r\n * Send login notification email to user\r\n * @param {Object} user - User object with name and email\r\n */\r\nexport async function sendLoginNotification(user: any) {\r\n    if (!user?.email) return;\r\n\r\n    try {\r\n        const emailjs = await loadEmailJS() as any;\r\n\r\n        await emailjs.send(\r\n            EMAILJS_CONFIG.serviceId,\r\n            EMAILJS_CONFIG.loginTemplateId,\r\n            {\r\n                to_email: user.email,\r\n                user_name: user.name || 'User',\r\n                login_time: new Date().toLocaleString(),\r\n                device_info: navigator.userAgent.split('(')[1]?.split(')')[0] || 'Unknown Device'\r\n            }\r\n        );\r\n\r\n        console.log('Login notification email sent successfully');\r\n    } catch (error) {\r\n        console.error('Failed to send login notification:', error);\r\n        // Don't throw - email failure shouldn't break login\r\n    }\r\n}\r\n\r\n/**\r\n * Send account deletion notification email to user\r\n * @param {Object} user - User object with name and email\r\n */\r\nexport async function sendAccountDeletedNotification(user: any) {\r\n    if (!user?.email) return;\r\n\r\n    try {\r\n        const emailjs = await loadEmailJS() as any;\r\n\r\n        await emailjs.send(\r\n            EMAILJS_CONFIG.serviceId,\r\n            EMAILJS_CONFIG.deleteTemplateId,\r\n            {\r\n                to_email: user.email,\r\n                user_name: user.name || 'User',\r\n                delete_time: new Date().toLocaleString()\r\n            }\r\n        );\r\n\r\n        console.log('Account deletion notification email sent successfully');\r\n    } catch (error) {\r\n        console.error('Failed to send deletion notification:', error);\r\n        // Don't throw - email failure shouldn't break deletion\r\n    }\r\n}\r\n","\"use client\";\r\n\r\nimport React, { createContext, useContext, useState, useEffect, useCallback, ReactNode } from 'react';\r\nimport { useAuth } from './AuthContext';\r\nimport {\r\n    saveFile, getFilesMetadata, deleteFile, getFileById,\r\n    saveLink, getLinks, deleteLink,\r\n    saveTodo, getTodos, updateTodo, deleteTodo,\r\n    saveChat, getChats, deleteChat,\r\n    updateFileMetadata, getFileMetadataById\r\n} from '../utils/storage';\r\nimport { syncDataToDrive, loadDataFromDrive, uploadFileToDrive, deleteFileFromDrive } from '../utils/driveStorage';\r\n\r\ninterface AnyDoFile {\r\n    id: string;\r\n    name: string;\r\n    type: string;\r\n    size: number;\r\n    data?: string | ArrayBuffer | null;\r\n    addedAt: string;\r\n    driveFileId?: string | null;\r\n}\r\n\r\ninterface AppContextType {\r\n    files: AnyDoFile[];\r\n    links: any[];\r\n    todos: any[];\r\n    chats: any[];\r\n    isSyncing: boolean;\r\n    searchQuery: string;\r\n    setSearchQuery: (query: string) => void;\r\n    handleFileUpload: (file: File) => Promise<void>;\r\n    handleFileDelete: (id: string) => Promise<void>;\r\n    handleFileView: (file: AnyDoFile) => Promise<void>;\r\n    handleLinkAdd: (link: any) => void;\r\n    handleLinkDelete: (id: string) => void;\r\n    handleTodoAdd: (todo: any) => void;\r\n    handleTodoUpdate: (id: string, updates: any) => void;\r\n    handleTodoDelete: (id: string) => void;\r\n    handleChatAdd: (chat: any) => void;\r\n    handleChatDelete: (id: string) => void;\r\n    handleSync: () => Promise<void>;\r\n}\r\n\r\nconst AppContext = createContext<AppContextType | undefined>(undefined);\r\n\r\nexport const AppProvider = ({ children }: { children: ReactNode }) => {\r\n    const { accessToken, isAuthenticated, isLoading } = useAuth();\r\n    \r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [isSyncing, setIsSyncing] = useState(false);\r\n\r\n    const [files, setFiles] = useState<AnyDoFile[]>([]);\r\n    const [links, setLinks] = useState<any[]>([]);\r\n    const [todos, setTodos] = useState<any[]>([]);\r\n    const [chats, setChats] = useState<any[]>([]);\r\n\r\n    useEffect(() => {\r\n        // Initial load from local storage\r\n        try {\r\n            setFiles(getFilesMetadata() || []);\r\n            setLinks(getLinks() || []);\r\n            setTodos(getTodos() || []);\r\n            setChats(getChats() || []);\r\n        } catch (e) {\r\n            console.error(\"Initial load error\", e);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (!isAuthenticated && !isLoading) {\r\n            setFiles([]);\r\n            setLinks([]);\r\n            setTodos([]);\r\n            setChats([]);\r\n        }\r\n    }, [isAuthenticated, isLoading]);\r\n\r\n    const loadFromDrive = useCallback(async () => {\r\n        if (!accessToken) return;\r\n\r\n        try {\r\n            const driveData = await loadDataFromDrive(accessToken);\r\n            if (driveData) {\r\n                if (driveData.links) {\r\n                    localStorage.setItem('anydo_links', JSON.stringify(driveData.links));\r\n                    setLinks(driveData.links);\r\n                }\r\n                if (driveData.todos) {\r\n                    localStorage.setItem('anydo_todos', JSON.stringify(driveData.todos));\r\n                    setTodos(driveData.todos);\r\n                }\r\n                if (driveData.chats) {\r\n                    localStorage.setItem('anydo_chats', JSON.stringify(driveData.chats));\r\n                    setChats(driveData.chats);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('Error loading from Drive:', error);\r\n        }\r\n    }, [accessToken]);\r\n\r\n    useEffect(() => {\r\n        if (isAuthenticated && accessToken) {\r\n            loadFromDrive();\r\n        }\r\n    }, [isAuthenticated, accessToken, loadFromDrive]);\r\n\r\n    useEffect(() => {\r\n        if (!isAuthenticated || !accessToken) return;\r\n\r\n        const syncTimeout = setTimeout(() => {\r\n            syncDataToDrive(accessToken, {\r\n                links: getLinks(),\r\n                todos: getTodos(),\r\n                chats: getChats(),\r\n                lastSync: new Date().toISOString(),\r\n            }).catch(err => console.error('Auto-sync error:', err));\r\n        }, 2000);\r\n\r\n        return () => clearTimeout(syncTimeout);\r\n    }, [links, todos, chats, isAuthenticated, accessToken]);\r\n\r\n    const handleSync = async () => {\r\n        if (!accessToken || isSyncing) return;\r\n\r\n        setIsSyncing(true);\r\n        try {\r\n            await syncDataToDrive(accessToken, {\r\n                links: getLinks(),\r\n                todos: getTodos(),\r\n                chats: getChats(),\r\n                lastSync: new Date().toISOString(),\r\n            });\r\n            console.log('Data synced to Drive successfully');\r\n        } catch (error) {\r\n            console.error('Error syncing to Drive:', error);\r\n        } finally {\r\n            setIsSyncing(false);\r\n        }\r\n    };\r\n\r\n    const handleFileUpload = useCallback(async (file: File) => {\r\n        try {\r\n            const savedFile = await saveFile(file) as AnyDoFile;\r\n            setFiles(getFilesMetadata());\r\n\r\n            if (accessToken) {\r\n                try {\r\n                    const driveResult = await uploadFileToDrive(accessToken, file, savedFile.id);\r\n                    if (driveResult?.id) {\r\n                        updateFileMetadata(savedFile.id, { driveFileId: driveResult.id });\r\n                        setFiles(getFilesMetadata());\r\n                    }\r\n                } catch (e) {\r\n                    console.error('Error uploading to Drive:', e);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('Error uploading file:', error);\r\n        }\r\n    }, [accessToken]);\r\n\r\n    const handleFileDelete = useCallback(async (id: string) => {\r\n        try {\r\n            const fileMeta = getFileMetadataById(id);\r\n            await deleteFile(id);\r\n            setFiles(getFilesMetadata());\r\n\r\n            if (accessToken && fileMeta?.driveFileId) {\r\n                try {\r\n                    await deleteFileFromDrive(accessToken, fileMeta.driveFileId);\r\n                    console.log('File deleted from Drive:', fileMeta.driveFileId);\r\n                } catch (e) {\r\n                    console.error('Error deleting from Drive:', e);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('Error deleting file:', error);\r\n        }\r\n    }, [accessToken]);\r\n\r\n    const handleFileView = useCallback(async (file: AnyDoFile) => {\r\n        try {\r\n            const fullFile = await getFileById(file.id) as AnyDoFile;\r\n            if (fullFile?.data) {\r\n                const win = window.open();\r\n                if (win) {\r\n                    if (fullFile.type.startsWith('image/') || fullFile.type === 'application/pdf') {\r\n                        win.document.write(`\r\n              <html>\r\n                <head><title>${fullFile.name}</title></head>\r\n                <body style=\"margin:0;display:flex;justify-content:center;align-items:center;min-height:100vh;background:#0a0a0f;\">\r\n                  ${fullFile.type === 'application/pdf'\r\n                                ? `<iframe src=\"${fullFile.data}\" style=\"width:100%;height:100vh;border:none;\"></iframe>`\r\n                                : `<img src=\"${fullFile.data}\" style=\"max-width:100%;max-height:100vh;object-fit:contain;\" />`\r\n                            }\r\n                </body>\r\n              </html>\r\n            `);\r\n                    } else {\r\n                        const link = document.createElement('a');\r\n                        link.href = fullFile.data as string;\r\n                        link.download = fullFile.name;\r\n                        link.click();\r\n                    }\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('Error viewing file:', error);\r\n        }\r\n    }, []);\r\n\r\n    const handleLinkAdd = useCallback((link: any) => {\r\n        saveLink(link);\r\n        setLinks(getLinks());\r\n    }, []);\r\n\r\n    const handleLinkDelete = useCallback((id: string) => {\r\n        deleteLink(id);\r\n        setLinks(getLinks());\r\n    }, []);\r\n\r\n    const handleTodoAdd = useCallback((todo: any) => {\r\n        saveTodo(todo);\r\n        setTodos(getTodos());\r\n    }, []);\r\n\r\n    const handleTodoUpdate = useCallback((id: string, updates: any) => {\r\n        updateTodo(id, updates);\r\n        setTodos(getTodos());\r\n    }, []);\r\n\r\n    const handleTodoDelete = useCallback((id: string) => {\r\n        deleteTodo(id);\r\n        setTodos(getTodos());\r\n    }, []);\r\n\r\n    const handleChatAdd = useCallback((chat: any) => {\r\n        saveChat(chat);\r\n        setChats(getChats());\r\n    }, []);\r\n\r\n    const handleChatDelete = useCallback((id: string) => {\r\n        deleteChat(id);\r\n        setChats(getChats());\r\n    }, []);\r\n\r\n    return (\r\n        <AppContext.Provider value={{\r\n            files,\r\n            links,\r\n            todos,\r\n            chats,\r\n            isSyncing,\r\n            searchQuery,\r\n            setSearchQuery,\r\n            handleFileUpload,\r\n            handleFileDelete,\r\n            handleFileView,\r\n            handleLinkAdd,\r\n            handleLinkDelete,\r\n            handleTodoAdd,\r\n            handleTodoUpdate,\r\n            handleTodoDelete,\r\n            handleChatAdd,\r\n            handleChatDelete,\r\n            handleSync\r\n        }}>\r\n            {children}\r\n        </AppContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useAppContext = () => {\r\n    const context = useContext(AppContext);\r\n    if (!context) {\r\n        throw new Error('useAppContext must be used within an AppProvider');\r\n    }\r\n    return context;\r\n};\r\n","// Storage utility for managing all data types\r\n// Uses localStorage for metadata and IndexedDB for file blobs\r\n\r\nconst STORAGE_KEYS = {\r\n    FILES: 'anydo_files',\r\n    LINKS: 'anydo_links',\r\n    TODOS: 'anydo_todos',\r\n    CHATS: 'anydo_chats',\r\n};\r\n\r\n// Initialize IndexedDB for file storage\r\nconst DB_NAME = 'AnyDoDB';\r\nconst DB_VERSION = 1;\r\nconst FILE_STORE = 'files';\r\n\r\nlet db: IDBDatabase | null = null;\r\n\r\nconst initDB = () => {\r\n    return new Promise((resolve, reject) => {\r\n        if (db) {\r\n            resolve(db);\r\n            return;\r\n        }\r\n\r\n        const request = indexedDB.open(DB_NAME, DB_VERSION);\r\n\r\n        request.onerror = () => reject(request.error);\r\n        request.onsuccess = () => {\r\n            db = request.result;\r\n            resolve(db);\r\n        };\r\n\r\n        request.onupgradeneeded = (event) => {\r\n            const database = (event.target as IDBOpenDBRequest).result;\r\n            if (!database.objectStoreNames.contains(FILE_STORE)) {\r\n                database.createObjectStore(FILE_STORE, { keyPath: 'id' });\r\n            }\r\n        };\r\n    });\r\n};\r\n\r\n// Helper to generate unique IDs\r\nexport const generateId = () => {\r\n    return Date.now().toString(36) + Math.random().toString(36).substr(2);\r\n};\r\n\r\n// Helper to format dates\r\nexport const formatDate = (date: any) => {\r\n    const d = new Date(date);\r\n    const options = {\r\n        year: 'numeric',\r\n        month: 'short',\r\n        day: 'numeric',\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n    } as Intl.DateTimeFormatOptions;\r\n    return d.toLocaleDateString('en-US', options);\r\n};\r\n\r\nexport const formatDateShort = (date: any) => {\r\n    const d = new Date(date);\r\n    const options: Intl.DateTimeFormatOptions = { month: 'short', day: 'numeric' };\r\n    return d.toLocaleDateString('en-US', options);\r\n};\r\n\r\nexport const getRelativeTime = (date: any) => {\r\n    const now = new Date();\r\n    const d = new Date(date);\r\n    const diff = now.getTime() - d.getTime();\r\n\r\n    const minutes = Math.floor(diff / 60000);\r\n    const hours = Math.floor(diff / 3600000);\r\n    const days = Math.floor(diff / 86400000);\r\n\r\n    if (minutes < 1) return 'Just now';\r\n    if (minutes < 60) return `${minutes}m ago`;\r\n    if (hours < 24) return `${hours}h ago`;\r\n    if (days < 7) return `${days}d ago`;\r\n    return formatDateShort(date);\r\n};\r\n\r\n// ============================================\r\n// Files Storage\r\n// ============================================\r\n\r\nexport const saveFile = async (file: any): Promise<any> => {\r\n    const database = (await initDB()) as IDBDatabase;\r\n\r\n    return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n        reader.onload = async () => {\r\n            const fileData = {\r\n                id: generateId(),\r\n                name: file.name,\r\n                type: file.type,\r\n                size: file.size,\r\n                data: reader.result,\r\n                addedAt: new Date().toISOString(),\r\n            };\r\n\r\n            const transaction = database.transaction([FILE_STORE], 'readwrite');\r\n            const store = transaction.objectStore(FILE_STORE);\r\n\r\n            store.add(fileData);\r\n\r\n            transaction.oncomplete = () => {\r\n                // Save metadata to localStorage\r\n                const files = getFilesMetadata();\r\n                files.push({\r\n                    id: fileData.id,\r\n                    name: fileData.name,\r\n                    type: fileData.type,\r\n                    size: fileData.size,\r\n                    addedAt: fileData.addedAt,\r\n                    driveFileId: null, // Will be updated after Drive upload\r\n                });\r\n                localStorage.setItem(STORAGE_KEYS.FILES, JSON.stringify(files));\r\n                resolve(fileData);\r\n            };\r\n\r\n            transaction.onerror = () => reject(transaction.error);\r\n        };\r\n        reader.onerror = () => reject(reader.error);\r\n        reader.readAsDataURL(file);\r\n    });\r\n};\r\n\r\nexport const getFilesMetadata = () => {\r\n    const data = localStorage.getItem(STORAGE_KEYS.FILES);\r\n    return data ? JSON.parse(data) : [];\r\n};\r\n\r\nexport const updateFileMetadata = (id: string, updates: any) => {\r\n    const files = getFilesMetadata().map((file: any) =>\r\n        file.id === id ? { ...file, ...updates } : file\r\n    );\r\n    localStorage.setItem(STORAGE_KEYS.FILES, JSON.stringify(files));\r\n};\r\n\r\nexport const getFileMetadataById = (id: string) => {\r\n    return getFilesMetadata().find((file: any) => file.id === id);\r\n};\r\n\r\nexport const getFileById = async (id: string) => {\r\n    const database = await initDB() as IDBDatabase;\r\n\r\n    return new Promise((resolve, reject) => {\r\n        const transaction = database.transaction([FILE_STORE], 'readonly');\r\n        const store = transaction.objectStore(FILE_STORE);\r\n        const request = store.get(id);\r\n\r\n        request.onsuccess = () => resolve(request.result);\r\n        request.onerror = () => reject(request.error);\r\n    });\r\n};\r\n\r\nexport const deleteFile = async (id: string): Promise<void> => {\r\n    const database = await initDB() as IDBDatabase;\r\n\r\n    return new Promise<void>((resolve, reject) => {\r\n        const transaction = database.transaction([FILE_STORE], 'readwrite');\r\n        const store = transaction.objectStore(FILE_STORE);\r\n        store.delete(id);\r\n\r\n        transaction.oncomplete = () => {\r\n            const files = getFilesMetadata().filter((f: any) => f.id !== id);\r\n            localStorage.setItem(STORAGE_KEYS.FILES, JSON.stringify(files));\r\n            resolve();\r\n        };\r\n\r\n        transaction.onerror = () => reject(transaction.error);\r\n    });\r\n};\r\n\r\n// ============================================\r\n// Links Storage\r\n// ============================================\r\n\r\nexport const saveLink = (link: any) => {\r\n    const links = getLinks();\r\n    const newLink = {\r\n        id: generateId(),\r\n        url: link.url,\r\n        title: link.title || '',\r\n        description: link.description || '',\r\n        category: link.category || 'General',\r\n        addedAt: new Date().toISOString(),\r\n    };\r\n    links.push(newLink);\r\n    localStorage.setItem(STORAGE_KEYS.LINKS, JSON.stringify(links));\r\n    return newLink;\r\n};\r\n\r\nexport const getLinks = () => {\r\n    const data = localStorage.getItem(STORAGE_KEYS.LINKS);\r\n    return data ? JSON.parse(data) : [];\r\n};\r\n\r\nexport const updateLink = (id: string, updates: any) => {\r\n    const links = getLinks().map((link: any) =>\r\n        link.id === id ? { ...link, ...updates } : link\r\n    );\r\n    localStorage.setItem(STORAGE_KEYS.LINKS, JSON.stringify(links));\r\n};\r\n\r\nexport const deleteLink = (id: string) => {\r\n    const links = getLinks().filter((link: any) => link.id !== id);\r\n    localStorage.setItem(STORAGE_KEYS.LINKS, JSON.stringify(links));\r\n};\r\n\r\n// ============================================\r\n// Todos Storage\r\n// ============================================\r\n\r\nexport const saveTodo = (todo: any) => {\r\n    const todos = getTodos();\r\n    const newTodo = {\r\n        id: generateId(),\r\n        title: todo.title,\r\n        description: todo.description || '',\r\n        priority: todo.priority || 'medium',\r\n        dueDate: todo.dueDate || null,\r\n        completed: false,\r\n        addedAt: new Date().toISOString(),\r\n        completedAt: null,\r\n    };\r\n    todos.push(newTodo);\r\n    localStorage.setItem(STORAGE_KEYS.TODOS, JSON.stringify(todos));\r\n    return newTodo;\r\n};\r\n\r\nexport const getTodos = () => {\r\n    const data = localStorage.getItem(STORAGE_KEYS.TODOS);\r\n    return data ? JSON.parse(data) : [];\r\n};\r\n\r\nexport const updateTodo = (id: string, updates: any) => {\r\n    const todos = getTodos().map((todo: any) => {\r\n        if (todo.id === id) {\r\n            const updatedTodo = { ...todo, ...updates };\r\n            if (updates.completed && !todo.completed) {\r\n                updatedTodo.completedAt = new Date().toISOString();\r\n            }\r\n            return updatedTodo;\r\n        }\r\n        return todo;\r\n    });\r\n    localStorage.setItem(STORAGE_KEYS.TODOS, JSON.stringify(todos));\r\n};\r\n\r\nexport const deleteTodo = (id: string) => {\r\n    const todos = getTodos().filter((todo: any) => todo.id !== id);\r\n    localStorage.setItem(STORAGE_KEYS.TODOS, JSON.stringify(todos));\r\n};\r\n\r\n// ============================================\r\n// Chats Storage\r\n// ============================================\r\n\r\nexport const saveChat = (chat: any) => {\r\n    const chats = getChats();\r\n    const newChat = {\r\n        id: generateId(),\r\n        name: chat.name || 'Imported Chat',\r\n        content: chat.content,\r\n        messageCount: (chat.content.match(/\\n/g) || []).length + 1,\r\n        addedAt: new Date().toISOString(),\r\n    };\r\n    chats.push(newChat);\r\n    localStorage.setItem(STORAGE_KEYS.CHATS, JSON.stringify(chats));\r\n    return newChat;\r\n};\r\n\r\nexport const getChats = () => {\r\n    const data = localStorage.getItem(STORAGE_KEYS.CHATS);\r\n    return data ? JSON.parse(data) : [];\r\n};\r\n\r\nexport const getChatById = (id: string) => {\r\n    return getChats().find((chat: any) => chat.id === id);\r\n};\r\n\r\nexport const deleteChat = (id: string) => {\r\n    const chats = getChats().filter((chat: any) => chat.id !== id);\r\n    localStorage.setItem(STORAGE_KEYS.CHATS, JSON.stringify(chats));\r\n};\r\n\r\n// ============================================\r\n// Utility Functions\r\n// ============================================\r\n\r\nexport const getFileIcon = (type: string) => {\r\n    if (!type) return 'file';\r\n    if (type.startsWith('image/')) return 'image';\r\n    if (type === 'application/pdf') return 'pdf';\r\n    if (type.includes('document') || type.includes('word')) return 'doc';\r\n    if (type.includes('spreadsheet') || type.includes('excel')) return 'spreadsheet';\r\n    if (type.includes('presentation') || type.includes('powerpoint')) return 'presentation';\r\n    if (type.startsWith('video/')) return 'video';\r\n    if (type.startsWith('audio/')) return 'audio';\r\n    if (type.includes('zip') || type.includes('rar') || type.includes('7z')) return 'archive';\r\n    if (type.includes('text') || type.includes('json') || type.includes('javascript')) return 'code';\r\n    return 'file';\r\n};\r\n\r\nexport const formatFileSize = (bytes: any) => {\r\n    if (bytes === 0) return '0 Bytes';\r\n    const k = 1024;\r\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\r\n};\r\n\r\nexport const getStorageUsage = () => {\r\n    let total = 0;\r\n    for (const key of Object.values(STORAGE_KEYS)) {\r\n        const item = localStorage.getItem(key);\r\n        if (item) {\r\n            total += item.length * 2; // UTF-16 characters = 2 bytes each\r\n        }\r\n    }\r\n    return total;\r\n};\r\n\r\n// Export all storage for backup\r\nexport const exportAllData = () => {\r\n    return {\r\n        files: getFilesMetadata(),\r\n        links: getLinks(),\r\n        todos: getTodos(),\r\n        chats: getChats(),\r\n        exportedAt: new Date().toISOString(),\r\n    };\r\n};\r\n\r\n// Import data from backup\r\nexport const importData = (data: any) => {\r\n    if (data.links) localStorage.setItem(STORAGE_KEYS.LINKS, JSON.stringify(data.links));\r\n    if (data.todos) localStorage.setItem(STORAGE_KEYS.TODOS, JSON.stringify(data.todos));\r\n    if (data.chats) localStorage.setItem(STORAGE_KEYS.CHATS, JSON.stringify(data.chats));\r\n};\r\n","// Google Drive Storage Utilities\r\n// Handles file upload/download and data sync with Google Drive\r\n\r\nconst FOLDER_NAME = 'AnyDo Storage';\r\nconst DATA_FILE_NAME = 'anydo_data.json';\r\n\r\nlet appFolderId = null;\r\n\r\n// Get or create the app folder in Drive\r\nasync function getOrCreateAppFolder(accessToken) {\r\n    if (appFolderId) return appFolderId;\r\n\r\n    // Search for existing folder\r\n    const searchRes = await fetch(\r\n        `https://www.googleapis.com/drive/v3/files?q=name='${FOLDER_NAME}' and mimeType='application/vnd.google-apps.folder' and trashed=false`,\r\n        { headers: { Authorization: `Bearer ${accessToken}` } }\r\n    );\r\n    const searchData = await searchRes.json();\r\n\r\n    if (searchData.files && searchData.files.length > 0) {\r\n        appFolderId = searchData.files[0].id;\r\n        return appFolderId;\r\n    }\r\n\r\n    // Create new folder\r\n    const createRes = await fetch('https://www.googleapis.com/drive/v3/files', {\r\n        method: 'POST',\r\n        headers: {\r\n            Authorization: `Bearer ${accessToken}`,\r\n            'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n            name: FOLDER_NAME,\r\n            mimeType: 'application/vnd.google-apps.folder',\r\n        }),\r\n    });\r\n    const folder = await createRes.json();\r\n    appFolderId = folder.id;\r\n    return appFolderId;\r\n}\r\n\r\n// Upload a file to Google Drive\r\nexport async function uploadFileToDrive(accessToken, file, localId) {\r\n    const folderId = await getOrCreateAppFolder(accessToken);\r\n\r\n    const metadata = {\r\n        name: `${localId}_${file.name}`,\r\n        parents: [folderId],\r\n    };\r\n\r\n    const formData = new FormData();\r\n    formData.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));\r\n    formData.append('file', file);\r\n\r\n    const res = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {\r\n        method: 'POST',\r\n        headers: { Authorization: `Bearer ${accessToken}` },\r\n        body: formData,\r\n    });\r\n\r\n    return await res.json();\r\n}\r\n\r\n// Delete a file from Google Drive\r\nexport async function deleteFileFromDrive(accessToken, driveFileId) {\r\n    await fetch(`https://www.googleapis.com/drive/v3/files/${driveFileId}`, {\r\n        method: 'DELETE',\r\n        headers: { Authorization: `Bearer ${accessToken}` },\r\n    });\r\n}\r\n\r\n// Sync app data (links, todos, chats) to Drive\r\nexport async function syncDataToDrive(accessToken, data) {\r\n    const folderId = await getOrCreateAppFolder(accessToken);\r\n\r\n    // Check if data file exists\r\n    const searchRes = await fetch(\r\n        `https://www.googleapis.com/drive/v3/files?q=name='${DATA_FILE_NAME}' and '${folderId}' in parents and trashed=false`,\r\n        { headers: { Authorization: `Bearer ${accessToken}` } }\r\n    );\r\n    const searchData = await searchRes.json();\r\n\r\n    const fileContent = JSON.stringify(data, null, 2);\r\n    const blob = new Blob([fileContent], { type: 'application/json' });\r\n\r\n    if (searchData.files && searchData.files.length > 0) {\r\n        // Update existing file\r\n        const fileId = searchData.files[0].id;\r\n        await fetch(`https://www.googleapis.com/upload/drive/v3/files/${fileId}?uploadType=media`, {\r\n            method: 'PATCH',\r\n            headers: {\r\n                Authorization: `Bearer ${accessToken}`,\r\n                'Content-Type': 'application/json',\r\n            },\r\n            body: blob,\r\n        });\r\n    } else {\r\n        // Create new file\r\n        const metadata = {\r\n            name: DATA_FILE_NAME,\r\n            parents: [folderId],\r\n        };\r\n\r\n        const formData = new FormData();\r\n        formData.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));\r\n        formData.append('file', blob);\r\n\r\n        await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {\r\n            method: 'POST',\r\n            headers: { Authorization: `Bearer ${accessToken}` },\r\n            body: formData,\r\n        });\r\n    }\r\n}\r\n\r\n// Load app data from Drive\r\nexport async function loadDataFromDrive(accessToken) {\r\n    const folderId = await getOrCreateAppFolder(accessToken);\r\n\r\n    // Find data file\r\n    const searchRes = await fetch(\r\n        `https://www.googleapis.com/drive/v3/files?q=name='${DATA_FILE_NAME}' and '${folderId}' in parents and trashed=false`,\r\n        { headers: { Authorization: `Bearer ${accessToken}` } }\r\n    );\r\n    const searchData = await searchRes.json();\r\n\r\n    if (searchData.files && searchData.files.length > 0) {\r\n        const fileId = searchData.files[0].id;\r\n        const contentRes = await fetch(\r\n            `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`,\r\n            { headers: { Authorization: `Bearer ${accessToken}` } }\r\n        );\r\n        return await contentRes.json();\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\n// List all files in app folder\r\nexport async function listDriveFiles(accessToken) {\r\n    const folderId = await getOrCreateAppFolder(accessToken);\r\n\r\n    const res = await fetch(\r\n        `https://www.googleapis.com/drive/v3/files?q='${folderId}' in parents and trashed=false&fields=files(id,name,size,createdTime,mimeType)`,\r\n        { headers: { Authorization: `Bearer ${accessToken}` } }\r\n    );\r\n\r\n    return await res.json();\r\n}\r\n\r\n// Get storage quota info\r\nexport async function getDriveQuota(accessToken) {\r\n    const res = await fetch(\r\n        'https://www.googleapis.com/drive/v3/about?fields=storageQuota',\r\n        { headers: { Authorization: `Bearer ${accessToken}` } }\r\n    );\r\n    return await res.json();\r\n}\r\n"],"names":[],"mappings":"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"}